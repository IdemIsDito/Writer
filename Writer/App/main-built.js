define("durandal/system",["require","jquery"],function(e,t){function n(e){var t="[object "+e+"]";r["is"+e]=function(e){return s.call(e)==t}}var r,i=!1,a=Object.keys,o=Object.prototype.hasOwnProperty,s=Object.prototype.toString,u=!1,c=Array.isArray,l=Array.prototype.slice;if(String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Function.prototype.bind&&("object"==typeof console||"function"==typeof console)&&"object"==typeof console.log)try{["log","info","warn","error","assert","dir","clear","profile","profileEnd"].forEach(function(e){console[e]=this.call(console[e],console)},Function.prototype.bind)}catch(p){u=!0}e.on&&e.on("moduleLoaded",function(e,t){r.setModuleId(e,t)}),"undefined"!=typeof requirejs&&(requirejs.onResourceLoad=function(e,t){r.setModuleId(e.defined[t.id],t.id)});var f=function(){},d=function(){try{if("undefined"!=typeof console&&"function"==typeof console.log)if(window.opera)for(var e=0;e<arguments.length;)console.log("Item "+(e+1)+": "+arguments[e]),e++;else 1==l.call(arguments).length&&"string"==typeof l.call(arguments)[0]?console.log(l.call(arguments).toString()):console.log.apply(console,l.call(arguments));else Function.prototype.bind&&!u||"undefined"==typeof console||"object"!=typeof console.log||Function.prototype.call.call(console.log,console,l.call(arguments))}catch(t){}},h=function(e,t){var n;n=e instanceof Error?e:new Error(e),n.innerError=t;try{"undefined"!=typeof console&&"function"==typeof console.error?console.error(n):Function.prototype.bind&&!u||"undefined"==typeof console||"object"!=typeof console.error||Function.prototype.call.call(console.error,console,n)}catch(r){}throw n};r={version:"2.1.0",noop:f,getModuleId:function(e){return e?"function"==typeof e&&e.prototype?e.prototype.__moduleId__:"string"==typeof e?null:e.__moduleId__:null},setModuleId:function(e,t){return e?"function"==typeof e&&e.prototype?void(e.prototype.__moduleId__=t):void("string"!=typeof e&&(e.__moduleId__=t)):void 0},resolveObject:function(e){return r.isFunction(e)?new e:e},debug:function(e){return 1==arguments.length&&(i=e,i?(this.log=d,this.error=h,this.log("Debug:Enabled")):(this.log("Debug:Disabled"),this.log=f,this.error=f)),i},log:f,error:f,assert:function(e,t){e||r.error(new Error(t||"Assert:Failed"))},defer:function(e){return t.Deferred(e)},guid:function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:7&n|8).toString(16)})},acquire:function(){var t,n=arguments[0],i=!1;return r.isArray(n)?(t=n,i=!0):t=l.call(arguments,0),this.defer(function(n){e(t,function(){var e=arguments;setTimeout(function(){n.resolve(e.length>1||i?l.call(e,0):e[0])},1)},function(e){n.reject(e)})}).promise()},extend:function(e){for(var t=l.call(arguments,1),n=0;n<t.length;n++){var r=t[n];if(r)for(var i in r)e[i]=r[i]}return e},wait:function(e){return r.defer(function(t){setTimeout(t.resolve,e)}).promise()}},r.keys=a||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)o.call(e,n)&&(t[t.length]=n);return t},r.isElement=function(e){return!(!e||1!==e.nodeType)},r.isArray=c||function(e){return"[object Array]"==s.call(e)},r.isObject=function(e){return e===Object(e)},r.isBoolean=function(e){return"boolean"==typeof e},r.isPromise=function(e){return e&&r.isFunction(e.then)};for(var y=["Arguments","Function","String","Number","Date","RegExp"],v=0;v<y.length;v++)n(y[v]);return r}),define("durandal/viewEngine",["durandal/system","jquery"],function(e,t){var n;return n=t.parseHTML?function(e){return t.parseHTML(e)}:function(e){return t(e).get()},{cache:{},viewExtension:".html",viewPlugin:"text",viewPluginParameters:"",isViewUrl:function(e){return-1!==e.indexOf(this.viewExtension,e.length-this.viewExtension.length)},convertViewUrlToViewId:function(e){return e.substring(0,e.length-this.viewExtension.length)},convertViewIdToRequirePath:function(e){var t=this.viewPlugin?this.viewPlugin+"!":"";return t+e+this.viewExtension+this.viewPluginParameters},parseMarkup:n,processMarkup:function(e){var t=this.parseMarkup(e);return this.ensureSingleElement(t)},ensureSingleElement:function(e){if(1==e.length)return e[0];for(var n=[],r=0;r<e.length;r++){var i=e[r];if(8!=i.nodeType){if(3==i.nodeType){var a=/\S/.test(i.nodeValue);if(!a)continue}n.push(i)}}return n.length>1?t(n).wrapAll('<div class="durandal-wrapper"></div>').parent().get(0):n[0]},tryGetViewFromCache:function(e){return this.cache[e]},putViewInCache:function(e,t){this.cache[e]=t},createView:function(t){var n=this,r=this.convertViewIdToRequirePath(t),i=this.tryGetViewFromCache(r);return i?e.defer(function(e){e.resolve(i.cloneNode(!0))}).promise():e.defer(function(i){e.acquire(r).then(function(e){var a=n.processMarkup(e);a.setAttribute("data-view",t),n.putViewInCache(r,a),i.resolve(a.cloneNode(!0))}).fail(function(e){n.createFallbackView(t,r,e).then(function(e){e.setAttribute("data-view",t),n.cache[r]=e,i.resolve(e.cloneNode(!0))})})}).promise()},createFallbackView:function(t,n){var r=this,i='View Not Found. Searched for "'+t+'" via path "'+n+'".';return e.defer(function(e){e.resolve(r.processMarkup('<div class="durandal-view-404">'+i+"</div>"))}).promise()}}}),define("durandal/viewLocator",["durandal/system","durandal/viewEngine"],function(e,t){function n(e,t){for(var n=0;n<e.length;n++){var r=e[n],i=r.getAttribute("data-view");if(i==t)return r}}function r(e){return(e+"").replace(/([\\\.\+\*\?\[\^\]\$\(\)\{\}\=\!\<\>\|\:])/g,"\\$1")}return{useConvention:function(e,t,n){e=e||"viewmodels",t=t||"views",n=n||t;var i=new RegExp(r(e),"gi");this.convertModuleIdToViewId=function(e){return e.replace(i,t)},this.translateViewIdToArea=function(e,t){return t&&"partial"!=t?n+"/"+t+"/"+e:n+"/"+e}},locateViewForObject:function(t,n,r){var i;if(t.getView&&(i=t.getView()))return this.locateView(i,n,r);if(t.viewUrl)return this.locateView(t.viewUrl,n,r);var a=e.getModuleId(t);return a?this.locateView(this.convertModuleIdToViewId(a),n,r):this.locateView(this.determineFallbackViewId(t),n,r)},convertModuleIdToViewId:function(e){return e},determineFallbackViewId:function(e){var t=/function (.{1,})\(/,n=t.exec(e.constructor.toString()),r=n&&n.length>1?n[1]:"";return r=r.trim(),"views/"+r},translateViewIdToArea:function(e){return e},locateView:function(r,i,a){if("string"==typeof r){var o;if(o=t.isViewUrl(r)?t.convertViewUrlToViewId(r):r,i&&(o=this.translateViewIdToArea(o,i)),a){var s=n(a,o);if(s)return e.defer(function(e){e.resolve(s)}).promise()}return t.createView(o)}return e.defer(function(e){e.resolve(r)}).promise()}}}),define("durandal/binder",["durandal/system","knockout"],function(e,t){function n(t){return void 0===t?{applyBindings:!0}:e.isBoolean(t)?{applyBindings:t}:(void 0===t.applyBindings&&(t.applyBindings=!0),t)}function r(r,c,l,p){if(!c||!l)return void(i.throwOnErrors?e.error(a):e.log(a,c,p));if(!c.getAttribute)return void(i.throwOnErrors?e.error(o):e.log(o,c,p));var f=c.getAttribute("data-view");try{var d;return r&&r.binding&&(d=r.binding(c)),d=n(d),i.binding(p,c,d),d.applyBindings?(e.log("Binding",f,p),t.applyBindings(l,c)):r&&t.utils.domData.set(c,u,{$data:r}),i.bindingComplete(p,c,d),r&&r.bindingComplete&&r.bindingComplete(c),t.utils.domData.set(c,s,d),d}catch(h){h.message=h.message+";\nView: "+f+";\nModuleId: "+e.getModuleId(p),i.throwOnErrors?e.error(h):e.log(h.message)}}var i,a="Insufficient Information to Bind",o="Unexpected View Type",s="durandal-binding-instruction",u="__ko_bindingContext__";return i={binding:e.noop,bindingComplete:e.noop,throwOnErrors:!1,getBindingInstruction:function(e){return t.utils.domData.get(e,s)},bindContext:function(e,t,n,i){return n&&e&&(e=e.createChildContext(n,"string"==typeof i?i:null)),r(n,t,e,n||(e?e.$data:null))},bind:function(e,t){return r(e,t,e,e)}}}),define("durandal/activator",["durandal/system","knockout"],function(e,t){function n(t){return void 0==t&&(t={}),e.isBoolean(t.closeOnDeactivate)||(t.closeOnDeactivate=c.defaults.closeOnDeactivate),t.beforeActivate||(t.beforeActivate=c.defaults.beforeActivate),t.afterDeactivate||(t.afterDeactivate=c.defaults.afterDeactivate),t.affirmations||(t.affirmations=c.defaults.affirmations),t.interpretResponse||(t.interpretResponse=c.defaults.interpretResponse),t.areSameItem||(t.areSameItem=c.defaults.areSameItem),t.findChildActivator||(t.findChildActivator=c.defaults.findChildActivator),t}function r(t,n,r){return e.isArray(r)?t[n].apply(t,r):t[n](r)}function i(t,n,r,i,a){if(t&&t.deactivate){e.log("Deactivating",t);var o;try{o=t.deactivate(n)}catch(s){return e.log("ERROR: "+s.message,s),void i.resolve(!1)}o&&o.then?o.then(function(){r.afterDeactivate(t,n,a),i.resolve(!0)},function(t){e.log(t),i.resolve(!1)}):(r.afterDeactivate(t,n,a),i.resolve(!0))}else t&&r.afterDeactivate(t,n,a),i.resolve(!0)}function a(t,n,i,a){var o;if(t&&t.activate){e.log("Activating",t);try{o=r(t,"activate",a)}catch(s){return e.log("ERROR: "+s.message,s),void i(!1)}}o&&o.then?o.then(function(){n(t),i(!0)},function(t){e.log("ERROR: "+t.message,t),i(!1)}):(n(t),i(!0))}function o(t,n,r,i){return i=e.extend({},l,i),r.lifecycleData=null,e.defer(function(a){function o(){if(t&&t.canDeactivate&&i.canDeactivate){var o;try{o=t.canDeactivate(n)}catch(s){return e.log("ERROR: "+s.message,s),void a.resolve(!1)}o.then?o.then(function(e){r.lifecycleData=e,a.resolve(r.interpretResponse(e))},function(t){e.log("ERROR: "+t.message,t),a.resolve(!1)}):(r.lifecycleData=o,a.resolve(r.interpretResponse(o)))}else a.resolve(!0)}var s=r.findChildActivator(t);s?s.canDeactivate().then(function(e){e?o():a.resolve(!1)}):o()}).promise()}function s(t,n,i,a,o){return i.lifecycleData=null,e.defer(function(s){if(i.areSameItem(n(),t,a,o))return void s.resolve(!0);if(t&&t.canActivate){var u;try{u=r(t,"canActivate",o)}catch(c){return e.log("ERROR: "+c.message,c),void s.resolve(!1)}u.then?u.then(function(e){i.lifecycleData=e,s.resolve(i.interpretResponse(e))},function(t){e.log("ERROR: "+t.message,t),s.resolve(!1)}):(i.lifecycleData=u,s.resolve(i.interpretResponse(u)))}else s.resolve(!0)}).promise()}function u(r,u){var c,l=t.observable(null);u=n(u);var p=t.computed({read:function(){return l()},write:function(e){p.viaSetter=!0,p.activateItem(e)}});return p.__activator__=!0,p.settings=u,u.activator=p,p.isActivating=t.observable(!1),p.forceActiveItem=function(e){l(e)},p.canDeactivateItem=function(e,t,n){return o(e,t,u,n)},p.deactivateItem=function(t,n){return e.defer(function(e){p.canDeactivateItem(t,n).then(function(r){r?i(t,n,u,e,l):(p.notifySubscribers(),e.resolve(!1))})}).promise()},p.canActivateItem=function(e,t){return s(e,l,u,c,t)},p.activateItem=function(t,n,r){var o=p.viaSetter;return p.viaSetter=!1,e.defer(function(s){if(p.isActivating())return void s.resolve(!1);p.isActivating(!0);var f=l();return u.areSameItem(f,t,c,n)?(p.isActivating(!1),void s.resolve(!0)):void p.canDeactivateItem(f,u.closeOnDeactivate,r).then(function(r){r?p.canActivateItem(t,n).then(function(r){r?e.defer(function(e){i(f,u.closeOnDeactivate,u,e)}).promise().then(function(){t=u.beforeActivate(t,n),a(t,l,function(e){c=n,p.isActivating(!1),s.resolve(e)},n)}):(o&&p.notifySubscribers(),p.isActivating(!1),s.resolve(!1))}):(o&&p.notifySubscribers(),p.isActivating(!1),s.resolve(!1))})}).promise()},p.canActivate=function(){var e;return r?(e=r,r=!1):e=p(),p.canActivateItem(e)},p.activate=function(){var e;return r?(e=r,r=!1):e=p(),p.activateItem(e)},p.canDeactivate=function(e){return p.canDeactivateItem(p(),e)},p.deactivate=function(e){return p.deactivateItem(p(),e)},p.includeIn=function(e){e.canActivate=function(){return p.canActivate()},e.activate=function(){return p.activate()},e.canDeactivate=function(e){return p.canDeactivate(e)},e.deactivate=function(e){return p.deactivate(e)}},u.includeIn?p.includeIn(u.includeIn):r&&p.activate(),p.forItems=function(t){u.closeOnDeactivate=!1,u.determineNextItemToActivate=function(e,t){var n=t-1;return-1==n&&e.length>1?e[1]:n>-1&&n<e.length-1?e[n]:null},u.beforeActivate=function(e){var n=p();if(e){var r=t.indexOf(e);-1==r?t.push(e):e=t()[r]}else e=u.determineNextItemToActivate(t,n?t.indexOf(n):0);return e},u.afterDeactivate=function(e,n){n&&t.remove(e)};var n=p.canDeactivate;p.canDeactivate=function(r){return r?e.defer(function(e){function n(){for(var t=0;t<a.length;t++)if(!a[t])return void e.resolve(!1);e.resolve(!0)}for(var i=t(),a=[],o=0;o<i.length;o++)p.canDeactivateItem(i[o],r).then(function(e){a.push(e),a.length==i.length&&n()})}).promise():n()};var r=p.deactivate;return p.deactivate=function(n){return n?e.defer(function(e){function r(r){setTimeout(function(){p.deactivateItem(r,n).then(function(){a++,t.remove(r),a==o&&e.resolve()})},1)}for(var i=t(),a=0,o=i.length,s=0;o>s;s++)r(i[s])}).promise():r()},p},p}var c,l={canDeactivate:!0},p={closeOnDeactivate:!0,affirmations:["yes","ok","true"],interpretResponse:function(n){return e.isObject(n)&&(n=n.can||!1),e.isString(n)?-1!==t.utils.arrayIndexOf(this.affirmations,n.toLowerCase()):n},areSameItem:function(e,t){return e==t},beforeActivate:function(e){return e},afterDeactivate:function(e,t,n){t&&n&&n(null)},findChildActivator:function(){return null}};return c={defaults:p,create:u,isActivator:function(e){return e&&e.__activator__}}}),define("durandal/composition",["durandal/system","durandal/viewLocator","durandal/binder","durandal/viewEngine","durandal/activator","jquery","knockout"],function(e,t,n,r,i,a,o){function s(t,n,r){try{if(t.onError)try{t.onError(n,r)}catch(i){e.error(i)}else e.error(n)}finally{c(t,r,!0)}}function u(e){for(var t=[],n={childElements:t,activeView:null},r=o.virtualElements.firstChild(e);r;)1==r.nodeType&&(t.push(r),r.getAttribute(E)&&(n.activeView=r)),r=o.virtualElements.nextSibling(r);return n.activeView||(n.activeView=t[0]),n}function c(e,t,n){if(x--,0===x){var r=T;T=[],n||setTimeout(function(){for(var n=r.length;n--;)try{r[n]()}catch(i){s(e,i,t)}},1)}l(e)}function l(e){delete e.activeView,delete e.viewElements}function p(t,n,r,i){if(r)n();else if(t.activate&&t.model&&t.model.activate){var a;try{a=e.isArray(t.activationData)?t.model.activate.apply(t.model,t.activationData):t.model.activate(t.activationData),a&&a.then?a.then(n,function(e){s(t,e,i),n()}):a||void 0===a?n():c(t,i)}catch(o){s(t,o,i)}}else n()}function f(t,n){var t=this;if(t.activeView&&t.activeView.removeAttribute(E),t.child)try{t.model&&t.model.attached&&(t.composingNewView||t.alwaysTriggerAttach)&&t.model.attached(t.child,t.parent,t),t.attached&&t.attached(t.child,t.parent,t),t.child.setAttribute(E,!0),t.composingNewView&&t.model&&t.model.detached&&o.utils.domNodeDisposal.addDisposeCallback(t.child,function(){try{t.model.detached(t.child,t.parent,t)}catch(e){s(t,e,n)}})}catch(r){s(t,r,n)}t.triggerAttach=e.noop}function d(t){if(e.isString(t.transition)){if(t.activeView){if(t.activeView==t.child)return!1;if(!t.child)return!0;if(t.skipTransitionOnSameViewId){var n=t.activeView.getAttribute("data-view"),r=t.child.getAttribute("data-view");return n!=r}}return!0}return!1}function h(e){for(var t=0,n=e.length,r=[];n>t;t++){var i=e[t].cloneNode(!0);r.push(i)}return r}function y(t){var n=h(t.parts),r=w.getParts(n),i=w.getParts(t.child);for(var o in r){var s=i[o];s||(s=a('[data-part="'+o+'"]',t.child).get(0))?s.parentNode.replaceChild(r[o],s):e.log("Could not find part to override: "+o)}}function v(t){var n,r,i=o.virtualElements.childNodes(t.parent);if(!e.isArray(i)){var a=[];for(n=0,r=i.length;r>n;n++)a[n]=i[n];i=a}for(n=1,r=i.length;r>n;n++)o.removeNode(i[n])}function m(e){o.utils.domData.set(e,O,e.style.display),e.style.display="none"}function g(e){var t=o.utils.domData.get(e,O);e.style.display="none"===t?"block":t}function b(e){var t=e.getAttribute("data-bind");if(!t)return!1;for(var n=0,r=A.length;r>n;n++)if(t.indexOf(A[n])>-1)return!0;return!1}var w,S={},E="data-active-view",T=[],x=0,P="durandal-composition-data",_="data-part",N=["model","view","transition","area","strategy","activationData","onError"],O="durandal-visibility-data",A=["compose:"],C={complete:function(e){T.push(e)}};return w={composeBindings:A,convertTransitionToModuleId:function(e){return"transitions/"+e},defaultTransitionName:null,current:C,addBindingHandler:function(e,t,n){var r,i,a="composition-handler-"+e;t=t||o.bindingHandlers[e],n=n||function(){return void 0},i=o.bindingHandlers[e]={init:function(e,r,i,s,u){if(x>0){var c={trigger:o.observable(null)};w.current.complete(function(){t.init&&t.init(e,r,i,s,u),t.update&&(o.utils.domData.set(e,a,t),c.trigger("trigger"))}),o.utils.domData.set(e,a,c)}else o.utils.domData.set(e,a,t),t.init&&t.init(e,r,i,s,u);return n(e,r,i,s,u)},update:function(e,t,n,r,i){var s=o.utils.domData.get(e,a);return s.update?s.update(e,t,n,r,i):void(s.trigger&&s.trigger())}};for(r in t)"init"!==r&&"update"!==r&&(i[r]=t[r])},getParts:function(e,t){if(t=t||{},!e)return t;void 0===e.length&&(e=[e]);for(var n=0,r=e.length;r>n;n++){var i,a=e[n];a.getAttribute&&(i=a.getAttribute(_),i&&(t[i]=a),a.hasChildNodes()&&!b(a)&&w.getParts(a.childNodes,t))}return t},cloneNodes:h,finalize:function(t,r){if(void 0===t.transition&&(t.transition=this.defaultTransitionName),t.child||t.activeView)if(d(t)){var i=this.convertTransitionToModuleId(t.transition);e.acquire(i).then(function(e){t.transition=e,e(t).then(function(){if(t.cacheViews){if(t.activeView){var e=n.getBindingInstruction(t.activeView);e&&void 0!=e.cacheViews&&!e.cacheViews?o.removeNode(t.activeView):m(t.activeView)}}else t.child?v(t):o.virtualElements.emptyNode(t.parent);t.child&&g(t.child),t.triggerAttach(t,r),c(t,r)})}).fail(function(e){s(t,"Failed to load transition ("+i+"). Details: "+e.message,r)})}else{if(t.child!=t.activeView){if(t.cacheViews&&t.activeView){var a=n.getBindingInstruction(t.activeView);!a||void 0!=a.cacheViews&&!a.cacheViews?o.removeNode(t.activeView):m(t.activeView)}t.child?(t.cacheViews||v(t),g(t.child)):t.cacheViews||o.virtualElements.emptyNode(t.parent)}t.triggerAttach(t,r),c(t,r)}else t.cacheViews||o.virtualElements.emptyNode(t.parent),t.triggerAttach(t,r),c(t,r)},bindAndShow:function(e,t,i,a){i.child=e,i.parent.__composition_context=i,i.composingNewView=i.cacheViews?-1==o.utils.arrayIndexOf(i.viewElements,e):!0,p(i,function(){if(i.parent.__composition_context==i){if(delete i.parent.__composition_context,i.binding&&i.binding(i.child,i.parent,i),i.preserveContext&&i.bindingContext)i.composingNewView&&(i.parts&&y(i),m(e),o.virtualElements.prepend(i.parent,e),n.bindContext(i.bindingContext,e,i.model,i.as));else if(e){var a=i.model||S,s=o.dataFor(e);if(s!=a){if(!i.composingNewView)return o.removeNode(e),void r.createView(e.getAttribute("data-view")).then(function(e){w.bindAndShow(e,t,i,!0)});i.parts&&y(i),m(e),o.virtualElements.prepend(i.parent,e),n.bind(a,e)}}w.finalize(i,t)}else c(i,t)},a,t)},defaultStrategy:function(e){return t.locateViewForObject(e.model,e.area,e.viewElements)},getSettings:function(t){var n,a=t(),s=o.utils.unwrapObservable(a)||{},u=i.isActivator(a);if(e.isString(s))return s=r.isViewUrl(s)?{view:s}:{model:s,activate:!u};if(n=e.getModuleId(s))return s={model:s,activate:!u};!u&&s.model&&(u=i.isActivator(s.model));for(var c in s)s[c]=-1!=o.utils.arrayIndexOf(N,c)?o.utils.unwrapObservable(s[c]):s[c];return u?s.activate=!1:void 0===s.activate&&(s.activate=!0),s},executeStrategy:function(e,t){e.strategy(e).then(function(n){w.bindAndShow(n,t,e)})},inject:function(n,r){return n.model?n.view?void t.locateView(n.view,n.area,n.viewElements).then(function(e){w.bindAndShow(e,r,n)}):(n.strategy||(n.strategy=this.defaultStrategy),void(e.isString(n.strategy)?e.acquire(n.strategy).then(function(e){n.strategy=e,w.executeStrategy(n,r)}).fail(function(e){s(n,"Failed to load view strategy ("+n.strategy+"). Details: "+e.message,r)}):this.executeStrategy(n,r))):void this.bindAndShow(null,r,n)},compose:function(n,r,i,a){x++,a||(r=w.getSettings(function(){return r},n)),r.compositionComplete&&T.push(function(){r.compositionComplete(r.child,r.parent,r)}),T.push(function(){r.composingNewView&&r.model&&r.model.compositionComplete&&r.model.compositionComplete(r.child,r.parent,r)});var o=u(n);r.activeView=o.activeView,r.parent=n,r.triggerAttach=f,r.bindingContext=i,r.cacheViews&&!r.viewElements&&(r.viewElements=o.childElements),r.model?e.isString(r.model)?e.acquire(r.model).then(function(t){r.model=e.resolveObject(t),w.inject(r,n)}).fail(function(e){s(r,"Failed to load composed module ("+r.model+"). Details: "+e.message,n)}):w.inject(r,n):r.view?(r.area=r.area||"partial",r.preserveContext=!0,t.locateView(r.view,r.area,r.viewElements).then(function(e){w.bindAndShow(e,n,r)})):this.bindAndShow(null,n,r)}},o.bindingHandlers.compose={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,i,a){var s=w.getSettings(t,e);if(s.mode){var u=o.utils.domData.get(e,P);if(!u){var c=o.virtualElements.childNodes(e);u={},"inline"===s.mode?u.view=r.ensureSingleElement(c):"templated"===s.mode&&(u.parts=h(c)),o.virtualElements.emptyNode(e),o.utils.domData.set(e,P,u)}"inline"===s.mode?s.view=u.view.cloneNode(!0):"templated"===s.mode&&(s.parts=u.parts),s.preserveContext=!0}w.compose(e,s,a,!0)}},o.virtualElements.allowedBindings.compose=!0,w}),define("durandal/events",["durandal/system"],function(e){var t=/\s+/,n=function(){},r=function(e,t){this.owner=e,this.events=t};return r.prototype.then=function(e,t){return this.callback=e||this.callback,this.context=t||this.context,this.callback?(this.owner.on(this.events,this.callback,this.context),this):this},r.prototype.on=r.prototype.then,r.prototype.off=function(){return this.owner.off(this.events,this.callback,this.context),this},n.prototype.on=function(e,n,i){var a,o,s;if(n){for(a=this.callbacks||(this.callbacks={}),e=e.split(t);o=e.shift();)s=a[o]||(a[o]=[]),s.push(n,i);return this}return new r(this,e)},n.prototype.off=function(n,r,i){var a,o,s,u;if(!(o=this.callbacks))return this;if(!(n||r||i))return delete this.callbacks,this;for(n=n?n.split(t):e.keys(o);a=n.shift();)if((s=o[a])&&(r||i))for(u=s.length-2;u>=0;u-=2)r&&s[u]!==r||i&&s[u+1]!==i||s.splice(u,2);else delete o[a];return this},n.prototype.trigger=function(e){var n,r,i,a,o,s,u,c;if(!(r=this.callbacks))return this;for(c=[],e=e.split(t),a=1,o=arguments.length;o>a;a++)c[a-1]=arguments[a];for(;n=e.shift();){if((u=r.all)&&(u=u.slice()),(i=r[n])&&(i=i.slice()),i)for(a=0,o=i.length;o>a;a+=2)i[a].apply(i[a+1]||this,c);if(u)for(s=[n].concat(c),a=0,o=u.length;o>a;a+=2)u[a].apply(u[a+1]||this,s)}return this},n.prototype.proxy=function(e){var t=this;return function(n){t.trigger(e,n)}},n.includeIn=function(e){e.on=n.prototype.on,e.off=n.prototype.off,e.trigger=n.prototype.trigger,e.proxy=n.prototype.proxy},n}),define("durandal/app",["durandal/system","durandal/viewEngine","durandal/composition","durandal/events","jquery"],function(e,t,n,r,i){function a(){return e.defer(function(t){return 0==s.length?void t.resolve():void e.acquire(s).then(function(n){for(var r=0;r<n.length;r++){var i=n[r];if(i.install){var a=u[r];e.isObject(a)||(a={}),i.install(a),e.log("Plugin:Installed "+s[r])}else e.log("Plugin:Loaded "+s[r])}t.resolve()}).fail(function(t){e.error("Failed to load plugin(s). Details: "+t.message)})}).promise()}var o,s=[],u=[];return o={title:"Application",configurePlugins:function(t,n){var r=e.keys(t);n=n||"plugins/",-1===n.indexOf("/",n.length-1)&&(n+="/");for(var i=0;i<r.length;i++){var a=r[i];s.push(n+a),u.push(t[a])}},start:function(){return e.log("Application:Starting"),this.title&&(document.title=this.title),e.defer(function(t){i(function(){a().then(function(){t.resolve(),e.log("Application:Started")})})}).promise()},setRoot:function(r,i,a){function o(){if(u.model)if(u.model.canActivate)try{var t=u.model.canActivate();t&&t.then?t.then(function(e){e&&n.compose(s,u)}).fail(function(t){e.error(t)}):t&&n.compose(s,u)}catch(r){e.error(r)}else n.compose(s,u);else n.compose(s,u)}var s,u={activate:!0,transition:i};s=!a||e.isString(a)?document.getElementById(a||"applicationHost"):a,e.isString(r)&&t.isViewUrl(r)?u.view=r:u.model=r,e.isString(u.model)?e.acquire(u.model).then(function(t){u.model=e.resolveObject(t),o()}).fail(function(t){e.error("Failed to load root module ("+u.model+"). Details: "+t.message)}):o()}},r.includeIn(o),o}),define("config",[],function(){return{}}),define("services/globals",[],function(){return{participant:ko.observable()}}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("Q",e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else{if("undefined"==typeof self)throw new Error("This environment was not anticiapted by Q. Please file a bug.");self.Q=e()}}(function(){function e(e){return function(){return H.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===tt(e)||e instanceof z}function r(e,t){if(B&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(nt)){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var a=n.join("\n"+nt+"\n");e.stack=i(a)}}function i(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var i=t[r];s(i)||a(i)||!i||n.push(i)}return n.join("\n")}function a(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function o(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function s(e){var t=o(e);if(!t)return!1;var n=t[0],r=t[1];return n===U&&r>=L&&ot>=r}function u(){if(B)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=o(n);if(!r)return;return U=r[0],r[1]}}function c(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function l(e){return e instanceof h?e:g(e)?N(e):_(e)}function p(){function e(e){t=e,a.source=e,Q(n,function(t,n){l.nextTick(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],i=X(p.prototype),a=X(h.prototype);if(a.promiseDispatch=function(e,i,a){var o=J(arguments);n?(n.push(o),"when"===i&&a[1]&&r.push(a[1])):l.nextTick(function(){t.promiseDispatch.apply(t,o)})},a.valueOf=function(){if(n)return a;var e=v(t);return m(e)&&(t=e),e},a.inspect=function(){return t?t.inspect():{state:"pending"}},l.longStackSupport&&B)try{throw new Error}catch(o){a.stack=o.stack.substring(o.stack.indexOf("\n")+1)}return i.promise=a,i.resolve=function(n){t||e(l(n))},i.fulfill=function(n){t||e(_(n))},i.reject=function(n){t||e(P(n))},i.notify=function(e){t||Q(r,function(t,n){l.nextTick(function(){n(e)})},void 0)},i}function f(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=p();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function d(e){return f(function(t,n){for(var r=0,i=e.length;i>r;r++)l(e[r]).then(t,n)})}function h(e,t,n){void 0===t&&(t=function(e){return P(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=X(h.prototype);if(r.promiseDispatch=function(n,i,a){var o;try{o=e[i]?e[i].apply(r,a):t.call(r,i,a)}catch(s){o=P(s)}n&&n(o)},r.inspect=n,n){var i=n();"rejected"===i.state&&(r.exception=i.reason),r.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function y(e,t,n,r){return l(e).then(t,n,r)}function v(e){if(m(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function m(e){return e instanceof h}function g(e){return t(e)&&"function"==typeof e.then}function b(e){return m(e)&&"pending"===e.inspect().state}function w(e){return!m(e)||"fulfilled"===e.inspect().state}function S(e){return m(e)&&"rejected"===e.inspect().state}function E(){rt.length=0,it.length=0,at||(at=!0)}function T(e,t){at&&(it.push(e),rt.push(t&&"undefined"!=typeof t.stack?t.stack:"(no stack) "+t))}function x(e){if(at){var t=W(it,e);-1!==t&&(it.splice(t,1),rt.splice(t,1))}}function P(e){var t=h({when:function(t){return t&&x(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return T(t,e),t}function _(e){return h({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return et(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function N(e){var t=p();return l.nextTick(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function O(e){return h({isDef:function(){}},function(t,n){return I(e,t,n)},function(){return l(e).inspect()})}function A(e,t,n){return l(e).spread(t,n)}function C(e){return function(){function t(e,t){var o;if("undefined"==typeof StopIteration){try{o=r[e](t)}catch(s){return P(s)}return o.done?l(o.value):y(o.value,i,a)}try{o=r[e](t)}catch(s){return n(s)?l(s.value):P(s)}return y(o,i,a)}var r=e.apply(this,arguments),i=t.bind(t,"next"),a=t.bind(t,"throw");return i()}}function k(e){l.done(l.async(e)())}function F(e){throw new z(e)}function D(e){return function(){return A([this,M(arguments)],function(t,n){return e.apply(t,n)})}}function I(e,t,n){return l(e).dispatch(t,n)}function M(e){return y(e,function(e){var t=0,n=p();return Q(e,function(r,i,a){var o;m(i)&&"fulfilled"===(o=i.inspect()).state?e[a]=o.value:(++t,y(i,function(r){e[a]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:a,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function j(e){return y(e,function(e){return e=Z(e,l),y(M(Z(e,function(e){return y(e,$,$)})),function(){return e})})}function V(e){return l(e).allSettled()}function R(e,t){return l(e).then(void 0,void 0,t)}function q(e,t){return l(e).nodeify(t)}var B=!1;try{throw new Error}catch(K){B=!!K.stack}var U,z,L=u(),$=function(){},G=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var i=t.domain;i&&(t.domain=void 0,i.enter());try{n()}catch(o){if(a)throw i&&i.exit(),setTimeout(e,0),i&&i.enter(),o;setTimeout(function(){throw o},0)}i&&i.exit()}r=!1}var t={task:void 0,next:null},n=t,r=!1,i=void 0,a=!1;if(G=function(e){n=n.next={task:e,domain:a&&process.domain,next:null},r||(r=!0,i())},"undefined"!=typeof process&&process.nextTick)a=!0,i=function(){process.nextTick(e)};else if("function"==typeof setImmediate)i="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var o=new MessageChannel;o.port1.onmessage=function(){i=s,o.port1.onmessage=e,e()};var s=function(){o.port2.postMessage(0)};i=function(){setTimeout(e,0),s()}}else i=function(){setTimeout(e,0)};return G}(),H=Function.call,J=e(Array.prototype.slice),Q=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(t=e(t,this[n],n));return t}),W=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),Z=e(Array.prototype.map||function(e,t){var n=this,r=[];return Q(n,function(i,a,o){r.push(e.call(t,a,o,n))},void 0),r}),X=Object.create||function(e){function t(){}return t.prototype=e,new t},Y=e(Object.prototype.hasOwnProperty),et=Object.keys||function(e){var t=[];for(var n in e)Y(e,n)&&t.push(n);return t},tt=e(Object.prototype.toString);z="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var nt="From previous event:";l.resolve=l,l.nextTick=G,l.longStackSupport=!1,"object"==typeof process&&process&&process.env&&process.env.Q_DEBUG&&(l.longStackSupport=!0),l.defer=p,p.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):e.resolve(arguments.length>2?J(arguments,1):n)}},l.Promise=f,l.promise=f,f.race=d,f.all=M,f.reject=P,f.resolve=l,l.passByCopy=function(e){return e
},h.prototype.passByCopy=function(){return this},l.join=function(e,t){return l(e).join(t)},h.prototype.join=function(e){return l([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},l.race=d,h.prototype.race=function(){return this.then(l.race)},l.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,t,n){function i(t){try{return"function"==typeof e?e(t):t}catch(n){return P(n)}}function a(e){if("function"==typeof t){r(e,s);try{return t(e)}catch(n){return P(n)}}return P(e)}function o(e){return"function"==typeof n?n(e):e}var s=this,u=p(),c=!1;return l.nextTick(function(){s.promiseDispatch(function(e){c||(c=!0,u.resolve(i(e)))},"when",[function(e){c||(c=!0,u.resolve(a(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=o(e)}catch(r){if(n=!0,!l.onerror)throw r;l.onerror(r)}n||u.notify(t)}]),u.promise},l.tap=function(e,t){return l(e).tap(t)},h.prototype.tap=function(e){return e=l(e),this.then(function(t){return e.fcall(t).thenResolve(t)})},l.when=y,h.prototype.thenResolve=function(e){return this.then(function(){return e})},l.thenResolve=function(e,t){return l(e).thenResolve(t)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},l.thenReject=function(e,t){return l(e).thenReject(t)},l.nearer=v,l.isPromise=m,l.isPromiseAlike=g,l.isPending=b,h.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=w,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=S,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rt=[],it=[],at=!0;l.resetUnhandledRejections=E,l.getUnhandledReasons=function(){return rt.slice()},l.stopUnhandledRejectionTracking=function(){E(),at=!1},E(),l.reject=P,l.fulfill=_,l.master=O,l.spread=A,h.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},l.async=C,l.spawn=k,l["return"]=F,l.promised=D,l.dispatch=I,h.prototype.dispatch=function(e,t){var n=this,r=p();return l.nextTick(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},l.get=function(e,t){return l(e).dispatch("get",[t])},h.prototype.get=function(e){return this.dispatch("get",[e])},l.set=function(e,t,n){return l(e).dispatch("set",[t,n])},h.prototype.set=function(e,t){return this.dispatch("set",[e,t])},l.del=l["delete"]=function(e,t){return l(e).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},l.mapply=l.post=function(e,t,n){return l(e).dispatch("post",[t,n])},h.prototype.mapply=h.prototype.post=function(e,t){return this.dispatch("post",[e,t])},l.send=l.mcall=l.invoke=function(e,t){return l(e).dispatch("post",[t,J(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,J(arguments,1)])},l.fapply=function(e,t){return l(e).dispatch("apply",[void 0,t])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},l["try"]=l.fcall=function(e){return l(e).dispatch("apply",[void 0,J(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,J(arguments)])},l.fbind=function(e){var t=l(e),n=J(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(J(arguments))])}},h.prototype.fbind=function(){var e=this,t=J(arguments);return function(){return e.dispatch("apply",[this,t.concat(J(arguments))])}},l.keys=function(e){return l(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},l.all=M,h.prototype.all=function(){return M(this)},l.allResolved=c(j,"allResolved","allSettled"),h.prototype.allResolved=function(){return j(this)},l.allSettled=V,h.prototype.allSettled=function(){return this.then(function(e){return M(Z(e,function(e){function t(){return e.inspect()}return e=l(e),e.then(t,t)}))})},l.fail=l["catch"]=function(e,t){return l(e).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},l.progress=R,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},l.fin=l["finally"]=function(e,t){return l(e)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(e){return e=l(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},l.done=function(e,t,n,r){return l(e).done(t,n,r)},h.prototype.done=function(e,t,n){var i=function(e){l.nextTick(function(){if(r(e,a),!l.onerror)throw e;l.onerror(e)})},a=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(i=process.domain.bind(i)),a.then(void 0,i)},l.timeout=function(e,t,n){return l(e).timeout(t,n)},h.prototype.timeout=function(e,t){var n=p(),r=setTimeout(function(){t&&"string"!=typeof t||(t=new Error(t||"Timed out after "+e+" ms"),t.code="ETIMEDOUT"),n.reject(t)},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},l.delay=function(e,t){return void 0===t&&(t=e,e=void 0),l(e).delay(t)},h.prototype.delay=function(e){return this.then(function(t){var n=p();return setTimeout(function(){n.resolve(t)},e),n.promise})},l.nfapply=function(e,t){return l(e).nfapply(t)},h.prototype.nfapply=function(e){var t=p(),n=J(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},l.nfcall=function(e){var t=J(arguments,1);return l(e).nfapply(t)},h.prototype.nfcall=function(){var e=J(arguments),t=p();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},l.nfbind=l.denodeify=function(e){var t=J(arguments,1);return function(){var n=t.concat(J(arguments)),r=p();return n.push(r.makeNodeResolver()),l(e).fapply(n).fail(r.reject),r.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=J(arguments);return e.unshift(this),l.denodeify.apply(void 0,e)},l.nbind=function(e,t){var n=J(arguments,2);return function(){function r(){return e.apply(t,arguments)}var i=n.concat(J(arguments)),a=p();return i.push(a.makeNodeResolver()),l(r).fapply(i).fail(a.reject),a.promise}},h.prototype.nbind=function(){var e=J(arguments,0);return e.unshift(this),l.nbind.apply(void 0,e)},l.nmapply=l.npost=function(e,t,n){return l(e).npost(t,n)},h.prototype.nmapply=h.prototype.npost=function(e,t){var n=J(t||[]),r=p();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},l.nsend=l.nmcall=l.ninvoke=function(e,t){var n=J(arguments,2),r=p();return n.push(r.makeNodeResolver()),l(e).dispatch("post",[t,n]).fail(r.reject),r.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var t=J(arguments,1),n=p();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},l.nodeify=q,h.prototype.nodeify=function(e){return e?void this.then(function(t){l.nextTick(function(){e(null,t)})},function(t){l.nextTick(function(){e(t)})}):this};var ot=u();return l}),function(e,t){var n=function(){return t(e)};"object"==typeof exports&&"object"==typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):breeze=n()}(this,function(e){function t(e,t){for(var n in e)it(e,n)&&t(n,e[n])}function n(e,t){var n=[];for(var r in e)if(it(e,r)){var i=t?t(r,e[r]):e[r];void 0!==i&&n.push(i)}return n}function r(e,t){for(var n in e)if(it(e,n)){var r=e[n];if(t(n,r))return{key:n,value:r}}return null}function i(e,t){var n=a(e,t);return null==n?!0:!(!n.writable&&!n.set)}function a(e,t){if(!ot)return null;if(e.hasOwnProperty(t))return Object.getOwnPropertyDescriptor(e,t);var n=Object.getPrototypeOf(e);return null==n?null:a(n,t)}function o(e,t){return function(n){return n[e]===t}}function s(e){return function(t){return t[e]}}function u(e){var t=[];for(var n in e)it(e,n)&&t.push(e[n]);return t}function c(e,t,n){if(!t)return e;if(n)n.forEach(function(n){e[n]=t[n]});else for(var r in t)it(t,r)&&(e[r]=t[r]);return e}function l(e,t){for(var n in t)void 0===e[n]&&(e[n]=t[n]);return e}function p(e,t){return t.defaultInstance=l(new t(e),t.defaultInstance),e}function f(e,t,n){n=n||{};for(var r in t){var i=r.split(","),a=t[r];i.some(function(t){if(!(t in e))return!1;var r=e[t];return"function"==typeof r?!1:r==a?!0:Array.isArray(r)&&0===r.length?!0:("function"==typeof a?r=a(r):"object"==typeof r&&r&&r.parentEnum&&(r=r.name),void 0===r?!0:(n[i[0]]=r,!0))})}return n}function d(e,t){if(e!==Object(e))return e;if(e._$visited)return void 0;if(e.toJSON){var n=e.toJSON();if(n!==Object(n))return n;if(n!==e)return d(n);e=n}e._$visited=!0;var r;if(e instanceof Array)r=e.map(function(e){return d(e,t)});else if("function"==typeof e)r=void 0;else{r={};for(var i in e)if("_$visited"!==i){var a=e[i];t&&(a=t(i,a),void 0===a)||(a=d(a),void 0!==a&&(r[i]=a))}}return delete e._$visited,r}function h(e,t){var n={},r=e.length;return t.forEach(function(t){for(var i=0;r>i;i++){var a=e[i];if(a){var o=a[t];if(void 0!==o){n[t]=o;break}}}}),n}function y(e){return null==e?[]:Array.isArray(e)?e:[e]}function v(e,t,n){if(n=null==n?!0:n,null==e)return e;var r;return Array.isArray(e)?(r=[],e.forEach(function(e,i){var a=t(e,i);(null!=a||n)&&(r[i]=a)})):r=t(e),r}function m(e,t){for(var n=0,r=e.length;r>n;n++)if(t(e[n]))return e[n];return null}function g(e,t){for(var n=0,r=e.length;r>n;n++)if(t(e[n]))return n;return-1}function b(e,t){var n=e.indexOf(t);-1===n&&e.push(t)}function w(e,t,n){for(var r=j(t)?t:void 0,i=e.length-1,a=!1,o=i;o>=0;o--)if((r?r(e[o]):e[o]===t)&&(e.splice(o,1),a=!0,!n))return!0;return a}function S(e,t,n){for(var r=[],i=Math.min(e.length,t.length),a=0;i>a;++a)r.push(n(e[a],t[a]));return r}function E(e,t,n){if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var r=0;r<e.length;r++)if(Array.isArray(e[r])){if(!E(e[r],t[r]))return!1}else if(n){if(!n(e[r],t[r]))return!1}else if(e[r]!==t[r])return!1;return!0}function T(e,t){var n=e[t];return n||(n=[],e[t]=n),n}function x(e,t){for(var n=e.split(";"),r=0,i=n.length;i>r;r++){var a=P(n[r]);if(a)return a}if(t)throw new Error("Unable to initialize "+e+".  "+t)}function P(t){var n=e.window;if(n){var r=n[t];if(r)return r;var i=n.require;if(i){if(i.defined)return i.defined(t)?i(t):void 0;try{return i(t)}catch(a){return}}}}function _(e,t,n,r){var i=e[t];if(n===i)return r();e[t]=n;try{return r()}finally{void 0===i?delete e[t]:e[t]=i}}function N(e,t,n){var r;try{return r=e(),n()}catch(i){throw"object"==typeof r&&(r.error=i),i}finally{t(r)}}function O(e){return function(){for(var t=at(arguments),n="",r=t.length,i=null;r--;)i=t[r],n+=i===Object(i)?JSON.stringify(i):i,e.memoize||(e.memoize={});return n in e.memoize?e.memoize[n]:e.memoize[n]=e.apply(this,t)}}function A(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,n="x"==e?t:3&t|8;return n.toString(16)})}function C(e){if("string"!=typeof e)throw new Error("Invalid ISO8601 duration '"+e+"'");var t=/^P((\d+Y)?(\d+M)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(e);if(!t)throw new Error("Invalid ISO8601 duration '"+e+"'");for(var n=[2,3,4,6,7,8],r=[31104e3,2592e3,86400,3600,60,1],i=0,a=0;6>a;a++){var o=t[n[a]];o=o?+o.replace(/[A-Za-z]+/g,""):0,i+=o*r[a]}return i}function k(){}function F(e){return e}function D(e){return null===e?"null":void 0===e?"undefined":Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function I(e){return"date"===D(e)&&!isNaN(e.getTime())}function M(e){var t=/^((\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z)))$/;return"string"==typeof e&&t.test(e)}function j(e){return"function"===D(e)}function V(e){return"string"==typeof e}function R(e){return"object"==typeof e}function q(e){return"string"==typeof e&&/[a-fA-F\d]{8}-(?:[a-fA-F\d]{4}-){3}[a-fA-F\d]{12}/.test(e)}function B(e){return"string"==typeof e&&/^(-|)?P[T]?[\d\.,\-]+[YMDTHS]/.test(e)}function K(e){if(null===e||void 0===e)return!0;for(var t in e)if(it(e,t))return!1;return!0}function U(e){return!isNaN(parseFloat(e))&&isFinite(e)}function z(e,t){return e?""==t||null==t?!0:0===e.indexOf(t,0):!1}function L(e,t){return e?""==t||null==t?!0:-1!==e.indexOf(t,e.length-t.length):!1}function $(e){var t=arguments,n=RegExp("%([1-"+(arguments.length-1)+"])","g");return e.replace(n,function(e,n){return t[n]})}function G(e){var t=Function.call;return function(){return t.apply(e,arguments)}}function H(e,t,n){void 0===t&&(t=null);var r=n(),i=e.dataType;if(i&&i.parse&&(t=Array.isArray(t)&&!e.isScalar?t.map(function(e){return i.parse(e,typeof e)}):i.parse(t,typeof t)),!(t===r||i&&i.isDate&&t&&r&&t.valueOf()===r.valueOf())){var a,o=this.entityAspect;if(o)a=e.name;else{var s=this.complexAspect;if(!s)return void n(t);o=s.getEntityAspect(),a=s.getPropertyPath(e.name)}var u=o._inProcess=o._inProcess||[];if(!(u.indexOf(e)>=0)){u.push(e);try{var c={parent:this,property:e,newValue:t,oldValue:r,propertyName:a,entityAspect:o};e.isComplexProperty?Q(c,n):e.isDataProperty?J(c,n):W(c,n),Z(c)}finally{u.pop()}}}}function J(e,t){var n=e.parent,r=e.property,i=e.entityAspect,a=e.oldValue,o=e.newValue,s=i.entityManager,u=n.entityType;if(!r.isScalar)throw new Error("Nonscalar data properties are readonly - items may be added or removed but the collection may not be changed.");if(i.entityState.isUnchangedOrModified()){var c=r.name,l=n.entityAspect||n.complexAspect;void 0===l.originalValues[c]&&(l.originalValues[c]=void 0!==a?a:r.defaultValue)}if(r.isPartOfKey&&s&&!s.isLoading){var p=u.keyProperties,f=p.map(function(e){return e===r?o:n.getProperty(e.name)}),d=new Tt(u,f);if(s.findEntityByKey(d))throw new Error("An entity with this key is already in the cache: "+d.toString());var h=n.entityAspect.getKey(),y=s._findEntityGroup(u);y._replaceKey(h,d)}var v=r.relatedNavigationProperty;if(v&&s)if(null!=o){var m=new Tt(v.entityType,[o]),g=s.findEntityByKey(m);g?n.setProperty(v.name,g):(s._unattachedChildrenMap.addChild(m,v,n),n.setProperty(v.name,null))}else n.setProperty(v.name,null);else if(r.inverseNavigationProperty&&s&&!s._inKeyFixup){var b=r.inverseNavigationProperty;if(null!=a&&(m=new Tt(b.parentType,[a]),g=s.findEntityByKey(m)))if(b.isScalar)g.setProperty(b.name,null);else{var w=g.getProperty(b.name);w.splice(w.indexOf(n),1)}null!=o&&(m=new Tt(b.parentType,[o]),g=s.findEntityByKey(m),g?b.isScalar?g.setProperty(b.name,n):g.getProperty(b.name).push(n):s._unattachedChildrenMap.addChild(m,b,n))}if(t(o),X(e),r.isPartOfKey){var S=u.keyProperties.indexOf(r);u.navigationProperties.forEach(function(e){var t=e.inverse,r=t?t.foreignKeyNames:e.invForeignKeyNames;if(0!==r.length){var i=n.getProperty(e.name),a=r[S];if(e.isScalar){if(!i)return;i.setProperty(a,o)}else i.forEach(function(e){e.setProperty(a,o)})}}),s&&u.inverseForeignKeyProperties.forEach(function(e){null==e.relatedNavigationProperty.inverse&&s._updateFkVal(e,a,o)}),i.getKey(!0)}}function Q(e,t){var n=e.property,r=e.oldValue,i=e.newValue,a=n.dataType;if(!n.isScalar)throw new Error($("You cannot set the non-scalar complex property: '%1' on the type: '%2'.Instead get the property and use array functions like 'push' or 'splice' to change its contents.",n.name,n.parentType.name));if(!i)throw new Error($("You cannot set the '%1' property to null because it's datatype is the ComplexType: '%2'",n.name,n.dataType.name));if(!r){var o=a.getCtor();r=new o,t(r)}a.dataProperties.forEach(function(e){var t=e.name,n=i.getProperty(t);r.setProperty(t,n)})}function W(e,t){var n=e.parent,r=e.property,i=e.entityAspect,a=e.oldValue,o=e.newValue;if(!r.isScalar)throw new Error("Nonscalar navigation properties are readonly - entities can be added or removed but the collection may not be changed.");var s=i.entityManager,u=r.inverse;if(null!=o){var c=o.entityAspect;if(s){if(c.entityState.isDetached())s.isLoading||s.attachEntity(o,xt.Added);else if(c.entityManager!==s)throw new Error("An Entity cannot be attached to an entity in another EntityManager. One of the two entities must be detached first.")}else c&&c.entityManager&&(s=c.entityManager,s.isLoading||s.attachEntity(i.entity,xt.Added))}if(u)if(u.isScalar)null!=a&&a.setProperty(u.name,null),null!=o&&o.setProperty(u.name,n);else{if(null!=a){var l=a.getProperty(u.name),p=l.indexOf(n);-1!==p&&l.splice(p,1)}if(null!=o){var f=o.getProperty(u.name);f.push(n)}}else if(r.invForeignKeyNames&&s&&!s._inKeyFixup){var d=r.invForeignKeyNames;if(null!=o){var h=n.entityAspect.getKey().values;d.forEach(function(e,t){o.setProperty(e,h[t])})}else null!=a&&d.forEach(function(e){var t=a.entityType.getProperty(e);t.isPartOfKey||a.setProperty(e,null)})}if(t(o),X(e),r.relatedDataProperties){var y=i.entityState;if(null==o&&(y.isDetached()||a.entityAspect.entityState.isDetached()))return;if(y.isDeleted())return;var v=r.entityType.keyProperties;v.forEach(function(e,t){var i=r.relatedDataProperties[t];if(o||!i.isPartOfKey){var a=o?o.getProperty(e.name):i.defaultValue;n.setProperty(i.name,a)}})}}function Z(e){var t=e.entityAspect,n=t.entityManager,r=t.entity,i={entity:r,parent:e.parent,property:e.property,propertyName:e.propertyName,oldValue:e.oldValue,newValue:e.newValue};n?n.isLoading||n.isRejectingChanges||(t.propertyChanged.publish(i),n.entityChanged.publish({entityAction:wt.PropertyChange,entity:r,args:i})):t.propertyChanged.publish(i)}function X(e){var t=e.entityAspect,n=t.entityManager;if(null!=n&&!n.isLoading){var r=e.property;t.entityState.isUnchanged()&&!r.isUnmapped&&t.setModified(),n.validationOptions.validateOnPropertyChange&&t._validateProperty(e.newValue,{entity:t.entity,property:r,propertyName:e.propertyName,oldValue:e.oldValue})}}function Y(e){return e.indexOf(":#")>=0}function et(e,t){return e+":#"+t}function tt(e,t,n){if(t)if(Array.isArray(t))t.forEach(e._addPropertyCore.bind(e));else{if("object"!=typeof t)throw new Error("The 'dataProperties' or 'navigationProperties' values must be either an array of data/nav properties or an object where each property defines a data/nav property");for(var r in t)if(it(t,r)){var i=t[r];i.name=r;var a=new n(i);e._addPropertyCore(a)}}}function nt(e,t){var n=Array.isArray(t)?t:t.split(".");if(1===n.length)return e.getProperty(t);var r=e;return n.some(function(e){return r=r.getProperty(e),null==r}),r}var rt={version:"1.5.3",metadataVersion:"1.0.5"},it=G(Object.prototype.hasOwnProperty),at=G(Array.prototype.slice),ot=function(){try{return!(!Object.getPrototypeOf||!Object.defineProperty({},"x",{}))}catch(e){return!1}}();Object.create||(Object.create=function(e){var t=function(){};return t.prototype=e,new t});var st={};st.__isES5Supported=ot,st.objectForEach=t,st.extend=c,st.propEq=o,st.pluck=s,st.arrayEquals=E,st.arrayFirst=m,st.arrayIndexOf=g,st.arrayRemoveItem=w,st.arrayZip=S,st.requireLib=x,st.using=_,st.memoize=O,st.getUuid=A,st.durationToSeconds=C,st.isDate=I,st.isGuid=q,st.isDuration=B,st.isFunction=j,st.isEmpty=K,st.isNumeric=U,st.stringStartsWith=z,st.stringEndsWith=L,st.formatString=$,st.getPropertyDescriptor=a,st.toJSONSafe=d,st.parent=rt,rt.core=st;var ut=function(){function e(e,t){return null==t?!1:"string"==typeof t&&t.length>0}function t(e,t){return null==t?!1:typeof t===e.typeName?!0:!1}function n(e,t){return null==t?!1:t instanceof e.type}function r(e,t){return null==t?!1:void 0!==t[e.propertyName]}function i(e,t){return null==t?!1:e.enumType.contains(t)}function a(e,t){return e.allowNull?void 0!==t:null!=t}function o(e,t){if(null==t)return!0;var n=e.prevContext;return n?n.fn(n,t):!0}function s(e,t){var n=e.prevContext,r=n?" or it "+p(n,t):"";return"is optional"+r}function u(e,t){if(!Array.isArray(t))return!1;if(e.mustNotBeEmpty&&0===t.length)return!1;var n=e.prevContext;return n?t.every(function(e){return n.fn(n,e)}):!0}function l(e,t){var n=e.mustNotBeEmpty?"a nonEmpty array":"an array",r=e.prevContext,i=r?" where each element "+p(r,t):"";return" must be "+n+i}function p(e,t){var n=e.msg;return"function"==typeof n&&(n=n(e,t)),n}function f(e,t){if(e._context){for(var n=e._context;null!=n.prevContext;)n=n.prevContext;if(null===n.prevContext)return n.prevContext=t,e;if(null!=t.prevContext)throw new Error("Illegal construction - use 'or' to combine checks");t.prevContext=e._context}return d(e,t)}function d(e,t){return e._contexts[e._contexts.length-1]=t,e._context=t,e}function h(e){var t=e._contexts;return null==t[t.length-1]&&t.pop(),0===t.length?void 0:t.some(function(t){return t.fn(t,e.v)})}function y(e,t){throw new Error($("Error configuring an instance of '%1'. %2",e&&e._$typeName||"object",t))}var v=function(e,t){this.v=e,this.name=t,this._contexts=[null]},m=v.prototype;return m.isObject=function(){return this.isTypeOf("object")},m.isBoolean=function(){return this.isTypeOf("boolean")},m.isString=function(){return this.isTypeOf("string")},m.isNonEmptyString=function(){return f(this,{fn:e,msg:"must be a nonEmpty string"})},m.isNumber=function(){return this.isTypeOf("number")},m.isFunction=function(){return this.isTypeOf("function")},m.isTypeOf=function(e){return f(this,{fn:t,typeName:e,msg:$("must be a '%1'",e)})},m.isInstanceOf=function(e,t){return t=t||e.prototype._$typeName,f(this,{fn:n,type:e,typeName:t,msg:$("must be an instance of '%1'",t)})},m.hasProperty=function(e){return f(this,{fn:r,propertyName:e,msg:$("must have a '%1' property ",e)})},m.isEnumOf=function(e){return f(this,{fn:i,enumType:e,msg:$("must be an instance of the '%1' enumeration",e.name)})},m.isRequired=function(e){return f(this,{fn:a,allowNull:e,msg:"is required"})},m.isOptional=function(){var e={fn:o,prevContext:null,msg:s};return f(this,e)},m.isNonEmptyArray=function(){return this.isArray(!0)},m.isArray=function(e){var t={fn:u,mustNotBeEmpty:e,prevContext:null,msg:l};return f(this,t)},m.or=function(){return this._contexts.push(null),this._context=null,this},m.check=function(e){var t=h(this);if(void 0!==t){if(!t)throw new Error(this.getMessage());return void 0!==this.v?this.v:e}},m._addContext=function(e){return f(this,e)},m.getMessage=function(){var e=this,t=this._contexts.map(function(t){return p(t,e.v)}).join(", or it ");return $(this.MESSAGE_PREFIX,this.name)+" "+t},m.withDefault=function(e){return this.defaultValue=e,this},m.whereParam=function(e){return this.parent.whereParam(e)},m.applyAll=function(e,t){var n=e._$typeName,r=n&&this.parent.config._$typeName===n,i=c({},this.parent.config);if(this.parent.params.forEach(function(n){r||delete i[n.name];try{n.check()}catch(a){y(e,a.message)}!t&&n._applyOne(e)}),!r)for(var a in i)void 0!==i[a]&&y(e,$("Unknown property: '%1'.",a))},m._applyOne=function(e){void 0!==this.v?e[this.name]=this.v:void 0!==this.defaultValue&&(e[this.name]=this.defaultValue)},m.MESSAGE_PREFIX="The '%1' parameter ",v}(),ct=function(e,t){return new ut(e,t)},lt=function(){var e=function(e){if("object"!=typeof e)throw new Error("Configuration parameter should be an object, instead it is a: "+typeof e);this.config=e,this.params=[]},t=e.prototype;return t.whereParam=function(e){var t=new ut(this.config[e],e);return t.parent=this,this.params.push(t),t},e}(),pt=function(e){return new lt(e)};st.Param=ut,st.assertParam=ct,st.assertConfig=pt;var ft=function(){function e(){}var t=function(t,n){this.name=t;var r=new e(n);r.parentEnum=this,this._symbolPrototype=r,n&&Object.keys(n).forEach(function(e){r[e]=n[e]})},n=t.prototype;return t.isSymbol=function(t){return t instanceof e},n.fromName=function(e){return this[e]},n.addSymbol=function(e){var t=Object.create(this._symbolPrototype);return e&&Object.keys(e).forEach(function(n){t[n]=e[n]}),setTimeout(function(){t.getName()},0),t},n.resolveSymbols=function(){this.getSymbols().forEach(function(e){return e.getName()})},n.getSymbols=function(){return this.getNames().map(function(e){return this[e]},this)},n.getNames=function(){var e=[];for(var t in this)this.hasOwnProperty(t)&&("name"===t||"_"===t.substr(0,1)||j(this[t])||e.push(t));return e},n.contains=function(t){return t instanceof e?this[t.getName()]===t:!1},e.prototype.getName=function(){if(!this.name){var e=this;this.name=m(this.parentEnum.getNames(),function(t){return e.parentEnum[t]===e})}return this.name},e.prototype.toString=function(){return this.getName()},e.prototype.toJSON=function(){return{_$typeName:this.parentEnum.name,name:this.name}},t}();st.Enum=ft;var dt=function(){function e(e,n,r){var i=e._subscribers;return i?void i.forEach(function(i){try{i.callback(n)}catch(a){a.context="unable to publish on topic: "+e.name,r?r(a):e._defaultErrorCallback?e._defaultErrorCallback(a):t(a)}}):!0}function t(){}var n={},r=1,i=function(e,t,r){ct(e,"eventName").isNonEmptyString().check(),ct(t,"publisher").isObject().check(),this.name=e,n[e]=!0,this.publisher=t,r&&(this._defaultErrorCallback=r)},a=i.prototype;return a.publish=function(t,n,r){return i._isEnabled(this.name,this.publisher)?(n===!0?setTimeout(e,0,this,t,r):e(this,t,r),!0):!1},a.publishAsync=function(e,t){this.publish(e,!0,t)},a.subscribe=function(e){this._subscribers||(this._subscribers=[]);var t=r;return this._subscribers.push({unsubKey:t,callback:e}),++r,t},a.unsubscribe=function(e){if(!this._subscribers)return!1;var t=this._subscribers,n=g(t,function(t){return t.unsubKey===e});return-1!==n?(t.splice(n,1),0===t.length&&(this._subscribers=null),!0):!1},a.clear=function(){this._subscribers=null},i.bubbleEvent=function(e,t){e._getEventParent=t},i.enable=function(e,t,n){ct(e,"eventName").isNonEmptyString().check(),ct(t,"obj").isObject().check(),ct(n,"isEnabled").isBoolean().isOptional().or().isFunction().check(),t._$eventMap||(t._$eventMap={}),t._$eventMap[e]=n},i.isEnabled=function(e,t){if(ct(e,"eventName").isNonEmptyString().check(),ct(t,"obj").isObject().check(),void 0===t._getEventParent)throw new Error("This object does not support event enabling/disabling");return i._isEnabled(t,e)},i._isEnabled=function(e,t){var n=null,r=t._$eventMap;if(r&&(n=r[e]),null!=n)return"function"==typeof n?n(t):!!n;var a=t._getEventParent&&t._getEventParent();return a?i._isEnabled(e,a):!0},i}();st.Event=dt;var ht=function(){function e(e,t,n){var r=t.defaultInstance;return r||(r=new t.ctor,t.defaultInstance=r,r._$impl=t),r.initialize(),n&&(e.defaultInstance=r),i.interfaceInitialized.publish({interfaceName:e.name,instance:r,isDefault:!0}),r.checkForRecomposition&&i.interfaceInitialized.subscribe(function(e){r.checkForRecomposition(e)}),r}function t(e){var t=e.toLowerCase(),n=r(i.interfaceRegistry||{},function(e){return e.toLowerCase()===t});if(!n)throw new Error("Unknown interface name: "+e);return n.value}var i={};i.functionRegistry={},i.typeRegistry={},i.objectRegistry={},i.interfaceInitialized=new dt("interfaceInitialized",i);var a=function(e){this.name=e,this.defaultInstance=null,this._implMap={}};return a.prototype.registerCtor=function(e,t){this._implMap[e.toLowerCase()]={ctor:t,defaultInstance:null}},a.prototype.getImpl=function(e){return this._implMap[e.toLowerCase()]},a.prototype.getFirstImpl=function(){var e=r(this._implMap,function(){return!0});return e?e.value:null},i.interfaceRegistry={ajax:new a("ajax"),modelLibrary:new a("modelLibrary"),dataService:new a("dataService"),uriBuilder:new a("uriBuilder")},i.interfaceRegistry.modelLibrary.getDefaultInstance=function(){if(!this.defaultInstance)throw new Error("Unable to locate the default implementation of the '"+this.name+"' interface.  Possible options are 'ko', 'backingStore' or 'backbone'. See the breeze.config.initializeAdapterInstances method.");return this.defaultInstance},i.setProperties=function(e){pt(e).whereParam("remoteAccessImplementation").isOptional().whereParam("trackingImplementation").isOptional().whereParam("ajaxImplementation").isOptional().applyAll(e),e.remoteAccessImplementation&&i.initializeAdapterInstance("dataService",e.remoteAccessImplementation),e.trackingImplementation&&i.initializeAdapterInstance("modelLibrary",e.trackingImplementation),e.ajaxImplementation&&i.initializeAdapterInstance("ajax",e.ajaxImplementation)},i.registerAdapter=function(e,n){ct(e,"interfaceName").isNonEmptyString().check(),ct(n,"adapterCtor").isFunction().check();var r=new n,i=r.name;if(!i)throw new Error("Unable to locate a 'name' property on the constructor passed into the 'registerAdapter' call.");var a=t(e);a.registerCtor(i,n)},i.getAdapter=function(e,n){var r=t(e);if(n){var i=r.getImpl(n);return i?i.ctor:null}return r.defaultInstance?r.defaultInstance._$impl.ctor:null},i.initializeAdapterInstances=function(e){return pt(e).whereParam("dataService").isOptional().whereParam("modelLibrary").isOptional().whereParam("ajax").isOptional().whereParam("uriBuilder").isOptional().applyAll(this,!1),n(e,i.initializeAdapterInstance)},i.initializeAdapterInstance=function(n,r,i){i=void 0===i?!0:i,ct(n,"interfaceName").isNonEmptyString().check(),ct(r,"adapterName").isNonEmptyString().check(),ct(i,"isDefault").isBoolean().check();var a=t(n),o=a.getImpl(r);if(!o)throw new Error("Unregistered adapter.  Interface: "+n+" AdapterName: "+r);return e(a,o,i)},i.getAdapterInstance=function(n,r){var i,a=t(n),o=null==r||""==r;if(o){if(a.defaultInstance)return a.defaultInstance;i=a.getFirstImpl()}else i=a.getImpl(r);return i?i.defaultInstance?i.defaultInstance:e(a,i,o):null},i.registerFunction=function(e,t){ct(e,"fn").isFunction().check(),ct(t,"fnName").isString().check(),e.prototype._$fnName=t,i.functionRegistry[t]=e},i.getRegisteredFunction=function(e){return i.functionRegistry[e]},i._storeObject=function(e,t,n){var r=("string"==typeof t?t:t.prototype._$typeName)+"."+n;i.objectRegistry[r]=e},i._fetchObject=function(e,t){if(!t)return void 0;var n=("string"==typeof e?e:e.prototype._$typeName)+"."+t,r=i.objectRegistry[n];if(!r)throw new Error("Unable to locate a registered object by the name: "+n);return r},i.registerType=function(e,t){ct(e,"ctor").isFunction().check(),ct(t,"typeName").isString().check(),e.prototype._$typeName=t,i.typeRegistry[t]=e},i.stringifyPad="",i}(),yt=ht.interfaceRegistry.modelLibrary;st.config=ht,rt.config=ht;var vt=function(){function e(e){var t=e.getEntityAspect();t.entityState.isUnchanged()&&t.setModified(),t.entityState.isModified()&&!e._origValues&&(e._origValues=e.slice(0))}function t(e,t){e._processAdds(t),r(e,"arrayChanged",{array:e,added:t})}function n(e,t){e._processRemoves(t),r(e,"arrayChanged",{array:e,removed:t})}function r(e,t,n){var r=e._getPendingPubs();r?e._pendingArgs?i(e._pendingArgs,n):(e._pendingArgs=n,r.push(function(){e[t].publish(e._pendingArgs),e._pendingArgs=null})):e[t].publish(n)}function i(e,t){for(var n in t)if("array"!==n&&e.hasOwnProperty(n)){var r=t[n],i=e[n];if(i){if(!Array.isArray(i))throw new Error("Cannot combine non array args");Array.prototype.push.apply(i,r)}else e[n]=r}}function a(e,t,n){e.parent=t,e.parentProperty=n}var o={};return o.push=function(){if(this._inProgress)return-1;var e=this._getGoodAdds(at(arguments));if(!e.length)return this.length;this._beforeChange();var n=Array.prototype.push.apply(this,e);return t(this,e),n},o._push=function(){if(this._inProgress)return-1;var e=at(arguments);this._beforeChange();var n=Array.prototype.push.apply(this,e);return t(this,e),n},o.unshift=function(){var e=this._getGoodAdds(at(arguments));if(!e.length)return this.length;this._beforeChange();var n=Array.prototype.unshift.apply(this,e);return t(this,at(e)),n},o.pop=function(){this._beforeChange();var e=Array.prototype.pop.apply(this);return n(this,[e]),e},o.shift=function(){this._beforeChange();var e=Array.prototype.shift.apply(this);return n(this,[e]),e},o.splice=function(){var e=this._getGoodAdds(at(arguments,2)),r=at(arguments,0,2).concat(e);this._beforeChange();var i=Array.prototype.splice.apply(this,r);return n(this,i),e.length&&t(this,e),i},o.getEntityAspect=function(){return this.parent.entityAspect||this.parent.complexAspect.getEntityAspect()},o._getEventParent=function(){return this.getEntityAspect()},o._getPendingPubs=function(){var e=this.getEntityAspect().entityManager;return e&&e._pendingPubs},o._beforeChange=function(){},{mixin:o,publish:r,updateEntityState:e,initializeParent:a}}(),mt=function(){function e(e,t,n,r,i){for(r=+e[t=e.length-1],i=0;t--;)n=+e[t],r+=++i%2?2*n%10+(n>4):n;return!(r%10)}function n(e,t,n,r){n&&(d.messageTemplates[e]=n);
var i="string"==typeof t?new RegExp(t):t,a=function(e){return null==e||""===e?!0:"string"!=typeof e?!1:i.test(e)};return new d(e,a,r)}function r(e,t,n){return t?e.replace(/%([^%]+)%/g,function(e,r){var i;return i=n?t.hasOwnProperty(r)?t[r]:"":t[r],null!=i?j(i)?i(t):i:""}):e}function i(e,t,n,r){var i=r&&r.messageTemplate||d.messageTemplates[e];return i||(d.messageTemplates[e]=$("'%displayName%' must be an integer between the values of %1 and %2",t,n)),function(){var i=function(e,r){return null==e?!0:("string"==typeof e&&r&&r.allowString&&(e=parseInt(e,0)),"number"!=typeof e||isNaN(e)||Math.floor(e)!==e?!1:null!=t&&t>e?!1:null!=n&&e>n?!1:!0)};return new d(e,i,r)}}var a=-32768,o=32767,s=-2147483648,u=2147483647,l=0,p=255,f={displayName:function(e){return e.property?e.property.resolveProperty("displayName")||e.propertyName||e.property.name:"Value"}},d=function(e,t,n){this._baseContext=n||{},this._baseContext.name=e,n=c(Object.create(f),this._baseContext),n.messageTemplate=n.messageTemplate||d.messageTemplates[e],this.name=e,this.valFn=t,this.context=n},h=d.prototype;return h._$typeName="Validator",h.validate=function(e,t){var n;n=t?c(Object.create(this.context),t):this.context,this.currentContext=n;try{return this.valFn(e,n)?null:(n.value=e,new gt(this,n,this.getMessage()))}catch(r){return new gt(this,n,"Exception occured while executing this validator: "+this.name)}},h.getMessage=function(){try{var e=this.currentContext,t=e.message;return t?"function"==typeof t?t(e):t:e.messageTemplate?r(e.messageTemplate,e):"invalid value: "+(this.name||"{unnamed validator}")}catch(n){return"Unable to format error message"+n.toString()}},h.toJSON=function(){return this._baseContext},d.fromJSON=function(e){if(Array.isArray(e))return e.map(function(e){return d.fromJSON(e)});var t="Validator."+e.name,n=ht.getRegisteredFunction(t);if(!n)throw new Error("Unable to locate a validator named:"+e.name);return n(e)},d.register=function(e){ht.registerFunction(function(){return e},"Validator."+e.name)},d.registerFactory=function(e,t){ht.registerFunction(e,"Validator."+t)},d.messageTemplates={bool:"'%displayName%' must be a 'true' or 'false' value",creditCard:"The %displayName% is not a valid credit card number",date:"'%displayName%' must be a date",duration:"'%displayName%' must be a ISO8601 duration string, such as 'P3H24M60S'",emailAddress:"The %displayName% '%value%' is not a valid email address",guid:"'%displayName%' must be a GUID",integer:"'%displayName%' must be an integer",integerRange:"'%displayName%' must be an integer between the values of %minValue% and %maxValue%",maxLength:"'%displayName%' must be a string with %maxLength% characters or less",number:"'%displayName%' must be a number",phone:"The %displayName% '%value%' is not a valid phone number",regularExpression:"The %displayName% '%value%' does not match '%expression%'",required:"'%displayName%' is required",string:"'%displayName%' must be a string",stringLength:"'%displayName%' must be a string with between %minLength% and %maxLength% characters",url:"The %displayName% '%value%' is not a valid url"},d.required=function(e){var t=function(e,t){return"string"==typeof e?t&&t.allowEmptyStrings?!0:e.length>0:null!=e};return new d("required",t,e)},d.maxLength=function(e){var t=function(e,t){return null==e?!0:"string"!=typeof e?!1:e.length<=t.maxLength};return new d("maxLength",t,e)},d.stringLength=function(e){var t=function(e,t){return null==e?!0:"string"!=typeof e?!1:null!=t.minLength&&e.length<t.minLength?!1:null!=t.maxLength&&e.length>t.maxLength?!1:!0};return new d("stringLength",t,e)},d.string=function(){var e=function(e){return null==e?!0:"string"==typeof e};return new d("string",e)},d.guid=function(){var e=function(e){return null==e?!0:q(e)};return new d("guid",e)},d.duration=function(){var e=function(e){return null==e?!0:B(e)};return new d("duration",e)},d.number=d["double"]=d.single=function(e){var t=function(e,t){return null==e?!0:("string"==typeof e&&t&&t.allowString&&(e=parseFloat(e,10)),"number"==typeof e&&!isNaN(e))};return new d("number",t,e)},d.integer=d.int64=function(e){var t=function(e,t){return null==e?!0:("string"==typeof e&&t&&t.allowString&&(e=parseInt(e,10)),"number"==typeof e&&!isNaN(e)&&Math.floor(e)===e)};return new d("integer",t,e)},d.int32=function(e){return i("int32",s,u,e)()},d.int16=function(e){return i("int16",a,o,e)()},d["byte"]=function(e){return i("byte",l,p,e)()},d.bool=function(){var e=function(e){return null==e?!0:e===!0||e===!1};return new d("bool",e)},d.none=function(){var e=function(){return!0};return new d("none",e)},d.date=function(){var e=function(e){if(null==e)return!0;if("string"!=typeof e)return I(e);try{return!isNaN(Date.parse(e))}catch(t){return!1}};return new d("date",e)},d.creditCard=function(t){function n(t){return null==t||""===t?!0:"string"!=typeof t?!1:(t=t.replace(/(\-|\s)/g,""),!t||/\D/.test(t)?!1:e(t))}return new d("creditCard",n,t)},d.regularExpression=function(e){function t(e,t){if(null==e||""===e)return!0;if("string"!=typeof e)return!1;try{var n=new RegExp(t.expression)}catch(r){throw new Error("Missing or invalid expression parameter to regExp validator")}return n.test(e)}return new d("regularExpression",t,e)},d.emailAddress=function(e){var t=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;return n("emailAddress",t,null,e)},d.phone=function(e){var t=/^((\+|(0(\d+)?[-/.\s]?))[1-9]\d{0,2}[-/.\s]?)?((\(\d{1,6}\)|\d{1,6})[-/.\s]?)?(\d+[-/.\s]?)+\d+$/;return n("phone",t,null,e)},d.url=function(e){var t=/^(https?|ftp):\/\/(((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|([a-zA-Z][\-a-zA-Z0-9]*)|((([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-zA-Z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-zA-Z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-fA-F]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/;return n("url",t,null,e)},d.makeRegExpValidator=n,t(d,function(e,t){"function"==typeof t&&"fromJSON"!==e&&"register"!==e&&"registerFactory"!==e&&"makeRegExpValidator"!==e&&ht.registerFunction(t,"Validator."+e)}),d}(),gt=function(){var e=function t(e,n,r,i){ct(e,"validator").isOptional().isInstanceOf(mt).check(),ct(r,"errorMessage").isNonEmptyString().check(),ct(i,"key").isOptional().isNonEmptyString().check(),this.validator=e,n=n||{},this.context=n,this.errorMessage=r,this.property=n.property,this.propertyName=n.propertyName||n.property&&n.property.name,this.key=i?i:t.getKey(e||r,this.propertyName),this.isServerError=!1};return e.getKey=function(e,t){return(e.name||e)+(t?":"+t:"")},e}();rt.Validator=mt,rt.ValidationError=gt;var bt=function(){function e(e,t){return t&&pt(t).whereParam("validateOnAttach").isBoolean().isOptional().whereParam("validateOnSave").isBoolean().isOptional().whereParam("validateOnQuery").isBoolean().isOptional().whereParam("validateOnPropertyChange").isBoolean().isOptional().applyAll(e),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="ValidationOptions",n.using=function(t){if(!t)return this;var n=new bt(this);return e(n,t),n},n.setAsDefault=function(){return p(this,t)},t.defaultInstance=new t({validateOnAttach:!0,validateOnSave:!0,validateOnQuery:!1,validateOnPropertyChange:!0}),t}();rt.ValidationOptions=bt,rt.makeComplexArray=function(){function e(e,t){return t.filter(function(t){return t.parent!==e.parent})}function t(e,t){t.forEach(function(t){if(null!=t.parent)throw new Error("The complexObject is already attached. Either clone it or remove it from its current owner");i(t,e)})}function n(e,t){t.forEach(function(t){r(t,e)})}function r(e,t){var n=e.complexAspect;return n.parent!==t.parent?null:(n.parent=null,n.parentProperty=null,n)}function i(e,t){var n=e.complexAspect;return n.parent===t.parent?null:(n.parent=t.parent,n.parentProperty=t.parentProperty,n)}function a(e,t,n){return vt.initializeParent(e,t,n),e.arrayChanged=new dt("arrayChanged",e),c(e,vt.mixin),c(e,o)}var o={};return o._getGoodAdds=function(t){return e(this,t)},o._beforeChange=function(){vt.updateEntityState(this)},o._processAdds=function(e){t(this,e)},o._processRemoves=function(e){n(this,e)},o._rejectChanges=function(){if(this._origValues){var e=this;this.forEach(function(t){r(t,e)}),this.length=0,this._origValues.forEach(function(t){e.push(t)})}},o._acceptChanges=function(){this._origValues=null},a}();var wt=function(){var e={isAttach:function(){return!!this.isAttach},isDetach:function(){return!!this.isDetach},isModification:function(){return!!this.isModification}},t=new ft("EntityAction",e);return t.Attach=t.addSymbol({isAttach:!0}),t.AttachOnQuery=t.addSymbol({isAttach:!0}),t.AttachOnImport=t.addSymbol({isAttach:!0}),t.Detach=t.addSymbol({isDetach:!0}),t.MergeOnQuery=t.addSymbol({isModification:!0}),t.MergeOnImport=t.addSymbol({isModification:!0}),t.MergeOnSave=t.addSymbol({isModification:!0}),t.PropertyChange=t.addSymbol({isModification:!0}),t.EntityStateChange=t.addSymbol(),t.AcceptChanges=t.addSymbol(),t.RejectChanges=t.addSymbol({isModification:!0}),t.Clear=t.addSymbol({isDetach:!0}),t.resolveSymbols(),t}();rt.EntityAction=wt;var St=function(){function e(t){var n=t.entityAspect||t.complexAspect,r=t.entityType||t.complexType,i=n.originalValues;for(var a in i)t.setProperty(a,i[a]);r.complexProperties.forEach(function(n){var r=t.getProperty(n.name);n.isScalar?e(r):(r._rejectChanges(),r.forEach(e))})}function n(e){var t=e.entityAspect||e.complexAspect;t.originalValues={};var r=e.entityType||e.complexType;r.complexProperties.forEach(function(t){var r=e.getProperty(t.name);t.isScalar?n(r):(r._acceptChanges(),r.forEach(n))})}function r(e,t){var n=!0,i=e.entityType||e.complexType,a=e.entityAspect||e.complexAspect,s=e.entityAspect||e.complexAspect.getEntityAspect(),u={entity:s.entity};return void 0!==t&&(u.index=t),i.getProperties().forEach(function(t){var i=e.getProperty(t.name),o=t.getAllValidators();o.length>0&&(u.property=t,u.propertyName=a.getPropertyPath(t.name),n=s._validateProperty(i,u)&&n),t.isComplexProperty&&(n=t.isScalar?r(i)&&n:i.reduce(function(e,t,n){return r(t,n)&&e},n))}),i.getAllValidators().forEach(function(t){n=o(s,t,e)&&n}),n}function i(e,t){var n=t.isDeleted();n?a(e):_(e.entityAspect.entityManager,"isLoading",!0,function(){a(e)})}function a(e){e.entityType.navigationProperties.forEach(function(t){var n=t.inverse,r=e.getProperty(t.name);if(t.isScalar){if(r){if(n)if(n.isScalar)r.setProperty(n.name,null);else{var i=r.getProperty(n.name);i.length&&w(i,e)}e.setProperty(t.name,null)}}else n&&r.slice(0).forEach(function(e){n.isScalar&&e.setProperty(n.name,null)}),r.length=0})}function o(e,t,n,r){var i=t.validate(n,r);if(i)return e._addValidationError(i),!1;var a=gt.getKey(t,r?r.propertyName:null);return e._removeValidationError(a),!0}var s=function l(e){if(null===e){var t=l._nullInstance;if(t)return t;l._nullInstance=this}else{if(void 0===e)throw new Error("The EntityAspect ctor requires an entity as its only argument.");if(e.entityAspect)return e.entityAspect}if(!(this instanceof l))return new l(e);if(this.entity=e,this.entityGroup=null,this.entityManager=null,this.entityState=xt.Detached,this.isBeingSaved=!1,this.originalValues={},this.hasValidationErrors=!1,this._validationErrors={},this.validationErrorsChanged=new dt("validationErrorsChanged",this),this.propertyChanged=new dt("propertyChanged",this),null!=e){e.entityAspect=this;var n=e.entityType||e._$entityType;if(!n){var r=e.prototype._$typeName;throw new Error(r?"Metadata for this entityType has not yet been resolved: "+r:"This entity is not registered as a valid EntityType")}var i=n.getEntityCtor();yt.getDefaultInstance().startTracking(e,i.prototype)}},c=s.prototype;return dt.bubbleEvent(c,function(){return this.entityManager}),c.getKey=function(e){if(e=ct(e,"forceRefresh").isBoolean().isOptional().check(!1),e||!this._entityKey){var t=this.entity.entityType,n=t.keyProperties,r=n.map(function(e){return this.entity.getProperty(e.name)},this);this._entityKey=new Tt(t,r)}return this._entityKey},c.acceptChanges=function(){this._checkOperation("acceptChanges");var e=this.entityManager;this.entityState.isDeleted()?e.detachEntity(this.entity):this.setUnchanged(),e.entityChanged.publish({entityAction:wt.AcceptChanges,entity:this.entity})},c.rejectChanges=function(){this._checkOperation("rejectChanges");var t=this.entity,n=this.entityManager;_(n,"isRejectingChanges",!0,function(){e(t)}),this.entityState.isAdded()?(n.detachEntity(t),n._notifyStateChange(t,!1)):(this.entityState.isDeleted()&&this.entityManager._linkRelatedEntities(t),this.setUnchanged(),this.propertyChanged.publish({entity:t,propertyName:null}),this.entityManager.entityChanged.publish({entityAction:wt.RejectChanges,entity:t}))},c.getPropertyPath=function(e){return e},c.setAdded=function(){return this.setEntityState(xt.Added)},c.setUnchanged=function(){return this.setEntityState(xt.Unchanged)},c.setModified=function(){return this.setEntityState(xt.Modified)},c.setDeleted=function(){return this.setEntityState(xt.Deleted)},c.setDetached=function(){return this.setEntityState(xt.Detached)},c.setEntityState=function(e){if(this.entityState===e)return!1;if(this._checkOperation("setEntityState"),this.entityState.isDetached())throw new Error("You cannot set the 'entityState' of an entity when it is detached - except by first attaching it to an EntityManager");var t=this.entity,r=this.entityManager,a=!0;if(e===xt.Unchanged)n(t),delete this.hasTempKey,a=!1;else if(e===xt.Added)n(t);else if(e===xt.Deleted){if(this.entityState.isAdded())return this.setEntityState(xt.Detached),!0;this.entityState=xt.Deleted,i(t,xt.Deleted)}else if(e===xt.Modified);else if(e===xt.Detached){var o=this.entityGroup;if(!o)return!1;o.detachEntity(t),this.entityState=e,i(t,xt.Detached),this._detach(),r.entityChanged.publish({entityAction:wt.Detach,entity:t}),a=!1}return this.entityState=e,r._notifyStateChange(t,a),!0},c.loadNavigationProperty=function(e,t,n){var r=this.entity,i=r.entityType._checkNavProperty(e),a=Bt.fromEntityNavigation(r,i),o=r.entityAspect.entityManager.executeQuery(a),s=this;return o.then(function(e){return s._markAsLoaded(i.name),t&&t(e),Ot.resolve(e)},function(e){return n&&n(e),Ot.reject(e)})},c.markNavigationPropertyAsLoaded=function(e){var t=this.entity.entityType._checkNavProperty(e);this._markAsLoaded(t.name)},c.isNavigationPropertyLoaded=function(e){var t=this.entity.entityType._checkNavProperty(e);return t.isScalar&&null!=this.entity.getProperty(t.name)?!0:this._loadedNps&&this._loadedNps.indexOf(t.name)>=0},c._markAsLoaded=function(e){this._loadedNps=this._loadedNps||[],b(this._loadedNps,e)},c.validateEntity=function(){var e=!0;return this._processValidationOpAndPublish(function(t){e=r(t.entity)}),e},c.validateProperty=function(e,t){var n=this.getPropertyValue(e);return n&&n.complexAspect?r(n):(t=t||{},t.entity=this.entity,"string"==typeof e?(t.property=this.entity.entityType.getProperty(e,!0),t.propertyName=e):(t.property=e,t.propertyName=e.name),this._validateProperty(n,t))},c.getValidationErrors=function(e){ct(e,"property").isOptional().isEntityProperty().or().isString().check();var t=u(this._validationErrors);if(e){var n="string"==typeof e?e:e.name;t=t.filter(function(e){return e.property&&(e.property.name===n||-1!=n.indexOf(".")&&e.propertyName==n)})}return t},c.addValidationError=function(e){ct(e,"validationError").isInstanceOf(gt).check(),this._processValidationOpAndPublish(function(t){t._addValidationError(e)})},c.removeValidationError=function(e){ct(e,"validationErrorOrKey").isString().or().isInstanceOf(gt).or().isInstanceOf(mt).check();var t="string"==typeof e?e:e.key;this._processValidationOpAndPublish(function(e){e._removeValidationError(t)})},c.clearValidationErrors=function(){this._processValidationOpAndPublish(function(e){t(e._validationErrors,function(t,n){n&&(delete e._validationErrors[t],e._pendingValidationResult.removed.push(n))}),e.hasValidationErrors=!K(e._validationErrors)})},c.getParentKey=function(e){var t=e.foreignKeyNames;if(0===t.length)return null;var n=this,r=t.map(function(e){return n.entity.getProperty(e)});return new Tt(e.entityType,r)},c.getPropertyValue=function(e){ct(e,"property").isString().or().isEntityProperty().check();var t;if("string"==typeof e){var n=e.trim().split("."),r=n.shift();for(t=this.entity,t=t.getProperty(r);n.length>0;)r=n.shift(),t=t.getProperty(r)}else{if(!(e.parentType instanceof kt))throw new Error("The validateProperty method does not accept a 'property' parameter whose parentType is a ComplexType; Pass a 'property path' string as the 'property' parameter instead ");t=this.entity.getProperty(e.name)}return t},c._checkOperation=function(e){if(this.isBeingSaved)throw new Error("Cannot perform a '"+e+"' on an entity that is in the process of being saved");return this},c._detach=function(){this.entityGroup=null,this.entityManager=null,this.entityState=xt.Detached,this.originalValues={},this._validationErrors={},this.hasValidationErrors=!1,this.validationErrorsChanged.clear(),this.propertyChanged.clear()},c._validateProperty=function(e,t){var n=!0;return this._processValidationOpAndPublish(function(r){t.property.getAllValidators().forEach(function(i){n=o(r,i,e,t)&&n})}),n},c._processValidationOpAndPublish=function(e){if(this._pendingValidationResult)e(this);else try{this._pendingValidationResult={entity:this.entity,added:[],removed:[]},e(this),(this._pendingValidationResult.added.length>0||this._pendingValidationResult.removed.length>0)&&(this.validationErrorsChanged.publish(this._pendingValidationResult),this.entityManager&&this.entityManager.validationErrorsChanged.publish(this._pendingValidationResult))}finally{this._pendingValidationResult=void 0}},c._addValidationError=function(e){this._validationErrors[e.key]=e,this.hasValidationErrors=!0,this._pendingValidationResult.added.push(e)},c._removeValidationError=function(e){var t=this._validationErrors[e];t&&(delete this._validationErrors[e],this.hasValidationErrors=!K(this._validationErrors),this._pendingValidationResult.removed.push(t))},s}(),Et=function(){var e=function n(e,t,r){if(!e)throw new Error("The  ComplexAspect ctor requires an entity as its only argument.");if(e.complexAspect)return e.complexAspect;if(!(this instanceof n))return new n(e,t,r);this.complexObject=e,e.complexAspect=this,this.originalValues={},null!=t&&(this.parent=t,this.parentProperty=r);var i=e.complexType;if(!i){var a=e.prototype._$typeName;throw new Error(a?"Metadata for this complexType has not yet been resolved: "+a:"This entity is not registered as a valid ComplexType")}var o=i.getCtor();yt.getDefaultInstance().startTracking(e,o.prototype)},t=e.prototype;return t.getEntityAspect=function(){var e=this.parent;if(!e)return new St(null);for(var t=e.entityAspect;e&&!t;)e=e.complexAspect&&e.complexAspect.parent,t=e&&e.entityAspect;return t||new St(null)},t.getPropertyPath=function(e){var t=this.parent;if(!t)return null;var n=t.complexAspect||t.entityAspect;return n.getPropertyPath(this.parentProperty.name+"."+e)},e}();rt.EntityAspect=St,rt.ComplexAspect=Et;var Tt=function(){function e(e){return e.join(t)}var t=":::",n=function(t,n){ct(t,"entityType").isInstanceOf(kt).check();var r=t.getSelfAndSubtypes();r.length>1&&(this._subtypes=r.filter(function(e){return e.isAbstract===!1})),Array.isArray(n)||(n=at(arguments,1)),this.entityType=t,t.keyProperties.forEach(function(e,t){e.dataType===Pt.Guid&&(n[t]=n[t]&&n[t].toLowerCase())}),this.values=n,this._keyInGroup=e(n)};n._$typeName="EntityKey";var r=n.prototype;return r.toJSON=function(){return{entityType:this.entityType.name,values:this.values}},n.fromJSON=function(e,t){var n=t._getEntityType(e.entityType,!0);return new Tt(n,e.values)},r.equals=function(e){return e instanceof Tt?this.entityType===e.entityType&&E(this.values,e.values):!1},r.toString=function(e){return(e||this.entityType).name+"-"+this._keyInGroup},n.equals=function(e,t){return e instanceof Tt?e.equals(t):!1},r._isEmpty=function(){return 0===this.values.join("").length},n.createKeyString=e,n}();rt.EntityKey=Tt;var xt=function(){var e={isUnchanged:function(){return this===t.Unchanged},isAdded:function(){return this===t.Added},isModified:function(){return this===t.Modified},isDeleted:function(){return this===t.Deleted},isDetached:function(){return this===t.Detached},isUnchangedOrModified:function(){return this===t.Unchanged||this===t.Modified},isAddedModifiedOrDeleted:function(){return this===t.Added||this===t.Modified||this===t.Deleted}},t=new ft("EntityState",e);return t.Unchanged=t.addSymbol(),t.Added=t.addSymbol(),t.Modified=t.addSymbol(),t.Deleted=t.addSymbol(),t.Detached=t.addSymbol(),t.resolveSymbols(),t}();rt.EntityState=xt,rt.makePrimitiveArray=function(){function e(e,n,r){return vt.initializeParent(e,n,r),e.arrayChanged=new dt("arrayChanged",e),c(e,vt.mixin),c(e,t)}var t={};return t._getGoodAdds=function(e){return e},t._beforeChange=function(){var e=this.getEntityAspect();e.entityState.isUnchanged()&&e.setModified(),e.entityState.isModified()&&!this._origValues&&(this._origValues=this.slice(0))},t._processAdds=function(){},t._processRemoves=function(){},t._rejectChanges=function(){this._origValues&&(this.length=0,Array.prototype.push.apply(this,this._origValues))},t._acceptChanges=function(){this._origValues=null},e}(),rt.makeRelationArray=function(){function e(e,t){var n=r(e,t);if(!n.length)return n;var i=e.parentEntity,a=i.entityAspect.entityManager;return a&&!a.isLoading&&n.forEach(function(t){if(t.entityAspect.entityState.isDetached()){e._inProgress=!0;try{a.attachEntity(t,xt.Added)}finally{e._inProgress=!1}}}),n}function t(e,t){var n=e.parentEntity,r=e.navigationProperty,i=e._addsInProcess,a=r.inverse,o=i.length;try{t.forEach(function(e){if(i.push(e),a)e.setProperty(a.name,n);else{var t=n.entityType.keyProperties;r.invForeignKeyNames.forEach(function(r,i){e.setProperty(r,n.getProperty(t[i].name))})}})}finally{i.splice(o,t.length)}}function n(e,t){var n=e.navigationProperty.inverse;n&&t.forEach(function(e){e.setProperty(n.name,null)})}function r(e,t){var n,r=e.parentEntity,i=e.navigationProperty,a=i.inverse;if(a)n=t.filter(function(t){if(e._addsInProcess.indexOf(t)>=0)return!1;var n=t.getProperty(a.name);return n!==r});else{var o=i.invForeignKeyNames,s=r.entityType.keyProperties;n=t.filter(function(t){return e._addsInProcess.indexOf(t)>=0?!1:o.some(function(e,n){var i=s[n].name,a=r.getProperty(i),o=t.getProperty(e);return a!==o})})}return n}function i(e,t,n){return e.parentEntity=t,e.navigationProperty=n,e.arrayChanged=new dt("arrayChanged",e),e._addsInProcess=[],c(e,vt.mixin),c(e,a)}var a={};return a.load=function(e,t){var n=this.parentEntity,r=Bt.fromEntityNavigation(this.parentEntity,this.navigationProperty),i=n.entityAspect.entityManager;return i.executeQuery(r,e,t)},a._getEventParent=function(){return this.parentEntity.entityAspect},a._getPendingPubs=function(){var e=this.parentEntity.entityAspect.entityManager;return e&&e._pendingPubs},a._getGoodAdds=function(t){return e(this,t)},a._processAdds=function(e){t(this,e)},a._processRemoves=function(e){n(this,e)},i}();var Pt=function(){function e(e,t){throw e=$(e,t),new Error(e)}function t(e){switch(e){case x.String:return mt.string;case x.Int64:return mt.int64;case x.Int32:return mt.int32;case x.Int16:return mt.int16;case x.Decimal:return mt.number;case x.Double:return mt.number;case x.Single:return mt.number;case x.DateTime:return mt.date;case x.DateTimeOffset:return mt.date;case x.Boolean:return mt.bool;case x.Guid:return mt.guid;case x.Byte:return mt["byte"];case x.Binary:return mt.none;case x.Time:return mt.duration;case x.Undefined:return mt.none}}var n,r={},i=function(){n={stringPrefix:"K_",nextNumber:-1,nextNumberIncrement:-1}};i();var a=function(){return n.stringPrefix+o().toString()},o=function(){var e=n.nextNumber;return n.nextNumber+=n.nextNumberIncrement,e},s=function(){return A()},u=function(){return new Date},c=function(e){return null==e?e:e.toString()},l=function(e,t){if("string"===t){var n=e.trim();if(""===n)return null;var r=parseInt(n,10);return isNaN(r)?e:r}return"number"===t?Math.round(e):e},p=function(e,t){if("string"===t){var n=e.trim();if(""===n)return null;var r=parseFloat(n);return isNaN(r)?e:r}return e},f=function(e,t){var n;if("string"===t){var r=e.trim();return""===r?null:(n=new Date(Date.parse(r)),I(n)?n:e)}return"number"===t?(n=new Date(e),I(n)?n:e):e},d=function(e,t){if("string"===t){var n=e.trim().toLowerCase();return"false"===n||""===n?!1:"true"===n?!0:e}return e},h=function(e){return null==e?null:"'"+e.replace(/'/g,"''")+"'"},y=function(e){return null==e?null:"string"==typeof e?parseInt(e,10):e},v=function(e){return function(t){return null==t?null:("string"==typeof t&&(t=parseFloat(t)),t+e)}},m=function(t){if(null==t)return null;try{return"datetime'"+t.toISOString()+"'"}catch(n){e("'%1' is not a valid dateTime",t)}},g=function(t){if(null==t)return null;try{return"datetimeoffset'"+t.toISOString()+"'"}catch(n){e("'%1' is not a valid dateTime",t)}},b=function(t){return null==t?null:(B(t)||e("'%1' is not a valid ISO 8601 duration",t),"time'"+t+"'")},w=function(t){return null==t?null:(q(t)||e("'%1' is not a valid guid",t),"guid'"+t+"'")},S=function(e){return null==e?null:"string"==typeof e?"true"===e.trim().toLowerCase():!!e},E=function(e){return null==e?e:"binary'"+e+"'"},T=function(e){return e},x=new ft("DataType",r);x.String=x.addSymbol({defaultValue:"",parse:c,fmtOData:h,getNext:a}),x.Int64=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,quoteJsonOData:!0,parse:l,fmtOData:v("L"),getNext:o}),x.Int32=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:l,fmtOData:y,getNext:o}),x.Int16=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:l,fmtOData:y,getNext:o}),x.Byte=x.addSymbol({defaultValue:0,isNumeric:!0,isInteger:!0,parse:l,fmtOData:y}),x.Decimal=x.addSymbol({defaultValue:0,isNumeric:!0,quoteJsonOData:!0,isFloat:!0,parse:p,fmtOData:v("m"),getNext:o}),x.Double=x.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:p,fmtOData:v("d"),getNext:o}),x.Single=x.addSymbol({defaultValue:0,isNumeric:!0,isFloat:!0,parse:p,fmtOData:v("f"),getNext:o}),x.DateTime=x.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:f,fmtOData:m,getNext:u}),x.DateTimeOffset=x.addSymbol({defaultValue:new Date(1900,0,1),isDate:!0,parse:f,fmtOData:g,getNext:u}),x.Time=x.addSymbol({defaultValue:"PT0S",fmtOData:b}),x.Boolean=x.addSymbol({defaultValue:!1,parse:d,fmtOData:S}),x.Guid=x.addSymbol({defaultValue:"00000000-0000-0000-0000-000000000000",fmtOData:w,getNext:s}),x.Binary=x.addSymbol({defaultValue:null,fmtOData:E}),x.Undefined=x.addSymbol({defaultValue:void 0,fmtOData:T}),x.resolveSymbols(),x.getComparableFn=function(e){return e&&e.isDate?function(e){return e&&e.getTime()}:e===x.Time?function(e){return e&&C(e)}:function(e){return e}},x.fromEdmDataType=function(e){var t=null,n=e.split(".");if(n.length>1){var r=n[1];t="image"===r?x.Byte:2===n.length?x.fromName(r)||x.Undefined:x.String}return t},x.fromValue=function(e){if(I(e))return x.DateTime;switch(typeof e){case"string":return q(e)?x.Guid:B(e)&&e.length>3?x.Time:M(e)?x.DateTime:x.String;case"boolean":return x.Boolean;case"number":return x.Double}return x.Undefined};var P=/.\d{3}$/;return x.parseTimeFromServer=function(e){if("string"==typeof e)return e;if(e&&"Edm.Time"===e.__edmType){var t=Math.floor(e.ms/1e3);return"PT"+t+"S"}return e},x.parseDateAsUTC=function(e){if("string"==typeof e){var t=P.test(e);e=t?e+"Z":e}return e=new Date(Date.parse(e))},x.parseDateFromServer=x.parseDateAsUTC,x.parseRawValue=function(e,t){return void 0===e?void 0:(t.isDate&&e?I(e)||(e=x.parseDateFromServer(e)):t===x.Binary?e&&void 0!==e.$value&&(e=e.$value):t===x.Time&&(e=x.parseTimeFromServer(e)),e)},x.constants=n,x._resetConstants=i,x.getSymbols().forEach(function(e){e.validatorCtor=t(e)}),x}();rt.DataType=Pt;var _t=function(){function e(e,t){return t&&(pt(t).whereParam("serviceName").isOptional().whereParam("adapterName").isString().isOptional().whereParam("uriBuilderName").isString().isOptional().whereParam("hasServerMetadata").isBoolean().isOptional().whereParam("jsonResultsAdapter").isInstanceOf(Nt).isOptional().whereParam("useJsonp").isBoolean().isOptional().applyAll(e),e.serviceName=e.serviceName&&_t._normalizeServiceName(e.serviceName),e.adapterInstance=e.adapterName&&ht.getAdapterInstance("dataService",e.adapterName),e.uriBuilder=e.uriBuilderName&&ht.getAdapterInstance("uriBuilder",e.uriBuilderName)),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="DataService",n.using=function(t){if(!t)return this;var n=new _t(this);return e(n,t)},t.resolve=function(e){e.push({hasServerMetadata:!0,useJsonp:!1});var t=new _t(h(e,["serviceName","adapterName","uriBuilderName","hasServerMetadata","jsonResultsAdapter","useJsonp"]));if(!t.serviceName)throw new Error("Unable to resolve a 'serviceName' for this dataService");return t.adapterInstance=t.adapterInstance||ht.getAdapterInstance("dataService",t.adapterName),t.jsonResultsAdapter=t.jsonResultsAdapter||t.adapterInstance.jsonResultsAdapter,t.uriBuilder=t.uriBuilder||ht.getAdapterInstance("uriBuilder",t.uriBuilderName),t},t._normalizeServiceName=function(e){return e=e.trim(),"/"!==e.substr(-1)?e+"/":e},n.toJSON=function(){return f(this,{serviceName:null,adapterName:null,uriBuilderName:null,hasServerMetadata:null,jsonResultsAdapter:function(e){return e&&e.name},useJsonp:null})},t.fromJSON=function(e){return e.jsonResultsAdapter=ht._fetchObject(Nt,e.jsonResultsAdapter),new _t(e)},n.qualifyUrl=function(e){var t=this.serviceName;return st.stringEndsWith(t,"/")&&(t=t.substr(0,t.length-1)),e="/"+e,st.stringEndsWith(t,e)||(t+=e),t},t}(),Nt=function(){function e(e){return e.results}var t=function(t){if(1!==arguments.length)throw new Error("The JsonResultsAdapter ctor should be called with a single argument that is a configuration object.");pt(t).whereParam("name").isNonEmptyString().whereParam("extractResults").isFunction().isOptional().withDefault(e).whereParam("visitNode").isFunction().applyAll(this),ht._storeObject(this,n._$typeName,this.name)},n=t.prototype;return n._$typeName="JsonResultsAdapter",t}();rt.DataService=_t,rt.JsonResultsAdapter=Nt;var Ot=P("Q");Ot||(Ot=function(){var e="Q is undefined. Are you missing Q.js? See https://github.com/kriskowal/q";throw new Error(e)},Ot.defer=Ot.resolve=Ot.reject=Ot),rt.config.setQ=function(e){rt.Q=Ot=e
},rt.Q=Ot;var At=function(){function e(e){var t=[];for(var n in e){var r=e[n];n===r.name&&t.push(e[n])}return t}function t(e,t,n){var i=et(t.shortName,t.namespace),o=e._getEntityType(i,!0);if(o)return n?r(o,t):o;var s={shortName:t.shortName,namespace:t.namespace,isAbstract:t.isAbstract,autoGeneratedKeyType:Mt.fromName(t.autoGeneratedKeyType),defaultResourceName:t.defaultResourceName,custom:t.custom};if(o=t.isComplexType?new Ft(s):new kt(s),t.baseTypeName){o.baseTypeName=t.baseTypeName;var u=e._getEntityType(t.baseTypeName,!0);u?a(e,t,o,u):T(e._deferredTypes,t.baseTypeName).push({json:t,stype:o})}else a(e,t,o);return o}function r(e,t){return t.custom&&(e.custom=t.custom),i(e,t.dataProperties),i(e,t.navigationProperties),e}function i(e,t){t&&t.forEach(function(t){var n=t.name;if(!n){if(!t.nameOnServer)throw new Error("Unable to complete 'importMetadata' - cannot locate a 'name' or 'nameOnServer' for one of the imported property nodes");n=e.metadataStore.namingConvention.serverPropertyNameToClient(t.nameOnServer,{})}if(t.custom){var r=e.getProperty(n,!0);r.custom=t.custom}})}function a(e,t,n){t.validators&&(n.validators=t.validators.map(mt.fromJSON)),t.dataProperties.forEach(function(e){n._addPropertyCore(Dt.fromJSON(e))});var r=!t.isComplexType;r&&t.navigationProperties&&t.navigationProperties.forEach(function(e){n._addPropertyCore(It.fromJSON(e))}),e.addEntityType(n);var i=e._deferredTypes,o=i[n.name];o&&(o.forEach(function(t){a(e,t.json,t.stype)}),delete i[n.name])}function o(e,t,n){if(Y(t))return t;var r=e._shortNameMap[t];if(!r&&n)throw new Error("Unable to locate 'entityTypeName' of: "+t);return r}var s=0,u=function(e){e=e||{},pt(e).whereParam("namingConvention").isOptional().isInstanceOf(Rt).withDefault(Rt.defaultInstance).whereParam("localQueryComparisonOptions").isOptional().isInstanceOf(Vt).withDefault(Vt.defaultInstance).whereParam("serializerFn").isOptional().isFunction().applyAll(this),this.dataServices=[],this._resourceEntityTypeMap={},this._structuralTypeMap={},this._shortNameMap={},this._ctorRegistry={},this._incompleteTypeMap={},this._incompleteComplexTypeMap={},this._id=s++,this.metadataFetched=new dt("metadataFetched",this)},l=u.prototype;return l._$typeName="MetadataStore",dt.bubbleEvent(l,null),u.ANONTYPE_PREFIX="_IB_",l.setProperties=function(e){pt(e).whereParam("name").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().applyAll(this)},l.addDataService=function(e,t){ct(e,"dataService").isInstanceOf(_t).check(),ct(t,"shouldOverwrite").isBoolean().isOptional().check();var n=this._getDataServiceIndex(e.serviceName);if(n>=0){if(!t)throw new Error("A dataService with this name '"+e.serviceName+"' already exists in this MetadataStore");this.dataServices[n]=e}else this.dataServices.push(e)},l._getDataServiceIndex=function(e){return g(this.dataServices,function(t){return t.serviceName===e})},l.addEntityType=function(e){if(e instanceof kt||e instanceof Ft||(e=e.isComplexType?new Ft(e):new kt(e)),!e.isComplexType){if(e.baseTypeName&&!e.baseEntityType){var t=this._getEntityType(e.baseTypeName,!0);e._updateFromBase(t)}if(0===e.keyProperties.length&&!e.isAbstract)throw new Error("Unable to add "+e.name+" to this MetadataStore.  An EntityType must have at least one property designated as a key property - See the 'DataProperty.isPartOfKey' property.")}if(e.metadataStore=this,!e.isAnonymous){if(this._structuralTypeMap[e.name])throw new Error("Type "+e.name+" already exists in this MetadataStore.");this._structuralTypeMap[e.name]=e,this._shortNameMap[e.shortName]=e.name}if(e.getProperties().forEach(function(t){e._updateNames(t),t.isUnmapped||e._mappedPropertiesCount++}),e._updateCps(),!e.isComplexType){e._updateNps();var n=e.defaultResourceName||e.baseEntityType&&e.baseEntityType.defaultResourceName;n&&!this.getEntityTypeNameForResourceName(n)&&this.setEntityTypeForResourceName(n,e.name),e.defaultResourceName=n,e.getEntityCtor()}},l.exportMetadata=function(){var e=JSON.stringify({metadataVersion:rt.metadataVersion,name:this.name,namingConvention:this.namingConvention.name,localQueryComparisonOptions:this.localQueryComparisonOptions.name,dataServices:this.dataServices,structuralTypes:n(this._structuralTypeMap),resourceEntityTypeMap:this._resourceEntityTypeMap},null,ht.stringifyPad);return e},l.importMetadata=function(e,n){ct(n,"allowMerge").isOptional().isBoolean().check(),this._deferredTypes={};var r="string"==typeof e?JSON.parse(e):e;if(r.schema)return Ct.parse(this,r.schema,r.altMetadata);if(r.metadataVersion&&r.metadataVersion!==rt.metadataVersion){var i=$("Cannot import metadata with a different 'metadataVersion' (%1) than the current 'breeze.metadataVersion' (%2) ",r.metadataVersion,rt.metadataVersion);throw new Error(i)}var a=r.namingConvention,o=r.localQueryComparisonOptions;if(this.isEmpty())this.namingConvention=ht._fetchObject(Rt,a)||this.namingConvention,this.localQueryComparisonOptions=ht._fetchObject(Vt,o)||this.localQueryComparisonOptions;else{if(a&&this.namingConvention.name!==a)throw new Error("Cannot import metadata with a different 'namingConvention' from the current MetadataStore");if(o&&this.localQueryComparisonOptions.name!==o)throw new Error("Cannot import metadata with different 'localQueryComparisonOptions' from the current MetadataStore")}var s=this;r.dataServices&&r.dataServices.forEach(function(e){e=_t.fromJSON(e),s.addDataService(e,!0)});this._structuralTypeMap;return r.structuralTypes&&r.structuralTypes.forEach(function(e){t(s,e,n)}),c(this._resourceEntityTypeMap,r.resourceEntityTypeMap),c(this._incompleteTypeMap,r.incompleteTypeMap),this},u.importMetadata=function(e){var t=new At;return t.importMetadata(e),t},l.hasMetadataFor=function(e){return!!this.getDataService(e)},l.getDataService=function(e){return ct(e,"serviceName").isString().check(),e=_t._normalizeServiceName(e),m(this.dataServices,function(t){return t.serviceName===e})},l.fetchMetadata=function(e,t,n){try{if(ct(e,"dataService").isString().or().isInstanceOf(_t).check(),ct(t,"callback").isFunction().isOptional().check(),ct(n,"errorCallback").isFunction().isOptional().check(),"string"==typeof e&&(e=this.getDataService(e)||new _t({serviceName:e})),e=_t.resolve([e]),this.hasMetadataFor(e.serviceName))throw new Error("Metadata for a specific serviceName may only be fetched once per MetadataStore. ServiceName: "+e.serviceName);var r=this;return e.adapterInstance.fetchMetadata(this,e).then(function(n){return r.metadataFetched.publish({metadataStore:r,dataService:e,rawMetadata:n}),t&&t(n),Ot.resolve(n)},function(e){return n&&n(e),Ot.reject(e)})}catch(i){return Ot.reject(i)}},l.trackUnmappedType=function(e,t){ct(e,"entityCtor").isFunction().check(),ct(t,"interceptor").isFunction().isOptional().check();var n=new kt(this);n._setCtor(e,t)},l.registerEntityTypeCtor=function(e,t,n,r){ct(e,"structuralTypeName").isString().check(),ct(t,"aCtor").isFunction().isOptional().check(),ct(n,"initFn").isOptional().isFunction().or().isString().check(),ct(r,"noTrackingFn").isOptional().isFunction().check();var i=o(this,e,!1),a=i||e;if(this._ctorRegistry[a]={ctor:t,initFn:n,noTrackingFn:r},i){var s=this._structuralTypeMap[i];s&&s.getCtor(!0)}},l.isEmpty=function(){return K(this._structuralTypeMap)},l.getEntityType=function(e,t){return ct(e,"structuralTypeName").isString().check(),ct(t,"okIfNotFound").isBoolean().isOptional().check(!1),this._getEntityType(e,t)},l._getEntityType=function(e,t){var n=o(this,e,!1),r=this._structuralTypeMap[n];if(!r){if(t)return null;var i=$("Unable to locate a 'Type' by the name: '%1'. Be sure to execute a query or call fetchMetadata first.",e);throw new Error(i)}if(r.length){var a=r.join(",");throw new Error("There are multiple types with this 'shortName': "+a)}return r},l.getEntityTypes=function(){return e(this._structuralTypeMap)},l.getIncompleteNavigationProperties=function(){return n(this._incompleteTypeMap,function(e,t){return t})},l.getEntityTypeNameForResourceName=function(e){return ct(e,"resourceName").isString().check(),this._resourceEntityTypeMap[e]},l.setEntityTypeForResourceName=function(e,t){ct(e,"resourceName").isString().check(),ct(t,"entityTypeOrName").isInstanceOf(kt).or().isString().check();var n;n=t instanceof kt?t.name:o(this,t,!0),this._resourceEntityTypeMap[e]=n;var r=this._getEntityType(n,!0);r&&!r.defaultResourceName&&(r.defaultResourceName=e)},l._checkEntityType=function(e){if(!e.entityType){var t=e.prototype._$typeName;if(!t)throw new Error("This entity has not been registered. See the MetadataStore.registerEntityTypeCtor method");var n=this._getEntityType(t);n&&(e.entityType=n)}},u}(),Ct=function(){function e(e,n,i){e._entityTypeResourceMap={},y(n).forEach(function(n){if(n.cSpaceOSpaceMapping){var i=JSON.parse(n.cSpaceOSpaceMapping),a={};i.forEach(function(e){a[e[0]]=e[1]}),n.cSpaceOSpaceMapping=a}n.entityContainer&&y(n.entityContainer).forEach(function(t){y(t.entitySet).forEach(function(t){var r=v(t.entityType,n).typeName;e.setEntityTypeForResourceName(t.name,r),e._entityTypeResourceMap[r]=t.name})}),n.complexType&&y(n.complexType).forEach(function(t){r(t,n,e)}),n.entityType&&y(n.entityType).forEach(function(r){t(r,n,e)})});var a=e.getIncompleteNavigationProperties();if(a.length>0){var o=a.map(function(e){return e.parentType.name+":"+e.name}).join(", ");throw new Error("Incomplete navigation properties: "+o)}return i&&e.importMetadata(i,!0),e}function t(e,t,r){var i=e.name,a=g(i,t),o=new kt({shortName:i,namespace:a,isAbstract:e["abstract"]&&"true"===e["abstract"]});if(e.baseType){var s=v(e.baseType,t).typeName;o.baseTypeName=s;var u=r._getEntityType(s,!0);if(u)n(o,e,t,r);else{var c=r._deferredTypes[s];c||(c=[],r._deferredTypes[s]=c),c.push({entityType:o,csdlEntityType:e})}}else n(o,e,t,r);return o}function n(e,t,r,a){var o=t.key?y(t.key.propertyRef).map(s("name")):[];y(t.property).forEach(function(t){i(e,t,r,o)}),y(t.navigationProperty).forEach(function(t){u(e,t,r)}),a.addEntityType(e),e.defaultResourceName=a._entityTypeResourceMap[e.name];var c=a._deferredTypes,l=c[e.name];l&&(l.forEach(function(e){n(e.entityType,e.csdlEntityType,r,a)}),delete c[e.name])}function r(e,t,n){var r=e.name,a=g(r,t),o=new Ft({shortName:r,namespace:a});return y(e.property).forEach(function(e){i(o,e,t)}),n.addEntityType(o),o}function i(e,t,n,r){var i,s=t.type.split(".");return"Edm"===s[0]&&2===s.length?i=a(e,t,r):c(t,n)?(i=a(e,t,r),i&&(i.enumType=t.type)):i=o(e,t,n),i&&(e._addPropertyCore(i),f(i)),i}function a(e,t,n){var r=Pt.fromEdmDataType(t.type);if(null==r)return e.warnings.push("Unable to recognize DataType for property: "+t.name+" DateType: "+t.type),null;var i="true"===t.nullable||null==t.nullable,a=null!=n&&n.indexOf(t.name)>=0;a&&e.autoGeneratedKeyType===Mt.None&&d(t)&&(e.autoGeneratedKeyType=Mt.Identity);var o=t.maxLength;o=null==o||"Max"===o?null:parseInt(o,10);var s=new Dt({nameOnServer:t.name,dataType:r,isNullable:i,isPartOfKey:a,maxLength:o,defaultValue:t.defaultValue,concurrencyMode:t.concurrencyMode});return r===Pt.Undefined&&(s.rawTypeName=t.type),s}function o(e,t,n){var r=v(t.type,n).typeName,i=new Dt({nameOnServer:t.name,complexTypeName:r,isNullable:!1});return i}function u(e,t,n){var r=h(t,n),i=m(r.end,function(e){return e.role===t.toRole}),a="*"!==i.multiplicity,o=v(i.type,n).typeName,u=r.referentialConstraint;if(u||"*"!=r.end[0].multiplicity||"*"!=r.end[1].multiplicity){var c={nameOnServer:t.name,entityTypeName:o,isScalar:a,associationName:r.name};if(u){var l=u.principal,p=u.dependent,f=y(p.propertyRef),d=f.map(s("name"));t.fromRole===l.role?c.invForeignKeyNamesOnServer=d:c.foreignKeyNamesOnServer=d}var g=new It(c);return e._addPropertyCore(g),g}}function c(e,t){return t.enumType?l(e,t):t.extensions?p(e,t):!1}function l(e,t){var n=y(t.enumType),r=e.type.split("."),i=r[r.length-1];return n.some(function(e){return e.name===i})}function p(e,t){var n=t.extensions.filter(function(e){return"EnumType"===e.name}),r=e.type.split("."),i=r[r.length-1];return n.some(function(e){return e.attributes.some(function(e){return"Name"===e.name&&e.value===i})})}function f(e){var t;if(e.isNullable||e.validators.push(mt.required()),!e.isComplexProperty){if(e.dataType===Pt.String)if(e.maxLength){var n={maxLength:e.maxLength};t=mt.maxLength(n)}else t=mt.string();else t=e.dataType.validatorCtor();e.validators.push(t)}}function d(e){var t=m(Object.keys(e),function(e){return e.indexOf("StoreGeneratedPattern")>=0});if(t)return"Identity"===e[t];var n=e.extensions;if(!n)return!1;var r=m(n,function(e){return"StoreGeneratedPattern"===e.name&&"Identity"===e.value});return!!r}function h(e,t){var n=v(e.relationship,t).shortTypeName,r=t.association;if(!r)return null;Array.isArray(r)||(r=[r]);var i=m(r,function(e){return e.name===n});return i}function v(e,t){if(!e)return null;if(z(e,At.ANONTYPE_PREFIX))return{shortTypeName:e,namespace:"",typeName:e,isAnonymous:!0};var n=e.split(",")[0],r=n.split(".");if(r.length>1){var i=r[r.length-1],a=null;if(t&&(a=g(i,t)),!a){var o=r.slice(0,r.length-1);a=o.join(".")}return{shortTypeName:i,namespace:a,typeName:et(i,a)}}return{shortTypeName:e,namespace:"",typeName:e}}function g(e,t){var n,r=t.cSpaceOSpaceMapping;if(r){var i=r[t.namespace+"."+e];if(n=i&&i.substr(0,i.length-(e.length+1)))return n}return t.entityType||"Default"!=t.namespace?t.namespace:null}var b=O(function(e){return e&&v(e).typeName});return{parse:e,normalizeTypeName:b}}(),kt=function(){function e(e,t){return e.entityAspect||e.complexAspect?e.getProperty(t.name):e[t.name]}function t(e){var t=e.name.replace(/\W/g,"_");return Function("return function "+t+"(){}")()}function n(e){return e.filter(function(e){return null==e.baseProperty})}function r(e,t,n){var r=n+"OnServer",i=t[n];if(i&&i.length){var a=y(i).map(function(n){var r=e.clientPropertyNameToServer(n,t),i=e.serverPropertyNameToClient(r,t);if(n!==i)throw new Error("NamingConvention for this client property name does not roundtrip properly:"+n+"-->"+i);return r});t[r]=Array.isArray(i)?a:a[0]}else{var o=t[r];if(!o||0===o.length)return;var s=y(o).map(function(n){var r=e.serverPropertyNameToClient(n,t),i=e.clientPropertyNameToServer(r,t);if(n!==i)throw new Error("NamingConvention for this server property name does not roundtrip properly:"+n+"-->"+i);return r});t[n]=Array.isArray(o)?s:s[0]}}function a(e,t){var n=t._getEntityType(e.complexTypeName,!0);if(!n)return!1;if(!(n instanceof Ft))throw new Error("Unable to resolve ComplexType with the name: "+e.complexTypeName+" for the property: "+property.name);return e.dataType=n,e.defaultValue=null,!0}function u(e,t){if(e.entityType)return!0;var n=t._getEntityType(e.entityTypeName,!0);if(n)e.entityType=n,e._resolveNp();else{var r=T(t._incompleteTypeMap,e.entityTypeName);b(r,e)}return!!n}function c(e,t){var n=e.getPropertyNames(),r=yt.getDefaultInstance(),a=r.getTrackablePropertyNames(t);a.forEach(function(r){if(-1===n.indexOf(r)){var a=t[r];try{"function"==typeof a&&(a=a())}catch(o){}var s=Pt.fromValue(a),u=new Dt({name:r,dataType:s,isNullable:!0,isUnmapped:!0});u.isSettable=i(t,r),e.subtypes?e.getSelfAndSubtypes().forEach(function(e){e._addPropertyCore(new Dt(u))}):e._addPropertyCore(u)}})}var l=0,p=function(e){if(arguments.length>1)throw new Error("The EntityType ctor has a single argument that is either a 'MetadataStore' or a configuration object.");"MetadataStore"===e._$typeName?(this.metadataStore=e,this.shortName="Anon_"+ ++l,this.namespace="",this.isAnonymous=!0):pt(e).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("baseTypeName").isString().isOptional().whereParam("isAbstract").isBoolean().isOptional().withDefault(!1).whereParam("autoGeneratedKeyType").isEnumOf(Mt).isOptional().withDefault(Mt.None).whereParam("defaultResourceName").isNonEmptyString().isOptional().withDefault(null).whereParam("dataProperties").isOptional().whereParam("navigationProperties").isOptional().whereParam("serializerFn").isOptional().isFunction().whereParam("custom").isOptional().applyAll(this),this.name=et(this.shortName,this.namespace),this.dataProperties=[],this.navigationProperties=[],this.complexProperties=[],this.keyProperties=[],this.foreignKeyProperties=[],this.inverseForeignKeyProperties=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.validators=[],this.warnings=[],this._mappedPropertiesCount=0,this.subtypes=[],tt(this,e.dataProperties,Dt),tt(this,e.navigationProperties,It)},d=p.prototype,h=Pt.parseRawValue;return d._$typeName="EntityType",p.qualifyTypeName=et,d.setProperties=function(e){pt(e).whereParam("autoGeneratedKeyType").isEnumOf(Mt).isOptional().whereParam("defaultResourceName").isString().isOptional().whereParam("serializerFn").isFunction().isOptional().whereParam("custom").isOptional().applyAll(this),e.defaultResourceName&&(this.defaultResourceName=e.defaultResourceName)},d.isSubtypeOf=function(e){ct(e,"entityType").isInstanceOf(kt).check();var t=this;do{if(t===e)return!0;t=t.baseEntityType}while(t);return!1},d.getSelfAndSubtypes=function(){var e=[this];return this.subtypes.forEach(function(t){var n=t.getSelfAndSubtypes();e.push.apply(e,n)}),e},d.getAllValidators=function(){for(var e=this.validators.slice(0),t=this.baseEntityType;t;)e.push.apply(e,t.validators),t=t.baseEntityType;return e},d.addProperty=function(e){return ct(e,"property").isInstanceOf(Dt).or().isInstanceOf(It).check(),this._addPropertyCore(e,!0)},d._updateFromBase=function(e){this.baseEntityType=e,this.autoGeneratedKeyType===Mt.None&&(this.autoGeneratedKeyType=e.autoGeneratedKeyType),e.dataProperties.forEach(function(e){var t=new Dt(e);t.validators=[],t.baseProperty=e,this._addPropertyCore(t)},this),e.navigationProperties.forEach(function(e){var t=new It(e);t.validators=[],t.baseProperty=e,this._addPropertyCore(t)},this),e.subtypes.push(this)},d._addPropertyCore=function(e,t){if(this.isFrozen)throw new Error("The '"+this.name+"' EntityType/ComplexType has been frozen. You can only add properties to an EntityType/ComplexType before any instances of that type have been created and attached to an entityManager.");var n=e.parentType;if(n){if(n!==this)throw new Error("This property: "+e.name+" has already been added to "+e.parentType.name);return this}e.parentType=this;var i=this.metadataStore;return e.isDataProperty?this._addDataProperty(e):(this._addNavigationProperty(e),t&&i&&u(e,i)),!i||e.name&&e.nameOnServer||r(i.namingConvention,e,"name"),this},d.createEntity=function(t){if(t&&t._$eref&&!t._$eref.entityAspect.entityManager)return t._$eref;var n=this._createInstanceCore();return t&&(this.keyProperties.every(function(e){return null!=t[e.name]})&&(t._$eref=n),this._updateTargetFromRaw(n,t,e),this.navigationProperties.forEach(function(e){var r,i=t[e.name];if(void 0!=i){var a=e.entityType;if(e.isScalar)r=i.entityAspect?i:a.createEntity(i),n.setProperty(e.name,r);else{var o=n.getProperty(e.name);i.forEach(function(e){r=e.entityAspect?e:a.createEntity(e),o.push(r)})}}})),this._initializeInstance(n),n},d._createInstanceCore=function(){var e=this.getEntityCtor(),t=new e;return new St(t),t},d._initializeInstance=function(e){this.baseEntityType&&this.baseEntityType._initializeInstance(e);var t=this.initFn;t&&("string"==typeof t&&(t=e[t]),t(e)),this.complexProperties&&this.complexProperties.forEach(function(t){var n=e.getProperty(t.name);Array.isArray(n)?n.forEach(function(e){t.dataType._initializeInstance(e)}):t.dataType._initializeInstance(n)}),e.entityAspect&&(e.entityAspect._initialized=!0)},d.getCtor=d.getEntityCtor=function(e){if(this._ctor&&!e)return this._ctor;var n=this.metadataStore._ctorRegistry,r=n[this.name]||n[this.shortName]||{},i=r.ctor||this._ctor,a=i&&i.prototype&&(i.prototype.entityType||i.prototype.complexType);if(a&&a.metadataStore!==this.metadataStore)throw new Error("Cannot register the same constructor for "+this.name+" in different metadata stores.  Please define a separate constructor for each metadata store.");if(r.ctor&&e&&(this._extra=void 0),!i){var o=yt.getDefaultInstance().createCtor;i=o?o(this):t(this)}return this.initFn=r.initFn,this.noTrackingFn=r.noTrackingFn,i.prototype._$typeName=this.name,this._setCtor(i),i},d._setCtor=function(e,t){var n=e.prototype;this._extra=this._extra||{};var r=new e;c(this,r),"EntityType"===this._$typeName?n.entityType=this:n.complexType=this,n._$interceptor=t||H,yt.getDefaultInstance().initializeEntityPrototype(n),this._ctor=e},d.addValidator=function(e,t){ct(e,"validator").isInstanceOf(mt).check(),ct(t,"property").isOptional().isString().or().isEntityProperty().check(),t?("string"==typeof t&&(t=this.getProperty(t,!0)),t.validators.push(e)):this.validators.push(e)},d.getProperties=function(){return this.dataProperties.concat(this.navigationProperties)},d.getPropertyNames=function(){return this.getProperties().map(s("name"))},d.getDataProperty=function(e){return m(this.dataProperties,o("name",e))},d.getNavigationProperty=function(e){return m(this.navigationProperties,o("name",e))},d.getProperty=function(e,t){var n=this.getPropertiesOnPath(e,!1,t);return n?n[n.length-1]:null},d.getPropertiesOnPath=function(e,t,n){n=n||!1;var r=Array.isArray(e)?e:e.trim().split("."),i=!0,a=this,s=t?"nameOnServer":"name",u=r.map(function(e){var t=m(a.getProperties(),o(s,e));if(t)a=t.isNavigationProperty?t.entityType:t.dataType;else{if(n)throw new Error("unable to locate property: "+e+" on entityType: "+a.name);i=!1}return t});return i?u:null},d.clientPropertyPathToServer=function(e,t){var n,t=t||".";if(this.isAnonymous){var r=this.metadataStore.namingConvention.clientPropertyNameToServer;n=e.split(".").map(function(e){return r(e)})}else n=this.getPropertiesOnPath(e,!1,!0).map(function(e){return e.nameOnServer});return n.join(t)},d.getEntityKeyFromRawEntity=function(e,t){var n=this.keyProperties.map(function(n){var r=t(e,n);return h(r,n.dataType)});return new Tt(this,n)},d._updateTargetFromRaw=function(e,t,n){this.dataProperties.forEach(function(r){if(r.isSettable){var i=n(t,r);if(void 0!==i){var a,o=r.dataType;if(r.isComplexProperty){if(null===i)return;a=e.getProperty(r.name),r.isScalar?o._updateTargetFromRaw(a,i,n):(a.length=0,Array.isArray(i)&&i.forEach(function(t){var i=o._createInstanceCore(e,r);o._updateTargetFromRaw(i,t,n),o._initializeInstance(i),a.push(i)}))}else{var s;r.isScalar?(s=h(i,o),e.setProperty(r.name,s)):(a=e.getProperty(r.name),a.length=0,Array.isArray(i)&&i.forEach(function(e){s=h(e,o),a.push(s)}))}}}});var r=t.entityAspect||t.complexAspect;if(r){var i=e.entityAspect||e.complexAspect;r.originalValuesMap&&(i.originalValues=r.originalValuesMap),r.extraMetadata&&(i.extraMetadata=r.extraMetadata)}},d.toString=function(){return this.name},d.toJSON=function(){return f(this,{shortName:null,namespace:null,baseTypeName:null,isAbstract:!1,autoGeneratedKeyType:null,defaultResourceName:null,dataProperties:n,navigationProperties:n,validators:null,custom:null})},d._updateNames=function(e){var t=this.metadataStore.namingConvention;r(t,e,"name"),e.isNavigationProperty&&(r(t,e,"foreignKeyNames"),r(t,e,"invForeignKeyNames"))},d._checkNavProperty=function(e){if(e.isNavigationProperty){if(e.parentType!==this)throw new Error($("The navigationProperty '%1' is not a property of entity type '%2'",e.name,this.name));return e}if("string"==typeof e){var t=this.getProperty(e);if(t&&t.isNavigationProperty)return t}throw new Error("The 'navigationProperty' parameter must either be a NavigationProperty or the name of a NavigationProperty")},d._addDataProperty=function(e){this.dataProperties.push(e),e.isPartOfKey&&this.keyProperties.push(e),e.isComplexProperty&&this.complexProperties.push(e),e.concurrencyMode&&"None"!==e.concurrencyMode&&this.concurrencyProperties.push(e),e.isUnmapped&&this.unmappedProperties.push(e)},d._addNavigationProperty=function(e){this.navigationProperties.push(e),Y(e.entityTypeName)||(e.entityTypeName=et(e.entityTypeName,this.namespace))},d._updateCps=function(){var e=this.metadataStore,t=e._incompleteComplexTypeMap;this.complexProperties.forEach(function(n){n.complexType||a(n,e)||T(t,n.complexTypeName).push(n)}),this.isComplexType&&((t[this.name]||[]).forEach(function(t){a(t,e)}),delete t[this.name])},d._updateNps=function(){var e=this.metadataStore;this.navigationProperties.forEach(function(t){u(t,e)});var t=e._incompleteTypeMap;(t[this.name]||[]).forEach(function(t){u(t,e)}),delete t[this.name]},p}(),Ft=function(){var e=function(e){if(arguments.length>1)throw new Error("The ComplexType ctor has a single argument that is a configuration object.");pt(e).whereParam("shortName").isNonEmptyString().whereParam("namespace").isString().isOptional().withDefault("").whereParam("dataProperties").isOptional().whereParam("isComplexType").isOptional().isBoolean().whereParam("custom").isOptional().applyAll(this),this.name=et(this.shortName,this.namespace),this.isComplexType=!0,this.dataProperties=[],this.complexProperties=[],this.validators=[],this.concurrencyProperties=[],this.unmappedProperties=[],this.navigationProperties=[],this.keyProperties=[],tt(this,e.dataProperties,Dt)},t=e.prototype;return t.setProperties=function(e){pt(e).whereParam("custom").isOptional().applyAll(this)},t.getAllValidators=function(){return this.validators},t._createInstanceCore=function(e,t){var n=this.getCtor(),r=new n;return new Et(r,e,t),r},t.addProperty=function(e){return ct(e,"dataProperty").isInstanceOf(Dt).check(),this._addPropertyCore(e)},t.getProperties=function(){return this.dataProperties},t=c(t,kt.prototype,["addValidator","getProperty","getPropertiesOnPath","getPropertyNames","_addPropertyCore","_addDataProperty","_updateNames","_updateCps","_initializeInstance","_updateTargetFromRaw","_setCtor"]),t.createInstance=kt.prototype.createEntity,t.getCtor=kt.prototype.getEntityCtor,t.toJSON=function(){return f(this,{shortName:null,namespace:null,isComplexType:null,dataProperties:null,validators:null,custom:null})},t._$typeName="ComplexType",e}(),Dt=function(){var e=function(e){pt(e).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("dataType").isEnumOf(Pt).isOptional().or().isString().or().isInstanceOf(Ft).whereParam("complexTypeName").isOptional().whereParam("isNullable").isBoolean().isOptional().withDefault(!0).whereParam("isScalar").isOptional().withDefault(!0).whereParam("defaultValue").isOptional().whereParam("isPartOfKey").isBoolean().isOptional().whereParam("isUnmapped").isBoolean().isOptional().whereParam("isSettable").isBoolean().isOptional().withDefault(!0).whereParam("concurrencyMode").isString().isOptional().whereParam("maxLength").isNumber().isOptional().whereParam("validators").isInstanceOf(mt).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("enumType").isOptional().whereParam("rawTypeName").isOptional().whereParam("custom").isOptional().applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A DataProperty must be instantiated with either a 'name' or a 'nameOnServer' property");if(this.complexTypeName)this.isComplexProperty=!0,this.dataType=null;else if("string"==typeof this.dataType){var n=Pt.fromName(this.dataType);if(!n)throw new Error("Unable to find a DataType enumeration by the name of: "+this.dataType);this.dataType=n}else this.dataType||(this.dataType=Pt.String);if(null==this.defaultValue){if(this.isNullable)this.defaultValue=null;else if(this.isComplexProperty);else if(this.dataType===Pt.Binary)this.defaultValue="AAAAAAAAJ3U=";else if(this.defaultValue=this.dataType.defaultValue,null==this.defaultValue)throw new Error("A nonnullable DataProperty cannot have a null defaultValue. Name: "+(this.name||this.nameOnServer))}else this.dataType.isNumeric&&"string"==typeof this.defaultValue&&(this.defaultValue=parseFloat(this.defaultValue));this.isComplexProperty&&(this.isScalar=null==this.isScalar||this.isScalar===!0)},t=e.prototype;return t._$typeName="DataProperty",e.getRawValueFromServer=function(e,t){if(t.isUnmapped)return e[t.nameOnServer||t.name];var n=e[t.nameOnServer];return void 0!==n?n:t.defaultValue},e.getRawValueFromClient=function(e,t){var n=e[t.name];return void 0!==n?n:t.defaultValue},t.isDataProperty=!0,t.isNavigationProperty=!1,t.resolveProperty=function(e){for(var t=this[e],n=this.baseProperty;void 0==t&&null!=n;)t=n[e],n=n.baseProperty;return t},t.formatName=function(){return this.parentType.name+"--"+this.name},t.setProperties=function(e){pt(e).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this)},t.getAllValidators=function(){for(var e=this.validators.slice(0),t=this.baseProperty;t;)e.push.apply(e,t.validators),t=t.baseProperty;return e},t.toJSON=function(){return f(this,{name:null,dataType:function(e){return e&&e.parentEnum?e.name:void 0},complexTypeName:null,isNullable:!0,defaultValue:null,isPartOfKey:!1,isUnmapped:!1,isSettable:!0,concurrencyMode:null,maxLength:null,validators:null,displayName:null,enumType:null,rawTypeName:null,isScalar:!0,custom:null})},e.fromJSON=function(e){return e.dataType=Pt.fromName(e.dataType),e.defaultValue&&e.dataType&&e.dataType.isDate&&(e.defaultValue=new Date(Date.parse(e.defaultValue))),e.validators&&(e.validators=e.validators.map(mt.fromJSON)),new Dt(e)},e}(),It=function(){function e(e,t){throw new Error("Cannot set the inverse property for: "+e.formatName()+". "+t)}function t(e,t){throw new Error("Cannot create inverse for: "+e.formatName()+". The entityType for this navigation property "+t)}function n(e){var t=e.foreignKeyNames;if(0!==t.length){var n=e.parentType,r=t.map(function(e){return n.getDataProperty(e)}),i=n.foreignKeyProperties;r.forEach(function(t){b(i,t),t.relatedNavigationProperty=e,b(e.entityType.inverseForeignKeyProperties,t),e.relatedDataProperties?b(e.relatedDataProperties,t):e.relatedDataProperties=[t]})}}var r=function(e){pt(e).whereParam("name").isString().isOptional().whereParam("nameOnServer").isString().isOptional().whereParam("entityTypeName").isString().whereParam("isScalar").isBoolean().isOptional().withDefault(!0).whereParam("associationName").isString().isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("foreignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNamesOnServer").isArray().isString().isOptional().withDefault([]).whereParam("validators").isInstanceOf(mt).isArray().isOptional().withDefault([]).whereParam("displayName").isOptional().whereParam("custom").isOptional().applyAll(this);var t=!(!this.name&&!this.nameOnServer);if(!t)throw new Error("A Navigation property must be instantiated with either a 'name' or a 'nameOnServer' property")},i=r.prototype;return i._$typeName="NavigationProperty",i.isDataProperty=!1,i.isNavigationProperty=!0,c(i,Dt.prototype,["formatName","getAllValidators","resolveProperty"]),i.setProperties=function(e){if(!this.parentType)throw new Error("Cannot call NavigationProperty.setProperties until the parent EntityType of the NavigationProperty has been set.");var t=e.inverse;t&&delete e.inverse,pt(e).whereParam("displayName").isOptional().whereParam("foreignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("invForeignKeyNames").isArray().isString().isOptional().withDefault([]).whereParam("custom").isOptional().applyAll(this),this.parentType._updateNames(this),this._resolveNp(),t&&this.setInverse(t)},i.setInverse=function(t){var n;if(n="string"==typeof t?this.entityType.getNavigationProperty(t):t,!n)throw e(this,"Unable to find inverse property: "+invNpName);(this.inverse||n.inverse)&&e(this,"It has already been set on one side or the other."),n.entityType!=this.parentType&&e(this,n.formatName+" is not a valid inverse property for this."),this.associationName?n.associationName=this.associationName:(n.associationName||(n.associationName=this.formatName()+"_"+n.formatName()),this.associationName=n.associationName),this._resolveNp(),n._resolveNp()},i.createInverse=function(e){this.entityType||t(this,"has not yet been defined."),this.entityType.isFrozen&&t(this,"is frozen.");
var n=this.entityType.metadataStore;null==n&&t(this,"has not yet been added to the metadataStore."),e.entityTypeName=this.parentEntityType.name,e.associationName=this.associationName;var r=new It(e);return this.parentEntityType.addNavigationProperty(r),r},i.toJSON=function(){return f(this,{name:null,entityTypeName:null,isScalar:null,associationName:null,validators:null,displayName:null,foreignKeyNames:null,invForeignKeyNames:null,custom:null})},r.fromJSON=function(e){return e.validators&&(e.validators=e.validators.map(mt.fromJSON)),new It(e)},i._resolveNp=function(){var e=this,t=e.entityType,r=m(t.navigationProperties,function(t){return t.associationName===e.associationName&&(t.name!==e.name||t.entityTypeName!==e.entityTypeName)});e.inverse=r,r||e.invForeignKeyNames.forEach(function(n){var r=t.getDataProperty(n);if(!r)throw new Error("EntityType '"+e.entityTypeName+"' has no foreign key matching '"+n+"'");var i=e.parentType;r.inverseNavigationProperty=m(i.navigationProperties,function(e){return e.invForeignKeyNames&&e.invForeignKeyNames.indexOf(r.name)>=0&&e.entityType===r.parentType}),b(t.foreignKeyProperties,r)}),n(e)},r}(),Mt=function(){var e=new ft("AutoGeneratedKeyType");return e.None=e.addSymbol(),e.Identity=e.addSymbol(),e.KeyGenerator=e.addSymbol(),e.resolveSymbols(),e}();!function(){function e(e,t){return null==t?!1:void 0!==t.entityType}function t(e,t){return null==t?!1:t.isDataProperty||t.isNavigationProperty}var n=ut.prototype;n.isEntity=function(){return this._addContext({fn:e,msg:" must be an entity"})},n.isEntityProperty=function(){return this._addContext({fn:t,msg:" must be either a DataProperty or a NavigationProperty"})}}(),rt.MetadataStore=At,rt.EntityType=kt,rt.ComplexType=Ft,rt.DataProperty=Dt,rt.NavigationProperty=It,rt.AutoGeneratedKeyType=Mt,At.normalizeTypeName=Ct.normalizeTypeName;var jt=function(){function e(e,t,n){var r=t.name+".."+t.parentType.name,i=e._tempIdMap[r];return i||n&&(i={entityType:t.parentType,propertyName:t.name,keyMap:{}},e._tempIdMap[r]=i),i}var t=function(){this._tempIdMap={}},n=t.prototype;return n.generateTempKeyValue=function(t,n){var r=t.keyProperties;if(r.length>1)throw new Error("Ids can not be autogenerated for entities with multipart keys");var i,a=r[0],o=e(this,a,!0);if(null!=n&&(o.keyMap[n.toString()]||(i=n)),void 0===i){var s=a.dataType;if(!s.getNext)throw new Error("Cannot use a property with a dataType of: "+s.toString()+" for id generation");for(i=s.getNext(this);null!=o.keyMap[i.toString()];)i=s.getNext(this)}return o.keyMap[i.toString()]=!0,i},n.getTempKeys=function(){var e=[];for(var t in this._tempIdMap){var n=this._tempIdMap[t],r=n.entityType;for(var i in n.keyMap)e.push(new Tt(r,[i]))}return e},n.isTempKey=function(t){var n=t.entityType.keyProperties;if(n.length>1)return!1;var r=n[0],i=e(this,r);return i?void 0!==i.keyMap[t.values[0].toString()]:!1},ht.registerType(t,"KeyGenerator"),t}();rt.KeyGenerator=jt;var Vt=function(){var e=function(e){pt(e||{}).whereParam("name").isOptional().isString().whereParam("isCaseSensitive").isOptional().isBoolean().whereParam("usesSql92CompliantStringComparison").isBoolean().applyAll(this),this.name||(this.name=A()),ht._storeObject(this,t._$typeName,this.name)},t=e.prototype;return t._$typeName="LocalQueryComparisonOptions",e.caseInsensitiveSQL=new e({name:"caseInsensitiveSQL",isCaseSensitive:!1,usesSql92CompliantStringComparison:!0}),e.defaultInstance=new e(e.caseInsensitiveSQL),t.setAsDefault=function(){return p(this,e)},e}();rt.LocalQueryComparisonOptions=Vt;var Rt=function(){var e=function(e){pt(e||{}).whereParam("name").isOptional().isString().whereParam("serverPropertyNameToClient").isFunction().whereParam("clientPropertyNameToServer").isFunction().applyAll(this),this.name||(this.name=A()),ht._storeObject(this,t._$typeName,this.name)},t=e.prototype;return t._$typeName="NamingConvention",e.none=new e({name:"noChange",serverPropertyNameToClient:function(e){return e},clientPropertyNameToServer:function(e){return e}}),e.camelCase=new e({name:"camelCase",serverPropertyNameToClient:function(e){return e.substr(0,1).toLowerCase()+e.substr(1)},clientPropertyNameToServer:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)}}),e.defaultInstance=new e(e.none),t.setAsDefault=function(){return p(this,e)},e}();rt.NamingConvention=Rt;var qt=function(){function e(e,r){var i=r.entityType;if(Array.isArray(e)){if(!r.isRHS)throw new Error("Array expressions are only permitted on the right hand side of a BinaryPredicate");return new f(e,r.dataType)}if(!V(e)){if(null!=e&&R(e)&&!e.toISOString){if(void 0===e.value)throw new Error("Unable to resolve an expression for: "+e+" on entityType: "+i.name);return e.isProperty?new d(e.value):new f(e.value,e.dataType||r.dataType,!0)}return new f(e,r.dataType)}if(r.isRHS)return null==i||i.isAnonymous?new f(e,r.dataType):n(e,r);for(var a,o=/\([^()]*\)/,s=[],u=0;a=o.exec(e);){var c=a[0];s.push(c);var l=g+u++;e=e.replace(c,l)}var p=t(e,s,r);return p._validate(i,r.usesNameOnServer),p}function t(e,t,i){var a=e.split(g);return 1===a.length?n(a[0],i):r(e,a,t,i)}function n(e,t){e=e.trim();var n=e.substr(0,1),r=("'"===n||'"'===n)&&e.length>1&&e.substr(e.length-1)===n;if(r){var i=e.substr(1,e.length-2);return new f(i,t.dataType||Pt.String)}var a=t.entityType;if(null==a||a.isAnonymous)return new d(e);var o=y.test(e);return o&&null!=a.getPropertiesOnPath(e,t.usesNameOnServer,!1)?new d(e):new f(e,t.dataType)}function r(e,n,r,i){try{var a=n[0].trim().toLowerCase(),o=r[n[1]].trim();"("===o.substr(0,1)&&(o=o.substr(1,o.length-2));var s=e.indexOf("'")>=0?v:m,u=o.match(s),l=c({},i);l.dataType=Pt.Undefined,l.isFnArg=!0;var p=u.map(function(e){return t(e,r,l)});return new h(a,p)}catch(f){return null}}var i=function(){function e(e,t,n){var r=t.toLowerCase();n.key=r,e[r]=n,n.aliases&&n.aliases.forEach(function(t){e[t.toLowerCase()]=n})}function t(e){var r={},i={};r[e[0]]=i;var a=e[1];return a=a.operator||a,i[a]=3==e.length?e[2]:t(e.splice(2)),n(r)}function n(e){if(e instanceof i)return e;if("object"!=typeof e)throw new Error("Unable to convert to a Predicate: "+e);var t=Object.keys(e),n=t.map(function(t){return r(t,e[t])});return 1===n.length?n[0]:new u("and",n)}function r(e,t){if(u.prototype._resolveOp(e,!0))return new u(e,t);if(o.prototype._resolveOp(e,!0))return new o(e,t);if("object"!=typeof t||null==t||I(t))return new s("eq",e,t);if(it(t,"value"))return new s("eq",e,t);if(Array.isArray(t))throw new Error("Unable to resolve predicate after the phrase: "+e);var n=e,r=Object.keys(t),i=r.map(function(e){if(l.prototype._resolveOp(e,!0))return new l(e,n,t[e]);if(s.prototype._resolveOp(e,!0))return new s(e,n,t[e]);if(it(t[e],"value"))return new s("eq",n,t[e]);var r=$("Unable to resolve predicate after the phrase: '%1' for operator: '%2'  and value: '%3'",n,e,t[e]);throw new Error(r)});return 1===i.length?i[0]:new u("and",i)}var c=function(){if(0!==arguments.length){if(1===arguments.length){var e=arguments[0];return Array.isArray(e)?1===e.length?i(e[0]):t(e):e instanceof i?e:"string"==typeof e?new a(e):n(e)}return t(Array.prototype.slice.call(arguments,0))}},p=c.prototype;return c.create=c,c.and=function(){var e=new u("and",at(arguments));return e.op&&e},c.or=function(){var e=new u("or",at(arguments));return e.op&&e},c.not=function(e){return e.not()},c.extendBinaryPredicateFn=function(t,n){var r=b.binaryPredicate;for(var i in t||{}){var a=t[i];a.visitorFn=n,e(s.prototype.aliasMap,i,t[i])}b.isExtended||(b.binaryPredicate=function(e,t,n){var i=this.aliasMap[this.op.key].visitorFn;return i?i(e,t,n):r(e,t,n)},b.isExtended=!0)},p.and=function(){var e=i(at(arguments));return new u("and",[this,e])},p.or=function(){var e=i(at(arguments));return new u("or",[this,e])},p.not=function(){return new o("not",this)},p.toJSON=function(){return this.toJSONExt({entityType:this._entityType})},p.toJSONExt=function(e){return this.visit(e,w)},p.toFunction=function(e){return this.visit(e,b)},p.toString=function(){return JSON.stringify(this)},p.visit=function(e,t){if(K(e))e={entityType:null};else if(e instanceof kt)e={entityType:e};else if(!it(e,"entityType"))throw new Error("All visitor methods must be called with a context object containing at least an 'entityType' property");t?e.visitor=t:t=e.visitor;var n=t[this.visitorMethodName];if(null==n)throw new Error("Unable to locate method: "+this.visitorMethodName+" on visitor");var r=e.entityType;(this._validate&&null==r||this._entityType!==r)&&(this._validate(r,e.usesNameOnServer),this._entityType=r);Array.prototype.slice.call(arguments,1);return n.call(this,e)},p._initialize=function(t,n){this.visitorMethodName=t;var r=this.aliasMap={};for(var i in n||{})e(r,i,n[i])},p._resolveOp=function(e,t){e=e.operator||e;var n=this.aliasMap[e.toLowerCase()];if(!n&&!t)throw new Error("Unable to resolve operator: "+e);return n},c}(),a=function(){var e=function(e){this.value=e},t=e.prototype=new i;return t._initialize("passthruPredicate"),t._validate=k,e}(),o=function(){var e=function(e,t){this.op=this._resolveOp(e),this.pred=i(t)},t=e.prototype=new i;return t._initialize("unaryPredicate",{not:{aliases:["!","~"]}}),t._validate=function(e,t){this.pred._validate(e,t)},e}(),s=function(){var t=function(e,t,n){this.op=this._resolveOp(e),this.expr1Source=t,this.expr2Source=n},n=t.prototype=new i;return n._initialize("binaryPredicate",{eq:{aliases:["==","equals"]},ne:{aliases:["!=","~=","notequals"]},lt:{aliases:["<","lessthan"]},le:{aliases:["<=","lessthanorequal"]},gt:{aliases:[">","greaterthan"]},ge:{aliases:[">=","greaterthanorequal"]},startswith:{isFunction:!0},endswith:{isFunction:!0},contains:{aliases:["substringof"],isFunction:!0},"in":{}}),n._validate=function(t,n){var r={entityType:t,usesNameOnServer:n};if(this.expr1=e(this.expr1Source,r),null==this.expr1)throw new Error("Unable to validate 1st expression: "+this.expr1Source);if(this.expr1 instanceof f)throw new Error("The left hand side of a binary predicate cannot be a literal expression, it must be a valid property or functional predicate expression: "+this.expr1Source);if("in"==this.op.key&&!Array.isArray(this.expr2Source))throw new Error("The 'in' operator requires that its right hand argument be an array");var i=c(r,{isRHS:!0,dataType:this.expr1.dataType});if(this.expr2=e(this.expr2Source,i),null==this.expr2)throw new Error("Unable to validate 2nd expression: "+this.expr2Source);null==this.expr1.dataType&&(this.expr1.dataType=this.expr2.dataType)},t}(),u=function(){var e=function(e,t){return this.op=this._resolveOp(e),1==t.length&&Array.isArray(t[0])&&(t=t[0]),this.preds=t.filter(function(e){return null!=e}).map(function(e){return i(e)}),0==this.preds.length&&(this.op=null),1==this.preds.length?this.preds[0]:void 0},t=e.prototype=new i;return t._initialize("andOrPredicate",{and:{aliases:["&&"]},or:{aliases:["||"]}}),t._validate=function(e,t){this.preds.every(function(n){n._validate(e,t)})},e}(),l=function(){var t=function(e,t,n){this.op=this._resolveOp(e),this.exprSource=t,this.pred=i(n)},n=t.prototype=new i;return n._initialize("anyAllPredicate",{any:{aliases:["some"]},all:{aliases:["every"]}}),n._validate=function(t,n){this.expr=e(this.exprSource,{entityType:t,usesNameOnServer:n}),(null==t||t.isAnonymous)&&(this.expr.dataType=null),this.pred._validate(this.expr.dataType,n)},t}(),p=function(e){this.visitorMethodName=e,this.visit=i.prototype.visit,this._validate=k},f=function(){function e(e){if(null==e)return e;if(Pt.contains(e))return e;if(V(e)){var t=Pt.fromName(e);if(t)return t;throw new Error("Unable to resolve a dataType named: "+e)}throw new Error("The dataType parameter passed into this literal expression is not a 'DataType'"+e)}var t=function(t,n,r){n=e(n),n=n||Pt.fromValue(t),this.value=n&&n.parse?Array.isArray(t)?t.map(function(e){return n.parse(e,typeof e)}):n.parse(t,typeof t):t,this.dataType=n,this.hasExplicitDataType=r},n=t.prototype=new p("litExpr");return n.toString=function(){return" LitExpr - value: "+this.value.toString()+" dataType: "+this.dataType.toString()},t}(),d=function(){var e=function(e){this.propertyPath=e},t=e.prototype=new p("propExpr");return t.toString=function(){return" PropExpr - "+this.propertyPath},t._validate=function(e,t){if(null!=e&&!e.isAnonymous){var n=e.getPropertiesOnPath(this.propertyPath,t,!1);if(!n){var r=$("Unable to resolve propertyPath.  EntityType: '%1'   PropertyPath: '%2'",e.name,this.propertyPath);throw new Error(r)}var i=n[n.length-1];this.dataType=i.isDataProperty?i.dataType:i.entityType}},e}(),h=function(){var e=function(e,t){this.fnName=e,this.exprs=t;var r=n[e];if(null==r)throw new Error("Unknown function: "+e);this.localFn=r.fn,this.dataType=r.dataType},t=e.prototype=new p("fnExpr");t.toString=function(){var e=this.exprs.map(function(e){e.toString()}).toString();return"FnExpr - "+this.fnName+"("+e+")"},t._validate=function(e,t){this.exprs.forEach(function(n){n._validate(e,t)})};var n=e.funcMap={toupper:{fn:function(e){return e.toUpperCase()},dataType:Pt.String},tolower:{fn:function(e){return e.toLowerCase()},dataType:Pt.String},substring:{fn:function(e,t,n){return e.substring(t,n)},dataType:Pt.String},substringof:{fn:function(e,t){return t.indexOf(e)>=0},dataType:Pt.Boolean},length:{fn:function(e){return e.length},dataType:Pt.Int32},trim:{fn:function(e){return e.trim()},dataType:Pt.String},concat:{fn:function(e,t){return e.concat(t)},dataType:Pt.String},replace:{fn:function(e,t,n){return e.replace(t,n)},dataType:Pt.String},startswith:{fn:function(e,t){return z(e,t)},dataType:Pt.Boolean},endswith:{fn:function(e,t){return L(e,t)},dataType:Pt.Boolean},indexof:{fn:function(e,t){return e.indexOf(t)},dataType:Pt.Int32},round:{fn:function(e){return Math.round(e)},dataType:Pt.Int32},ceiling:{fn:function(e){return Math.ceil(e)},dataType:Pt.Int32},floor:{fn:function(e){return Math.floor(e)},dataType:Pt.Int32},second:{fn:function(e){return e.getSeconds()},dataType:Pt.Int32},minute:{fn:function(e){return e.getMinutes()},dataType:Pt.Int32},day:{fn:function(e){return e.getDate()},dataType:Pt.Int32},month:{fn:function(e){return e.getMonth()+1},dataType:Pt.Int32},year:{fn:function(e){return e.getFullYear()},dataType:Pt.Int32}};return e}(),y=/^[a-z_][\w.$]*$/i,v=/('[^']*'|[^,]+)/g,m=/("[^"]*"|[^,]+)/g,g=String.fromCharCode(191),b=function(){function e(e){switch(e.key){case"any":return function(e,t){return e.some(function(e){return t(e)})};case"all":return function(e,t){return e.every(function(e){return t(e)})};default:throw new Error("Unknown operator: "+e.key)}}function t(e,t,o){var s,u=e.op,c=Pt.getComparableFn(t);switch(u.key){case"eq":s=function(e,t){return e&&"string"==typeof e?n(e,t,o):c(e)==c(t)};break;case"ne":s=function(e,t){return e&&"string"==typeof e?!n(e,t,o):c(e)!=c(t)};break;case"gt":s=function(e,t){return c(e)>c(t)};break;case"ge":s=function(e,t){return c(e)>=c(t)};break;case"lt":s=function(e,t){return c(e)<c(t)};break;case"le":s=function(e,t){return c(e)<=c(t)};break;case"startswith":s=function(e,t){return r(e,t,o)};break;case"endswith":s=function(e,t){return i(e,t,o)};break;case"contains":s=function(e,t){return a(e,t,o)};break;case"in":s=function(e,t){return e=c(e),t=t.map(function(e){return c(e)}),t.indexOf(e)>=0};break;default:return null}return s}function n(e,t,n){return null==t?!1:("string"!=typeof t&&(t=t.toString()),n.usesSql92CompliantStringComparison&&(e=(e||"").trim(),t=(t||"").trim()),n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e===t)}function r(e,t,n){return n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),z(e,t)}function i(e,t,n){return n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),L(e,t)}function a(e,t,n){return n.isCaseSensitive||(e=(e||"").toLowerCase(),t=(t||"").toLowerCase()),e.indexOf(t)>=0}var o={passthruPredicate:function(){throw new Error("Cannot execute an PassthruPredicate expression against the local cache: "+this.value)},unaryPredicate:function(e){var t=this.pred.visit(e);switch(this.op.key){case"not":return function(e){return!t(e)};default:throw new Error("Invalid unary operator:"+this.op.key)}},binaryPredicate:function(e){var n=this.expr1.visit(e),r=this.expr2.visit(e),i=this.expr1.dataType||this.expr2.dataType,a=e.entityType.metadataStore.localQueryComparisonOptions,o=t(this,i,a);if(null==o)throw new Error("Invalid binaryPredicate operator:"+this.op.key);return function(e){return o(n(e),r(e))}},andOrPredicate:function(e){var t=this.preds.map(function(t){return t.visit(e)});switch(this.op.key){case"and":return function(e){var n=t.reduce(function(t,n){return t&&n(e)},!0);return n};case"or":return function(e){var n=t.reduce(function(t,n){return t||n(e)},!1);return n};default:throw new Error("Invalid boolean operator:"+op.key)}},anyAllPredicate:function(t){var n=this.expr.visit(t),r=c({},t);r.entityType=this.expr.dataType;var i=this.pred.visit(r),a=e(this.op);return function(e){return a(n(e),i)}},litExpr:function(){var e=this.value;return function(){return e}},propExpr:function(){var e=this.propertyPath,t=e.split(".");return 1===t.length?function(t){return t.getProperty(e)}:function(e){return nt(e,t)}},fnExpr:function(e){var t=this.exprs.map(function(t){return t.visit(e)}),n=this;return function(e){var r=t.map(function(t){var n=t(e);return n}),i=n.localFn.apply(null,r);return i}}};return o}(),w=function(){function e(t,n){var r=Object.keys(n).every(function(r){if(t.hasOwnProperty(r)){if("object"!=typeof n[r])return!1;if(null==e(t[r],n[r]))return!1}else t[r]=n[r];return!0});return r?t:null}var t={passthruPredicate:function(){return this.value},unaryPredicate:function(e){var t=this.pred.visit(e),n={};return n[this.op.key]=t,n},binaryPredicate:function(e){var t=this.expr1.visit(e),n=this.expr2.visit(e),r={};if(this.expr2 instanceof d&&(n={value:n,isProperty:!0}),"eq"===this.op.key)r[t]=n;else{var i={};r[t]=i,i[this.op.key]=n}return r},andOrPredicate:function(t){var n,r=this.preds.map(function(e){return e.visit(t)});return"and"!==this.op.key||2!==r.length||r.some(V)||(n=r.reduce(e)),null==n&&(n={},n[this.op.key]=r),n},anyAllPredicate:function(e){var t=this.expr.visit(e),n=c({},e);n.entityType=this.expr.dataType;var r=this.pred.visit(n),i={},a={};return a[this.op.key]=r,i[t]=a,i},litExpr:function(e){return this.hasExplicitDataType||e.useExplicitDataType?{value:this.value,dataType:this.dataType.name}:this.value},propExpr:function(e){return e.toNameOnServer?e.entityType.clientPropertyPathToServer(this.propertyPath):this.propertyPath},fnExpr:function(e){var t=this.exprs.map(function(t){return t.visit(e)});return this.fnName+"("+t.join(",")+")"}};return t}();return i}();rt.Predicate=qt;var Bt=function(){function e(e,t){return f(t,{"resourceName,from":null,"resultEntityType,toType":null,"wherePredicate,where":function(e){return e?new qt(e):void 0},"orderByClause,orderBy":function(e){return e?new Ut(e):void 0},"selectClause,select":function(e){return e?new zt(e):void 0},"expandClause,expand":function(e){return e?new Lt(e):void 0},"skipCount,skip":null,"takeCount,take":null,parameters:function(e){return K(e)?void 0:e},"inlineCountEnabled,inlineCount":!1,"noTrackingEnabled,noTracking":!1,queryOptions:function(e){return e?Ht.fromJSON(e):void 0}},e),e}function n(e,t,n){if(t&&e[t]===n)return e;var r=c(new Bt,e,["resourceName","fromEntityType","wherePredicate","orderByClause","selectClause","skipCount","takeCount","expandClause","inlineCountEnabled","noTrackingEnabled","usesNameOnServer","queryOptions","entityManager","dataService","resultEntityType"]);return r.parameters=c({},e.parameters),t&&(r[t]=n),r}function r(e,n,i,a){var o=i._$typeName||i.parentEnum&&i.parentEnum.name,s=o&&o.substr(0,1).toLowerCase()+o.substr(1);if(a&&s!=a)throw new Error("Invalid value for property: "+a);if(s){var u=n[s];if(void 0===u)throw new Error("Invalid config property: "+s);null===u?e[s]=i:u(e,i)}else t(i,function(t,i){r(e,n,i,t)})}function i(e){return ct(e,"propertyPaths").isOptional().isString().or().isArray().isString().check(),"string"==typeof e&&(e=e.split(",")),e=e.map(function(e){return e.trim()})}function a(e){var t=e.entityType,n=t.keyProperties.map(function(t){return qt.create(t.name,Kt.Equals,e.getProperty(t.name))}),r=qt.and(n);return r}function o(e){var t=e.entityType.keyProperties,n=S(t,e.values,function(e,t){return qt.create(e.name,Kt.Equals,t)}),r=qt.and(n);return r}function s(e,t){if(t.isScalar){if(0===t.foreignKeyNames.length)return null;var n=t.foreignKeyNames.map(function(t){return e.getProperty(t)}),r=new Tt(t.entityType,n);return o(r)}var i=t.inverse,a=i?i.foreignKeyNames:t.invForeignKeyNames;if(0===a.length)return null;var s=e.entityAspect.getKey().values,u=S(a,s,function(e,t){return qt.create(e,Kt.Equals,t)});return qt.and(u)}var u=function(t){return null==t||V(t)?(this.resourceName=t,this.fromEntityType=null,this.wherePredicate=null,this.orderByClause=null,this.selectClause=null,this.skipCount=null,this.takeCount=null,this.expandClause=null,this.parameters={},this.inlineCountEnabled=!1,this.noTrackingEnabled=!1,void(this.entityManager=null)):e(this,t)},l=u.prototype;return l._$typeName="EntityQuery",l.from=function(e){return ct(e,"resourceName").isString().check(),n(this,"resourceName",e)},u.from=function(e){return ct(e,"resourceName").isString().check(),new Bt(e)},l.toType=function(e){return ct(e,"entityType").isString().or().isInstanceOf(kt).check(),n(this,"resultEntityType",e)},l.where=function(e){return null!=e&&(e=qt.create(at(arguments)),this.fromEntityType&&e._validate(this.fromEntityType),this.wherePredicate&&(e=this.wherePredicate.and(e))),n(this,"wherePredicate",e)},l.orderBy=function(e,t){var r=null==e?null:new Ut(i(e),t);return this.orderByClause&&r&&(r=new Ut([this.orderByClause,r])),n(this,"orderByClause",r)},l.orderByDesc=function(e){return this.orderBy(e,!0)},l.select=function(e){var t=null==e?null:new zt(i(e));return n(this,"selectClause",t)},l.skip=function(e){return ct(e,"count").isOptional().isNumber().check(),n(this,"skipCount",null==e?null:e)},l.top=function(e){return this.take(e)},l.take=function(e){return ct(e,"count").isOptional().isNumber().check(),n(this,"takeCount",null==e?null:e)},l.expand=function(e){var t=null==e?null:new Lt(i(e));return n(this,"expandClause",t)},l.withParameters=function(e){return ct(e,"parameters").isObject().check(),n(this,"parameters",e)},l.inlineCount=function(e){return ct(e,"enabled").isBoolean().isOptional().check(),e=void 0===e?!0:!!e,n(this,"inlineCountEnabled",e)},l.useNameOnServer=function(e){return ct(e,"usesNameOnServer").isBoolean().isOptional().check(),e=void 0===e?!0:!!e,n(this,"usesNameOnServer",e)},l.noTracking=function(e){return ct(e,"enabled").isBoolean().isOptional().check(),e=void 0===e?!0:!!e,n(this,"noTrackingEnabled",e)},l.using=function(e){if(!e)return this;var t=n(this);return r(t,{entityManager:null,dataService:null,queryOptions:null,fetchStrategy:function(e,t){e.queryOptions=(e.queryOptions||new Ht).using(t)},mergeStrategy:function(e,t){e.queryOptions=(e.queryOptions||new Ht).using(t)},jsonResultsAdapter:function(e,t){e.dataService=(e.dataService||new _t).using({jsonResultsAdapter:t})}},e),t},l.execute=function(e,t){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'execute'");return this.entityManager.executeQuery(this,e,t)},l.executeLocally=function(){if(!this.entityManager)throw new Error("An EntityQuery must have its EntityManager property set before calling 'executeLocally'");return this.entityManager.executeQueryLocally(this)},l.toJSON=function(){return this.toJSONExt()},l.toJSONExt=function(e){e=e||{},e.entityType=e.entityType||this.fromEntityType,e.propertyPathFn=e.toNameOnServer?e.entityType.clientPropertyPathToServer.bind(e.entityType):F;var t=function(t){return t?t.toJSONExt(e):void 0};return f(this,{"from,resourceName":null,"toType,resultEntityType":function(e){return e?V(e)?e:e.name:void 0},"where,wherePredicate":t,"orderBy,orderByClause":t,"select,selectClause":t,"expand,expandClause":t,"skip,skipCount":null,"take,takeCount":null,parameters:function(e){return K(e)?void 0:e},"inlineCount,inlineCountEnabled":!1,"noTracking,noTrackingEnabled":!1,queryOptions:null})},u.fromEntities=function(e){ct(e,"entities").isEntity().or().isNonEmptyArray().isEntity().check(),Array.isArray(e)||(e=at(arguments));var t=e[0],n=t.entityType;if(e.some(function(e){return e.entityType!==n}))throw new Error("All 'fromEntities' must be the same type; at least one is not of type "+n.name);var r=new Bt(n.defaultResourceName),i=e.map(function(e){return a(e)}),o=qt.or(i);r=r.where(o);var s=t.entityAspect.entityManager;return s&&(r=r.using(s)),r},u.fromEntityKey=function(e){ct(e,"entityKey").isInstanceOf(Tt).check();var t=new Bt(e.entityType.defaultResourceName),n=o(e);return t=t.where(n).toType(e.entityType)},u.fromEntityNavigation=function(e,t){ct(e,"entity").isEntity().check();var n=e.entityType._checkNavProperty(t),r=new Bt(n.entityType.defaultResourceName),i=s(e,n);r=r.where(i);var a=e.entityAspect.entityManager;return a?r.using(a):r},l._getFromEntityType=function(e,t){var n=this.fromEntityType;if(n)return n;var r=this.resourceName;if(!r)throw new Error("There is no resourceName for this query");if(e.isEmpty()){if(t)throw new Error("There is no metadata available for this query. Are you querying the local cache before you've fetched metadata?");return null}var i=e.getEntityTypeNameForResourceName(r);if(n=i?e._getEntityType(i):this._getToEntityType(e,!0),!n){if(t)throw new Error($("Cannot find an entityType for resourceName: '%1'.  Consider adding an 'EntityQuery.toType' call to your query or calling the MetadataStore.setEntityTypeForResourceName method to register an entityType for this resourceName.",r));return null}return this.fromEntityType=n,n},l._getToEntityType=function(e,t){return this.resultEntityType instanceof kt?this.resultEntityType:this.resultEntityType?(this.resultEntityType=e._getEntityType(this.resultEntityType,!1),this.resultEntityType):t?null:!this.selectClause&&this._getFromEntityType(e,!1)},l._toUri=function(e){var t=_t.resolve([e.dataService]);return t.uriBuilder.buildUri(this,e.metadataStore)},u}(),Kt=function(){var e=new ft("FilterQueryOp");return e.Equals=e.addSymbol({operator:"eq"}),e.NotEquals=e.addSymbol({operator:"ne"}),e.GreaterThan=e.addSymbol({operator:"gt"}),e.LessThan=e.addSymbol({operator:"lt"}),e.GreaterThanOrEqual=e.addSymbol({operator:"ge"}),e.LessThanOrEqual=e.addSymbol({operator:"le"}),e.Contains=e.addSymbol({operator:"contains"}),e.StartsWith=e.addSymbol({operator:"startswith"}),e.EndsWith=e.addSymbol({operator:"endswith"}),e.Any=e.addSymbol({operator:"any"}),e.All=e.addSymbol({operator:"all"}),e.IsTypeOf=e.addSymbol({operator:"isof"}),e.resolveSymbols(),e}(),Ut=(function(){var e=new ft("BooleanQueryOp");return e.And=e.addSymbol({operator:"and"}),e.Or=e.addSymbol({operator:"or"}),e.Not=e.addSymbol({operator:"not"}),e.resolveSymbols(),e}(),function(){var e=function(e,t){if(e.length>1){if(e[0]instanceof Ut)return void(this.items=Array.prototype.concat.apply(e[0].items,e.slice(1).map(s("items"))));var r=e.map(function(e){return new n(e,t)})}else var r=[new n(e[0],t)];this.items=r},t=e.prototype;t.validate=function(e){null==e||e.isAnonymous||this.items.forEach(function(t){t.validate(e)})},t.getComparer=function(e){var t=this.items.map(function(t){return t.getComparer(e)});return function(e,n){for(var r=0;r<t.length;r++){var i=t[r](e,n);if(0!==i)return i}return 0}},t.toJSONExt=function(e){return this.items.map(function(t){return e.propertyPathFn(t.propertyPath)+(t.isDesc?" desc":"")})};var n=function(e,t){if("string"!=typeof e)throw new Error("propertyPath is not a string");e=e.trim();var n=e.split(" ");if(n.length>1&&t!==!0&&t!==!1&&(t=z(n[1].toLowerCase(),"desc"),!t)){var r=z(n[1].toLowerCase(),"asc");if(!r)throw new Error("the second word in the propertyPath must begin with 'desc' or 'asc'")}this.propertyPath=n[0],this.isDesc=t},r=n.prototype;return r.validate=function(e){null==e||e.isAnonymous||(this.lastProperty=e.getProperty(this.propertyPath,!0))},r.getComparer=function(e){if(this.lastProperty||this.validate(e),this.lastProperty)var t=this.lastProperty.dataType,n=this.lastProperty.parentType.metadataStore.localQueryComparisonOptions.isCaseSensitive;var r=this.propertyPath,i=this.isDesc;return function(e,a){var o=nt(e,r),s=nt(a,r),u=t||o&&Pt.fromValue(o)||Pt.fromValue(s);if(u===Pt.String)n?(o=o||"",s=s||""):(o=(o||"").toLowerCase(),s=(s||"").toLowerCase());else{var c=Pt.getComparableFn(u);o=c(o),s=c(s)}return o===s?0:o>s||void 0===s?i?-1:1:i?1:-1}},e}()),zt=function(){var e=function(e){this.propertyPaths=e,this._pathNames=e.map(function(e){return e.replace(".","_")})},t=e.prototype;return t.validate=function(e){null==e||e.isAnonymous||this.propertyPaths.forEach(function(t){e.getProperty(t,!0)})},t.toFunction=function(){var e=this;return function(t){var n={};return e.propertyPaths.forEach(function(r,i){n[e._pathNames[i]]=nt(t,r)}),n}},t.toJSONExt=function(e){return this.propertyPaths.map(function(t){return e.propertyPathFn(t)})},e}(),Lt=function(){var e=function(e){this.propertyPaths=e},t=e.prototype;return t.toJSONExt=function(e){return this.propertyPaths.map(function(t){return e.propertyPathFn(t)})},e}();rt.FilterQueryOp=Kt,rt.EntityQuery=Bt,rt.OrderByClause=Ut;var $t=function(){var e=new ft("MergeStrategy");return e.PreserveChanges=e.addSymbol(),e.OverwriteChanges=e.addSymbol(),e.SkipMerge=e.addSymbol(),e.Disallowed=e.addSymbol(),e.resolveSymbols(),e}(),Gt=function(){var e=new ft("FetchStrategy");return e.FromServer=e.addSymbol(),e.FromLocalCache=e.addSymbol(),e.resolveSymbols(),e}(),Ht=function(){function e(e,t){return t&&pt(t).whereParam("fetchStrategy").isEnumOf(Gt).isOptional().whereParam("mergeStrategy").isEnumOf($t).isOptional().whereParam("includeDeleted").isBoolean().isOptional().applyAll(e),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="QueryOptions",t.resolve=function(e){return new Ht(h(e,["fetchStrategy","mergeStrategy","includeDeleted"]))},t.defaultInstance=new t({fetchStrategy:Gt.FromServer,mergeStrategy:$t.PreserveChanges,includeDeleted:!1}),n.using=function(t){if(!t)return this;var n=new Ht(this);return $t.contains(t)?t={mergeStrategy:t}:Gt.contains(t)&&(t={fetchStrategy:t}),e(n,t)},n.setAsDefault=function(){return p(this,t)},n.toJSON=function(){return f(this,{fetchStrategy:null,mergeStrategy:null,includeDeleted:!1})},t.fromJSON=function(e){return new Ht({fetchStrategy:Gt.fromName(e.fetchStrategy),mergeStrategy:$t.fromName(e.mergeStrategy),includeDeleted:e.includeDeleted===!0})},t}();rt.QueryOptions=Ht,rt.FetchStrategy=Gt,rt.MergeStrategy=$t;var Jt=function(){function e(e){if(e){if(1===e.length){var t=e[0];return function(e){return e?e.entityAspect.entityState===t:!1}}return function(t){return t?e.some(function(e){return t.entityAspect.entityState===e}):!1}}return function(e){return!!e}}var t=e([xt.Added,xt.Modified,xt.Deleted]),n=function(e,t){this.entityManager=e,this.entityType=t,this.entityType.isFrozen=!0,this._indexMap={},this._entities=[],this._emptyIndexes=[]},r=n.prototype;return r.attachEntity=function(e,t,n){var r=e.entityAspect;r._initialized||this.entityType._initializeInstance(e),delete r._initialized;var i=r.getKey()._keyInGroup,a=this._indexMap[i];if(a>=0){var o=this._entities[a],s=o.entityAspect.entityState,u=s.isUnchanged();if(o===e)r.entityState=t;else{if(n===$t.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' does not allow you to attach an entity when an entity with the same key is already attached: "+r.getKey());if(n===$t.OverwriteChanges||n===$t.PreserveChanges&&u){var c=this.entityManager.helper.unwrapInstance(e);this.entityType._updateTargetFromRaw(o,c,Dt.getRawValueFromServer),o.entityAspect.setEntityState(t)}}return o}return 0===this._emptyIndexes.length?a=this._entities.push(e)-1:(a=this._emptyIndexes.pop(),this._entities[a]=e),this._indexMap[i]=a,r.entityState=t,r.entityGroup=this,r.entityManager=this.entityManager,e},r.detachEntity=function(e){var t=e.entityAspect,n=t.getKey()._keyInGroup,r=this._indexMap[n];if(void 0===r)throw new Error("internal error - entity cannot be found in group");
return delete this._indexMap[n],this._emptyIndexes.push(r),this._entities[r]=null,e},r.findEntityByKey=function(e){var t;t=e instanceof Tt?e._keyInGroup:Tt.createKeyString(e);var n=this._indexMap[t];return void 0!==n?this._entities[n]:null},r.hasChanges=function(){return this._entities.some(t)},r.getEntities=function(t){var n=e(t);return this._entities.filter(n)},r._checkOperation=function(e){return this._entities.forEach(function(t){t&&t.entityAspect._checkOperation(e)}),this},r._clear=function(){this._entities.forEach(function(e){null!=e&&e.entityAspect._detach()}),this._entities=null,this._indexMap=null,this._emptyIndexes=null},r._updateFkVal=function(e,t,n){var r=e.name;this._entities.forEach(function(e){null!=e&&e.getProperty(r)==t&&e.setProperty(r,n)})},r._fixupKey=function(e,t){var n=this._indexMap[e];if(void 0===n)throw new Error("Internal Error in key fixup - unable to locate entity");var r=this._entities[n],i=r.entityType.keyProperties[0].name;r.setProperty(i,t),delete r.entityAspect.hasTempKey,delete this._indexMap[e],this._indexMap[t]=n},r._replaceKey=function(e,t){var n=this._indexMap[e._keyInGroup];delete this._indexMap[e._keyInGroup],this._indexMap[t._keyInGroup]=n},n}(),Qt=function(){function e(e,t,n){var r=n?Ht.defaultInstance:e.queryOptions,i=n?Zt.defaultInstance:e.saveOptions,a=n?bt.defaultInstance:e.validationOptions,o=pt(t).whereParam("serviceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(_t).whereParam("queryOptions").isInstanceOf(Ht).isOptional().withDefault(r).whereParam("saveOptions").isInstanceOf(Zt).isOptional().withDefault(i).whereParam("validationOptions").isInstanceOf(bt).isOptional().withDefault(a).whereParam("keyGeneratorCtor").isFunction().isOptional();n&&(o=o.whereParam("metadataStore").isInstanceOf(At).isOptional().withDefault(new At)),o.applyAll(e),l(e.queryOptions,r),l(e.saveOptions,i),l(e.validationOptions,a),t.serviceName&&(e.dataService=new _t({serviceName:e.serviceName})),e.serviceName=e.dataService&&e.dataService.serviceName,e.keyGeneratorCtor=e.keyGeneratorCtor||jt,(n||t.keyGeneratorCtor)&&(e.keyGenerator=new e.keyGeneratorCtor)}function r(e){e.forEach(function(e){var n=[],r=e.entityAspect;t(r._validationErrors,function(e,t){t.isServerError&&n.push(e)}),0!==n.length&&r._processValidationOpAndPublish(function(){n.forEach(function(e){r._removeValidationError(e)})})})}function i(e){var n=[];return e.forEach(function(e){t(e.entityAspect._validationErrors,function(t,r){var i=c({entity:e,errorName:r.validator.name},r,["errorMessage","propertyName","isServerError"]);n.push(i)})}),n}function a(e,t){var n=t.entityErrors;if(n){var r=e.entityManager,i=r.metadataStore;t.entityErrors=n.map(function(e){var t=null;if(e.keyValues){var n=i._getEntityType(e.entityTypeName),a=new Tt(n,e.keyValues);t=r.findEntityByKey(a)}if(t){var o=e.propertyName?{propertyName:e.propertyName,property:n.getProperty(e.propertyName)}:{},s=gt.getKey(e.errorName||e.errorMessage,e.propertyName),u=new gt(null,o,e.errorMessage,s);u.isServerError=!0,t.entityAspect.addValidationError(u)}var l=c({entity:t,isServerError:!0},e,["errorName","errorMessage","propertyName"]);return l})}}function o(e,t){var n,r=f(e,t),i=r.entityKey,a=0===r.remainingArgs.length?!1:!!r.remainingArgs[0],o=!1;return a&&(n=e.getEntityByKey(i),o=!!n,o&&!e.queryOptions.includeDeleted&&n.entityAspect.entityState.isDeleted()&&(n=null,o=e.queryOptions.mergeStrategy!==$t.OverwriteChanges)),o?Ot.resolve({entity:n,entityKey:i,fromCache:!0}):Bt.fromEntityKey(i).using(e).execute().then(function(e){return n=0===e.results.length?null:e.results[0],Ot.resolve({entity:n,entityKey:i,fromCache:!1})})}function s(e,t){return ct(t,"entityTypes").isString().isOptional().or().isNonEmptyArray().isString().or().isInstanceOf(kt).or().isNonEmptyArray().isInstanceOf(kt).check(),"string"==typeof t?t=e.metadataStore._getEntityType(t,!1):Array.isArray(t)&&"string"==typeof t[0]&&(t=t.map(function(t){return e.metadataStore._getEntityType(t,!1)})),t}function p(e,t,n){var r,i=D(e,t);return i.forEach(function(e){if(e){var t=e.getEntities(n);r?r.push.apply(r,t):r=t}}),r||[]}function f(e,t){try{if(t[0]instanceof Tt)return{entityKey:t[0],remainingArgs:at(t,1)};if(t.length>=2){var n="string"==typeof t[0]?e.metadataStore._getEntityType(t[0],!1):t[0];return{entityKey:new Tt(n,t[1]),remainingArgs:at(t,2)}}}catch(r){}throw new Error("Must supply an EntityKey OR an EntityType name or EntityType followed by a key value or an array of key values.")}function h(e,t){e.forEach(function(e){e.entityAspect.isBeingSaved=t})}function g(e,n){var r,i=n&&n[0];if(i)if(r={},i.entityType)n.forEach(function(e){var t=r[e.entityType.name];t||(t={},t.entityType=e.entityType,t._entities=[],r[e.entityType.name]=t),t._entities.push(e)});else{var a=s(e,n);a.forEach(function(t){var n=e._entityGroupMap[t.name];n&&n._entities.length&&(r[t.name]=n)})}else r=e._entityGroupMap;var o=[],u={};return t(r,function(e,t){u[e]=b(t,o)}),{entityGroupMap:u,tempKeys:o}}function b(e,t){var n={},r=e.entityType,i=r.dataProperties,a=W(r),o=[];return e._entities.forEach(function(e){if(e){var n=E(e,i,a,t);o.push(n)}}),n.entities=o,n}function E(e,t,n,r){var i={};t.forEach(function(t){var r=t.name,a=e.getProperty(r);if(null!=a||null!=t.defaultValue){if(a&&t.isComplexProperty){var o=t.dataType.dataProperties;a=v(a,function(e){return E(e,o,n)})}else a=n?n(t,a):a,t.isUnmapped&&(a=d(a));void 0!==a&&(i[r]=a)}});var a,o;if(e.entityAspect){a=e.entityAspect;var s=a.entityState;o={tempNavPropNames:x(a,r),entityState:s.name},a.extraMetadata&&(o.extraMetadata=a.extraMetadata),(s.isModified()||s.isDeleted())&&(o.originalValuesMap=a.originalValues),i.entityAspect=o}else a=e.complexAspect,o={},a.originalValues&&!K(a.originalValues)&&(o.originalValuesMap=a.originalValues),i.complexAspect=o;return i}function x(e,t){var n=e.entity;e.hasTempKey&&t.push(e.getKey().toJSON());var r;return n.entityType.navigationProperties.forEach(function(e){if(e.relatedDataProperties){var t=n.getProperty(e.name);t&&t.entityAspect.hasTempKey&&(r=r||[],r.push(e.name))}}),r}function P(e,t,n){var r=n.tempKeyMap,i=e.entityType,a=n.mergeStrategy,o=null,s=e.entityManager,u=s.entityChanged,c=[],l=Dt.getRawValueFromClient;return t.entities.forEach(function(t){var n=t.entityAspect,p=i.getEntityKeyFromRawEntity(t,l),f=xt.fromName(n.entityState),d=f.isAdded()&&O(r,p);if(o=d?null:e.findEntityByKey(p))if(a===$t.SkipMerge);else{if(a===$t.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+p.toString()+" from being merged");var h=o.entityAspect.entityState,y=h.isUnchanged();(a===$t.OverwriteChanges||y)&&(i._updateTargetFromRaw(o,t,l),o.entityAspect.setEntityState(f),u.publish({entityAction:wt.MergeOnImport,entity:o}))}else o=i._createInstanceCore(),i._updateTargetFromRaw(o,t,l),d&&(o.entityAspect.hasTempKey=!0,o.setProperty(i.keyProperties[0].name,d.values[0]),n.tempNavPropNames&&n.tempNavPropNames.forEach(function(e){var t=i.getNavigationProperty(e),n=t.relatedDataProperties[0].name,a=o.getProperty(n),s=new Tt(t.entityType,[a]),u=O(r,s);o.setProperty(n,u.values[0])})),o=e.attachEntity(o,f),u.publish({entityAction:wt.AttachOnImport,entity:o}),f.isUnchanged()||s._notifyStateChange(o,!0);c.push(o)}),c}function O(e,t){var n=e[t.toString()];if(n)return n;var r=t._subtypes;if(!r)return null;for(var i=0,a=r.length;a>i;i++)if(n=e[t.toString(r[i])])return n;return null}function C(e,t,n){return e=e.then(function(e){return t&&t(e),Ot.resolve(e)},function(e){return n&&n(e),Ot.reject(e)})}function k(e,t){var n;return n=t?t.filter(function(t){if(t.entityAspect.entityManager!==e)throw new Error("Only entities in this entityManager may be saved");return!t.entityAspect.entityState.isDetached()}):e.getChanges()}function F(e,t){e._inKeyFixup=!0,t.forEach(function(t){var n=e._entityGroupMap[t.entityTypeName];if(!n)throw new Error("Unable to locate the following fully qualified EntityType name: "+t.entityTypeName);n._fixupKey(t.tempValue,t.realValue)}),e._inKeyFixup=!1}function D(e,t){var n=e._entityGroupMap;return t?y(t).map(function(e){if(e instanceof kt)return n[e.name];throw new Error("The EntityManager.getChanges() 'entityTypes' parameter must be either an entityType or an array of entityTypes or null")}):u(n)}function I(e,t){var n=t.entityAspect.getKey(),r=S(t.entityType.keyProperties,n.values,function(e,t){return e.defaultValue===t?e:null}).filter(function(e){return null!==e});if(r.length)if(t.entityType.autoGeneratedKeyType!==Mt.None)e.generateTempKeyValue(t);else if(r.length===n.values.length)throw new Error("Cannot attach an object of type  ("+t.entityType.name+") to an EntityManager without first setting its key or setting its entityType 'AutoGeneratedKeyType' property to something other than 'None'")}function M(e,t){return t?(t=y(t),t.forEach(function(e){if(!xt.contains(e))throw new Error("The EntityManager.getChanges() 'entityStates' parameter must either be null, an entityState or an array of entityStates")}),t):null}function j(e,t,n,r){var i=t.entityType.navigationProperties;i.forEach(function(i){var a=t.getProperty(i.name);if(i.isScalar){if(!a)return;e.attachEntity(a,n,r)}else a.forEach(function(t){e.attachEntity(t,n,r)})})}function V(e,t,r,i){try{var a,o=e.metadataStore;if(o.isEmpty()&&i.hasServerMetadata)throw new Error("cannot execute _executeQueryCore until metadataStore is populated.");if(r.fetchStrategy===Gt.FromLocalCache)try{return a=e.executeQueryLocally(t),Ot.resolve({results:a,query:t})}catch(s){return Ot.reject(s)}var u=new Wt({query:t,entityManager:e,dataService:i,mergeOptions:{mergeStrategy:r.mergeStrategy,noTracking:!!t.noTrackingEnabled,includeDeleted:r.includeDeleted}}),c=e.validationOptions.validateOnQuery;return i.adapterInstance.executeQuery(u).then(function(r){var o=N(function(){var t={isLoading:e.isLoading};return e.isLoading=!0,e._pendingPubs=[],t},function(n){e.isLoading=n.isLoading,e._pendingPubs.forEach(function(e){e()}),e._pendingPubs=null,e._hasChangesAction&&e._hasChangesAction(),t=null,u=null,n.error&&Ot.reject(n.error)},function(){var o=i.jsonResultsAdapter.extractResults(r);o=y(o),a=u.visitAndMerge(o,{nodeType:"root"}),c&&a.forEach(function(e){e.entityAspect&&e.entityAspect.validateEntity()}),u.processDeferred(),R(a,t);var s=n(u.refMap);return{results:a,query:t,entityManager:e,httpResponse:r.httpResponse,inlineCount:r.inlineCount,retrievedEntities:s}});return Ot.resolve(o)},function(n){return n&&(n.query=t,n.entityManager=e),Ot.reject(n)})}catch(s){return s&&(s.query=t),Ot.reject(s)}}function R(e,t){if(!t.noTrackingEnabled){var n=t.expandClause;null!=n&&n.propertyPaths.forEach(function(t){var n=t.split(".");q(e,n)})}}function q(e,t){var n=t[0];e.forEach(function(e){var r=e.entityAspect;if(r&&(r._markAsLoaded(n),1!==t.length)){var i=e.getProperty(n);i&&(i.arrayChanged||(i=[i]),q(i,t.slice(1)))}})}function B(e){var t=e.filter(function(e){return e.entityAspect.isBeingSaved=!0,e.entityAspect.entityState.isModified()&&e.entityType.concurrencyProperties.length>0});0!==t.length&&t.forEach(function(e){e.entityType.concurrencyProperties.forEach(function(t){U(e,t)})})}function U(e,t){if(!e.entityAspect.originalValues[t.name]){var n=e.getProperty(t.name);if(n||(n=t.dataType.defaultValue),t.dataType.isNumeric)e.setProperty(t.name,n+1);else if(t.dataType.isDate){for(var r=new Date,i=new Date;r.getTime()===i.getTime();)i=new Date;e.setProperty(t.name,i)}else{if(t.dataType!==Pt.Guid){if(t.dataType===Pt.Binary)return;throw new Error("Unable to update the value of concurrency property before saving: "+t.name)}e.setProperty(t.name,A())}}}function z(e,t){var n=e._entityGroupMap[t.name];return n||(n=new Jt(e,t),e._entityGroupMap[t.name]=n),n}function L(e,t){var n=t.getSelfAndSubtypes();return n.map(function(t){return z(e,t)})}function $(e,t){var n={},r=e.entityType||e.complexType,i=W(r),a={};return r.dataProperties.forEach(function(r){if(r.isComplexProperty)n[r.nameOnServer]=v(e.getProperty(r.name),function(e){return $(e,t)});else{var o=e.getProperty(r.name);if(o=t?t(r,o):o,void 0===o)return;o=i?i(r,o):o,void 0!==o&&(r.isUnmapped?a[r.nameOnServer]=d(o):n[r.nameOnServer]=o)}}),K(a)||(n.__unmapped=a),n}function G(e,n,r){var i=e.entityType||e.complexType,a=e.entityAspect||e.complexAspect,o=n.namingConvention.clientPropertyNameToServer,s={};return t(a.originalValues,function(e,t){var n=i.getProperty(e);t=r?r(n,t):t,void 0!==t&&(s[o(e,n)]=t)}),i.complexProperties.forEach(function(t){var i=e.getProperty(t.name);if(t.isScalar){var a=G(i,n,r);K(a)||(s[o(t.name,t)]=a)}else{var u=i.map(function(e){return G(e,n,r)});s[o(t.name,t)]=u}}),s}function H(e,n,r){var i=e.entityType,a=W(i),o=n.namingConvention.clientPropertyNameToServer,s={};return t(e.entityAspect.originalValues,function(t){var n=i.getProperty(t),u=e.getProperty(t);u=r?r(n,u):u,void 0!==u&&(u=a?a(n,u):u,void 0!==u&&(s[o(t,n)]=u))}),i.complexProperties.forEach(function(t){if(J(e,t)){var n=e.getProperty(t.name);s[o(t.name,t)]=v(n,function(e){return $(e,r)})}}),s}function J(e,t){var n=e.getProperty(t.name);return t.isScalar?Q(n):n._origValues?!0:n.some(function(e){return Q(e)})}function Q(e){return K(e.complexAspect.originalValues)?e.complexType.complexProperties.some(function(t){return J(e,t)}):!0}function W(e){return e.serializerFn||e.metadataStore&&e.metadataStore.serializerFn}function Z(){this.map={}}var X=function(t){if(arguments.length>1)throw new Error("The EntityManager ctor has a single optional argument that is either a 'serviceName' or a configuration object.");0===arguments.length?t={serviceName:""}:"string"==typeof t&&(t={serviceName:t}),e(this,t,!0),this.entityChanged=new dt("entityChanged",this),this.validationErrorsChanged=new dt("validationErrorsChanged",this),this.hasChangesChanged=new dt("hasChangesChanged",this),this.clear()},Y=X.prototype;return Y._$typeName="EntityManager",dt.bubbleEvent(Y,null),Y.setProperties=function(t){e(this,t,!1)},Y.createEntity=function(e,t,n,r){ct(e,"entityType").isString().or().isInstanceOf(kt).check(),ct(n,"entityState").isEnumOf(xt).isOptional().check(),ct(r,"mergeStrategy").isEnumOf($t).isOptional().check(),"string"==typeof e&&(e=this.metadataStore._getEntityType(e)),n=n||xt.Added;var i;return _(this,"isLoading",!0,function(){i=e.createEntity(t)}),n!==xt.Detached&&(i=this.attachEntity(i,n,r)),i},X.importEntities=function(e,t){var n=new Qt;return n.importEntities(e,t),n},Y.acceptChanges=function(){this.getChanges().map(function(e){return e.entityAspect._checkOperation("acceptChanges")}).forEach(function(e){e.acceptChanges()})},Y.exportEntities=function(e,t){ct(e,"entities").isArray().isEntity().or().isNonEmptyArray().isInstanceOf(kt).or().isNonEmptyArray().isString().or().isOptional().check(),ct(t,"config").isObject().or().isBoolean().or().isOptional().check(),null==t?t={includeMetadata:!0,asString:!0}:"boolean"==typeof t&&(t={includeMetadata:t,asString:!0}),pt(t).whereParam("asString").isBoolean().isOptional().withDefault(!0).whereParam("includeMetadata").isBoolean().isOptional().withDefault(!0).applyAll(t);var n=g(this,e),r=c({},n,["tempKeys","entityGroupMap"]);t.includeMetadata?(r=c(r,this,["dataService","saveOptions","queryOptions","validationOptions"]),r.metadataStore=this.metadataStore.exportMetadata()):(r.metadataVersion=rt.metadataVersion,r.metadataStoreName=this.metadataStore.name);var i=t.asString?JSON.stringify(r,null,ht.stringifyPad):r;return i},Y.importEntities=function(e,n){n=n||{},pt(n).whereParam("mergeStrategy").isEnumOf($t).isOptional().withDefault(this.queryOptions.mergeStrategy).whereParam("metadataVersionFn").isFunction().isOptional().applyAll(n);var r=this,i="string"==typeof e?JSON.parse(e):e;i.metadataStore?(this.metadataStore.importMetadata(i.metadataStore),this.dataService=i.dataService&&_t.fromJSON(i.dataService)||new _t({serviceName:i.serviceName}),this.saveOptions=new Zt(i.saveOptions),this.queryOptions=Ht.fromJSON(i.queryOptions),this.validationOptions=new bt(i.validationOptions)):n.metadataVersionFn&&n.metadataVersionFn({metadataVersion:i.metadataVersion,metadataStoreName:i.metadataStoreName});var a={};i.tempKeys.forEach(function(e){var t=Tt.fromJSON(e,r.metadataStore);a[t.toString()]=new Tt(t.entityType,r.keyGenerator.generateTempKeyValue(t.entityType,t.values[0]))});var o=[];return n.tempKeyMap=a,N(function(){r._pendingPubs=[]},function(){r._pendingPubs.forEach(function(e){e()}),r._pendingPubs=null,r._hasChangesAction&&r._hasChangesAction()},function(){t(i.entityGroupMap,function(e,t){var i=r.metadataStore._getEntityType(e,!0),a=z(r,i),s=P(a,t,n);Array.prototype.push.apply(o,s)}),o.forEach(function(e){e.entityAspect.entityState.isDeleted()||r._linkRelatedEntities(e)})}),{entities:o,tempKeyMapping:a}},Y.clear=function(){n(this._entityGroupMap,function(e,t){return t._checkOperation()}).forEach(function(e){e._clear()}),this._entityGroupMap={},this._unattachedChildrenMap=new Z,this.keyGenerator=new this.keyGeneratorCtor,this.entityChanged.publish({entityAction:wt.Clear}),this._setHasChanges(!1)},Y.createEmptyCopy=function(){var e=new X(c({},this,["dataService","metadataStore","queryOptions","saveOptions","validationOptions","keyGeneratorCtor"]));return e},Y.addEntity=function(e){return this.attachEntity(e,xt.Added)},Y.attachEntity=function(e,t,n){if(ct(e,"entity").isRequired().check(),this.metadataStore._checkEntityType(e),t=ct(t,"entityState").isEnumOf(xt).isOptional().check(xt.Unchanged),n=ct(n,"mergeStrategy").isEnumOf($t).isOptional().check($t.Disallowed),e.entityType.metadataStore!==this.metadataStore)throw new Error("Cannot attach this entity because the EntityType ("+e.entityType.name+") and MetadataStore associated with this entity does not match this EntityManager's MetadataStore.");var r=e.entityAspect;if(r){if(r._inProcessEntity)return r._inProcessEntity}else r=new St(e);var i=r.entityManager;if(i){if(i===this)return e;throw new Error("This entity already belongs to another EntityManager")}var a,o=this;return _(this,"isLoading",!0,function(){t.isAdded()&&I(o,e),a=o._attachEntityCore(e,t,n),r._inProcessEntity=a;try{j(o,e,t,n)}finally{r._inProcessEntity=null}}),this.validationOptions.validateOnAttach&&a.entityAspect.validateEntity(),t.isUnchanged()||this._notifyStateChange(a,!0),this.entityChanged.publish({entityAction:wt.Attach,entity:a}),a},Y.detachEntity=function(e){ct(e,"entity").isEntity().check();var t=e.entityAspect;if(!t)return!1;if(t.entityManager!==this)throw new Error("This entity does not belong to this EntityManager.");return t.setDetached()},Y.fetchMetadata=function(e,t,n){"function"==typeof e?(n=t,t=e,e=null):(ct(e,"dataService").isInstanceOf(_t).isOptional().check(),ct(t,"callback").isFunction().isOptional().check(),ct(n,"errorCallback").isFunction().isOptional().check());var r=this.metadataStore.fetchMetadata(e||this.dataService);return C(r,t,n)},Y.executeQuery=function(e,t,n){ct(e,"query").isInstanceOf(Bt).or().isString().check(),ct(t,"callback").isFunction().isOptional().check(),ct(n,"errorCallback").isFunction().isOptional().check();var r,i=Ht.resolve([e.queryOptions,this.queryOptions,Ht.defaultInstance]),a=_t.resolve([e.dataService,this.dataService]);if(!a.hasServerMetadata||this.metadataStore.hasMetadataFor(a.serviceName))r=V(this,e,i,a);else{var o=this;r=this.fetchMetadata(a).then(function(){return V(o,e,i,a)})}return C(r,t,n)},Y.executeQueryLocally=function(e){ct(e,"query").isInstanceOf(Bt).check();var t=this.metadataStore,n=e._getFromEntityType(t,!0),r=L(this,n),i=e.wherePredicate&&e.wherePredicate.toFunction({entityType:n}),a=Ht.resolve([e.queryOptions,this.queryOptions,Ht.defaultInstance]),o=a.includeDeleted===!0,s=function(e){return e&&(o||!e.entityAspect.entityState.isDeleted())&&(i?i(e):!0)},u=[];r.forEach(function(e){u.push.apply(u,e._entities.filter(s))});var c=e.orderByClause&&e.orderByClause.getComparer(n);c&&u.sort(c);var l=e.skipCount;l&&(u=u.slice(l));var p=e.takeCount;p&&(u=u.slice(0,p));var f=e.selectClause;if(f){var d=f.toFunction();u=u.map(d)}return u},Y.saveChanges=function(e,t,n,i){function o(e){var t=v.entityManager;h(c,!1);e.entities=v.processSavedEntities(e);return t._setHasChanges(null),n&&n(e),Ot.resolve(e)}function s(e){var t=e.entities;if(0===t.length)return[];var n=e.keyMappings,r=v.entityManager;return F(r,n),_(r,"isLoading",!0,function(){var e=new Wt({query:null,entityManager:r,mergeOptions:{mergeStrategy:$t.OverwriteChanges},dataService:y});t=e.visitAndMerge(t,{nodeType:"root"})}),t}function u(e){return h(c,!1),a(v,e),i&&i(e),Ot.reject(e)}ct(e,"entities").isOptional().isArray().isEntity().check(),ct(t,"saveOptions").isInstanceOf(Zt).isOptional().check(),ct(n,"callback").isFunction().isOptional().check(),ct(i,"errorCallback").isFunction().isOptional().check(),t=t||this.saveOptions||Zt.defaultInstance;var c=k(this,e);if(0===c.length){var l={entities:[],keyMappings:[]};return n&&n(l),Ot.resolve(l)}if(!t.allowConcurrentSaves){var p=c.some(function(e){return e.entityAspect.isBeingSaved});if(p){var f=new Error("Concurrent saves not allowed - SaveOptions.allowConcurrentSaves is false");return i&&i(f),Ot.reject(f)}}r(c);var d=this.saveChangesValidateOnClient(c);if(d)return i&&i(d),Ot.reject(d);var y=_t.resolve([t.dataService,this.dataService]),v={entityManager:this,dataService:y,processSavedEntities:s,resourceName:t.resourceName||this.saveOptions.resourceName||"SaveChanges"},m={entities:c,saveOptions:t};try{return B(c),y.adapterInstance.saveChanges(v,m).then(o).then(null,u)}catch(f){return h(c,!1),i&&i(f),Ot.reject(f)}},Y.saveChangesValidateOnClient=function(e){if(this.validationOptions.validateOnSave){var t=e.filter(function(e){var t=e.entityAspect,n=t.entityState.isDeleted()||t.validateEntity();return!n});if(t.length>0){var n=new Error("Client side validation errors encountered - see the entityErrors collection on this object for more detail");return n.entityErrors=i(t),n}}return null},Y._findEntityGroup=function(e){return this._entityGroupMap[e.name]},Y.getEntityByKey=function(){var e=f(this,arguments).entityKey,t=e._subtypes||[e.entityType],n=null;return t.some(function(t){var r=this._findEntityGroup(t);return n=r&&r.findEntityByKey(e)},this),n},Y.fetchEntityByKey=function(){var e=_t.resolve([this.dataService]);if(!e.hasServerMetadata||this.metadataStore.hasMetadataFor(e.serviceName))return o(this,arguments);var t=this,n=arguments;return this.fetchMetadata(e).then(function(){return o(t,n)})},Y.findEntityByKey=function(e){return this.getEntityByKey(e)},Y.generateTempKeyValue=function(e){ct(e,"entity").isEntity().check();var t=e.entityType,n=this.keyGenerator.generateTempKeyValue(t),r=t.keyProperties[0];return e.setProperty(r.name,n),e.entityAspect.hasTempKey=!0,n},Y.hasChanges=function(e){return this._hasChanges?void 0===e?this._hasChanges:this._hasChangesCore(e):!1},Y._hasChangesCore=function(e){e=s(this,e);var t=D(this,e);return t.some(function(e){return e&&e.hasChanges()})},Y.getChanges=function(e){e=s(this,e);var t=[xt.Added,xt.Modified,xt.Deleted];return p(this,e,t)},Y.rejectChanges=function(){if(!this._hasChanges)return[];var e=[xt.Added,xt.Modified,xt.Deleted],t=p(this,null,e),n=t.map(function(e){return e.entityAspect._checkOperation("rejectChanges")});return this._hasChanges=!1,n.forEach(function(e){e.rejectChanges()}),this.hasChangesChanged.publish({entityManager:this,hasChanges:!1}),t},Y.getEntities=function(e,t){return e=s(this,e),ct(t,"entityStates").isOptional().isEnumOf(xt).or().isNonEmptyArray().isEnumOf(xt).check(),t=t&&M(this,t),p(this,e,t)},Y._notifyStateChange=function(e,t){var n={entityAction:wt.EntityStateChange,entity:e};if(t)this._hasChanges||this._setHasChanges(!0);else if(this._hasChanges){if(this.isLoading)return void(this._hasChangesAction=this._hasChangesAction||function(){this._setHasChanges(null),this.entityChanged.publish(n)}.bind(this));this._setHasChanges(null)}this.entityChanged.publish(n)},Y._setHasChanges=function(e){null==e&&(e=this._hasChangesCore());var t=this._hasChanges;this._hasChanges=e,e!=t&&this.hasChangesChanged.publish({entityManager:this,hasChanges:e}),this._hasChangesAction=null},Y._linkRelatedEntities=function(e){var t=this,n=e.entityAspect;_(t,"isLoading",!0,function(){var r=t._unattachedChildrenMap,i=n.getKey(),a=r.getTuples(i);a&&a.slice(0).forEach(function(t){var n,a,o=t.children.filter(function(e){return e.entityAspect.entityState!==xt.Detached}),s=t.navigationProperty;if(s.inverse)if(n=s,a=s.inverse,a.isScalar){var u=o[0];e.setProperty(a.name,u),u.setProperty(n.name,e)}else{var c=e.getProperty(a.name);o.forEach(function(t){c.push(t),t.setProperty(n.name,e)})}else if(s.parentType===e.entityType)if(a=s,a.isScalar)e.setProperty(a.name,o[0]);else{var c=e.getProperty(a.name);o.forEach(function(e){c._push(e)})}else n=s,o.forEach(function(t){t.setProperty(n.name,e)});r.removeChildren(i,n)}),e.entityType.navigationProperties.forEach(function(i){if(i.isScalar){var a=e.getProperty(i.name);if(a)return}var o=n.getParentKey(i);if(o){if(o._isEmpty())return;var s=t.findEntityByKey(o);s?e.setProperty(i.name,s):r.addChild(o,i,e)}}),e.entityType.foreignKeyProperties.forEach(function(n){var i=n.inverseNavigationProperty;if(i){var a=e.getProperty(n.name),o=new Tt(i.parentType,[a]),s=t.findEntityByKey(o);s?i.isScalar?s.setProperty(i.name,e):t.isLoading?s.getProperty(i.name)._push(e):s.getProperty(i.name).push(e):r.addChild(o,i,e)}})})},Y._attachEntityCore=function(e,t,n){var r=z(this,e.entityType),i=r.attachEntity(e,t,n);return this._linkRelatedEntities(i),i},Y._updateFkVal=function(e,t,n){var r=this._entityGroupMap[e.parentType.name];r&&r._updateFkVal(e,t,n)},Y.helper={unwrapInstance:$,unwrapOriginalValues:G,unwrapChangedValues:H},Z.prototype.addChild=function(e,t,n){var r=this.getTuple(e,t);r||(r={navigationProperty:t,children:[]},T(this.map,e.toString()).push(r)),r.children.push(n)},Z.prototype.removeChildren=function(e,t){var n=this.getTuples(e);n&&(w(n,function(e){return e.navigationProperty===t}),n.length||delete this.map[e.toString()])},Z.prototype.getChildren=function(e,t){var n=this.getTuple(e,t);return n?n.children.filter(function(e){return!e.entityAspect.entityState.isDetached()}):null},Z.prototype.getTuple=function(e,t){var n=this.getTuples(e);if(!n)return null;var r=m(n,function(e){return e.navigationProperty===t});return r},Z.prototype.getTuples=function(e){for(var t=this.map[e.toString()],n=e.entityType;!t&&n.baseEntityType;){n=n.baseEntityType;var r=e.toString(n);t=this.map[r]}return t},X}();rt.EntityManager=Qt;var Wt=function(){function e(e,t,i,o){if(i.ignore||null==t)return null;if(i.nodeRefId){var u=a(e,i.nodeRefId);return"function"==typeof u&&null!=o?void e.deferredFns.push(function(){o(u)}):u}if(i.entityType){var c=i.entityType;return e.mergeOptions.noTracking?(t=n(e,c,t),c.noTrackingFn&&(t=c.noTrackingFn(t,c)),i.nodeId&&(e.refMap[i.nodeId]=t),t):c.isComplexType?n(e,c,t):s(e,t,i)}return"object"!=typeof t||I(t)||(t=r(e,t)),i.nodeId&&(e.refMap[i.nodeId]=t),t}function n(e,t,r){var a={};return t.dataProperties.forEach(function(t){a[t.name]=t.isComplexProperty?v(r[t.nameOnServer],function(r){return n(e,t.dataType,r)}):w(r[t.nameOnServer],t.dataType)}),t.navigationProperties&&t.navigationProperties.forEach(function(t){var n={nodeType:"navProp",navigationProperty:t};i(r[t.nameOnServer],e,n,a,t.name)}),a}function r(e,n){var r=e.metadataStore.namingConvention.serverPropertyNameToClient,a={};return t(n,function(t,n){var o=r(t),s={nodeType:"anonProp",propertyName:o};i(n,e,s,a,o)}),a}function i(t,n,r,i,a){var o=n.jsonResultsAdapter,s=o.visitNode(t,n,r)||{};t=s.node||t,s.ignore||(Array.isArray(t)?(r.nodeType=r.nodeType+"Item",i[a]=t.map(function(t,u){return s=o.visitNode(t,n,r)||{},t=s.node||t,e(n,t,s,function(e){i[a][u]=e()})})):i[a]=e(n,t,s,function(e){i[a]=e()}))}function a(e,t){var n=e.refMap[t];return void 0===n?function(){return e.refMap[t]}:n}function o(e,t,n){var r=n._$meta.nodeId;null!=r&&(e.refMap[r]=t)}function s(e,t,n){t._$meta=n;var r=e.entityManager,i=n.entityType;"string"==typeof i&&(i=e.metadataStore._getEntityType(i,!1)),t.entityType=i;var a=e.mergeOptions.mergeStrategy,o=null==e.query,s=i.getEntityKeyFromRawEntity(t,e.rawValueFn),c=r.findEntityByKey(s);if(c){if(o&&c.entityAspect.entityState.isDeleted())return r.detachEntity(c),c;var p=c.entityAspect.entityState;if(a===$t.Disallowed)throw new Error("A MergeStrategy of 'Disallowed' prevents "+s.toString()+" from being merged");if(a===$t.SkipMerge)u(e,c,t);else if(a===$t.OverwriteChanges||p.isUnchanged()){l(e,c,t),c.entityAspect.wasLoaded=!0,n.extraMetadata&&(c.entityAspect.extraMetadata=n.extraMetadata),c.entityAspect.entityState=xt.Unchanged,c.entityAspect.originalValues={},c.entityAspect.propertyChanged.publish({entity:c,propertyName:null});var f=o?wt.MergeOnSave:wt.MergeOnQuery;r.entityChanged.publish({entityAction:f,entity:c}),p.isUnchanged()||r._notifyStateChange(c,!1)}else{if(p==xt.Deleted&&!e.mergeOptions.includeDeleted)return null;u(e,c,t)}}else c=i._createInstanceCore(),l(e,c,t),n.extraMetadata&&(c.entityAspect.extraMetadata=n.extraMetadata),r._attachEntityCore(c,xt.Unchanged,a),c.entityAspect.wasLoaded=!0,r.entityChanged.publish({entityAction:wt.AttachOnQuery,entity:c});return c}function u(e,t,n){o(e,t,n),n.entityType.navigationProperties.forEach(function(t){t.isScalar?d(e,n,t):h(e,n,t)})}function l(e,t,n){o(e,t,n);var r=t.entityType;r._updateTargetFromRaw(t,n,e.rawValueFn),r.navigationProperties.forEach(function(r){r.isScalar?p(e,r,t,n):f(e,r,t,n)})}function p(e,t,n,r){var i=d(e,r,t);null!=i&&("function"==typeof i?e.deferredFns.push(function(){i=i(),y(i,n,t)}):y(i,n,t))}function f(e,t,n,r){var i=h(e,r,t);if(null!=i){var a=t.inverse;if(a){var o=n.getProperty(t.name);o.wasLoaded=!0,i.forEach(function(t){"function"==typeof t?e.deferredFns.push(function(){t=t(),m(t,o,n,a)}):m(t,o,n,a)})}}}function d(e,t,n){var r=t[n.nameOnServer];if(!r)return null;var i=e.visitAndMerge(r,{nodeType:"navProp",navigationProperty:n});return i}function h(e,t,n){var r=t[n.nameOnServer];if(!r)return null;if(!Array.isArray(r)&&(r=r.results,!r))return null;var i=e.visitAndMerge(r,{nodeType:"navPropItem",navigationProperty:n});return i}function y(e,t,n){if(e){var r=n.name,i=t.getProperty(r);if(i!==e){t.setProperty(r,e);var a=n.inverse;if(!a)return;if(a.isScalar)e.setProperty(a.name,t);else{var o=e.getProperty(a.name);o.push(t)}}}}function m(e,t,n,r){if(e){var i=e.getProperty(r.name);i!==n&&(t.push(e),e.setProperty(r.name,n))}}var g=function(e){c(this,e,["query","entityManager","dataService","mergeOptions"]),this.refMap={},this.deferredFns=[],this.jsonResultsAdapter=this.dataService.jsonResultsAdapter,this.metadataStore=this.entityManager.metadataStore,this.rawValueFn=Dt.getRawValueFromServer},b=g.prototype,w=Pt.parseRawValue;return b._$typeName="MappingContext",b.getUrl=function(){var e=this.query;if(!e)throw new Error("query cannot be empty");var t;if("string"==typeof e)t=e;else{if(!(e instanceof Bt))throw new Error("unable to recognize query parameter as either a string or an EntityQuery");t=this.dataService.uriBuilder.buildUri(e,this.metadataStore)}return this.dataService.qualifyUrl(t)},b.visitAndMerge=function(t,n){var r=this.query,i=this.jsonResultsAdapter;n=n||{};var a=this;return v(t,function(t){if(null==r&&t.entityAspect)return t.entityAspect.entityState.isDeleted()?a.entityManager.detachEntity(t):t.entityAspect.acceptChanges(),t;var o=i.visitNode(t,a,n)||{};return t=o.node||t,r&&"root"===n.nodeType&&!o.entityType&&(o.entityType=r._getToEntityType&&r._getToEntityType(a.metadataStore)),e(a,t,o)},this.mergeOptions.includeDeleted)},b.processDeferred=function(){this.deferredFns.length>0&&this.deferredFns.forEach(function(e){e()})},g}(),Zt=function(){function e(e,t){return t&&pt(t).whereParam("resourceName").isOptional().isString().whereParam("dataService").isOptional().isInstanceOf(_t).whereParam("allowConcurrentSaves").isBoolean().isOptional().whereParam("tag").isOptional().applyAll(e),e}var t=function(t){e(this,t)},n=t.prototype;return n._$typeName="SaveOptions",n.setAsDefault=function(){return p(this,t)},n.using=function(t){return e(this,t)},t.defaultInstance=new t({allowConcurrentSaves:!1}),t}();rt.SaveOptions=Zt,rt.AbstractDataServiceAdapter=function(){function e(){this.getRequest=function(e){return e
},this.done=function(){}}function t(e,t,r){var i=n(t);return a._catchNoConnectionError(i),r&&(i.message=r+"; "+i.message),e.reject(i)}function n(e){var t=new Error;t.httpResponse=e,t.status=e.status;var n=e.data;if(!n)return t.message=e.error&&e.error.toString(),t;if("string"==typeof n)try{n=JSON.parse(n)}catch(r){return t.message=n,t}var i,a,o=e.saveContext,s=n.Message||n.ExceptionMessage||n.EntityErrors||n.Errors,u=!!s;if(u){var s=n;do i=s.ExceptionMessage||s.Message,s=s.InnerException;while(s);a=n.Errors||n.EntityErrors,a=a&&a.map(function(e){return{errorName:e.ErrorName,entityTypeName:At.normalizeTypeName(e.EntityTypeName),keyValues:e.KeyValues,propertyName:e.PropertyName,errorMessage:e.ErrorMessage}})}else i=n.message,a=n.errors||n.entityErrors;if(o&&a){var c=o.entityManager.metadataStore.namingConvention.serverPropertyNameToClient;a.forEach(function(e){e.propertyName=e.propertyName&&c(e.propertyName)}),t.entityErrors=a}return t.message=i||"Server side errors encountered - see the entityErrors collection on this object for more detail",t}var r,i=function(){},a=i.prototype;return a.checkForRecomposition=function(e){"ajax"===e.interfaceName&&e.isDefault&&this.initialize()},a.initialize=function(){if(r=rt.config.getAdapterInstance("ajax"),!r||!r.ajax)throw new Error("Unable to find ajax adapter for dataservice adapter '"+(this.name||"")+"'.")},a.fetchMetadata=function(e,n){var i=n.serviceName,a=n.qualifyUrl("Metadata"),o=Ot.defer();return r.ajax({type:"GET",url:a,dataType:"json",success:function(r){if(e.hasMetadataFor(i))return o.resolve("already fetched");var s=r.data;try{var u="string"==typeof s?JSON.parse(s):s;e.importMetadata(u)}catch(c){var l="Unable to either parse or import metadata: "+c.message;return t(o,r,"Metadata query failed for: "+a+". "+l)}return e.hasMetadataFor(i)||e.addDataService(n),o.resolve(u)},error:function(e){t(o,e,"Metadata query failed for: "+a)}}),o.promise},a.executeQuery=function(e){var n=Ot.defer(),i=e.getUrl(),a={type:"GET",url:i,params:e.query.parameters,dataType:"json",success:function(e){var r=e.data;try{var i,a=r&&(r.results||r.Results);i=a?{results:a,inlineCount:r.inlineCount||r.InlineCount,httpResponse:e}:{results:r,httpResponse:e},n.resolve(i)}catch(o){o instanceof Error?n.reject(o):t(n,e)}},error:function(e){t(n,e)}};return e.dataService.useJsonp&&(a.dataType="jsonp",a.crossDomain=!0),r.ajax(a),n.promise},a.saveChanges=function(e,n){var i=e.adapter=this,a=Ot.defer();n=i._prepareSaveBundle(e,n);var o=JSON.stringify(n),s=e.dataService.qualifyUrl(e.resourceName);return r.ajax({type:"POST",url:s,dataType:"json",contentType:"application/json",data:o,success:function(n){n.saveContext=e;var r=n.data;if(r.Errors||r.errors)t(a,n);else{var o=i._prepareSaveResult(e,r);o.httpResponse=n,a.resolve(o)}},error:function(n){n.saveContext=e,t(a,n)}}),a.promise},a._prepareSaveBundle=function(){throw new Error("Need a concrete implementation of _prepareSaveBundle")},a.changeRequestInterceptor=e,a._createChangeRequestInterceptor=function(t,n){var r=t.adapter,i=j,a=r.changeRequestInterceptor,o=r.name+" DataServiceAdapter's ChangeRequestInterceptor",s=" is missing or not a function.";if(i(a)){var u=new a(t,n);if(!i(u.getRequest))throw new Error(o+".getRequest"+s);if(!i(u.done))throw new Error(o+".done"+s);return u}return new e(t,n)},a._prepareSaveResult=function(){throw new Error("Need a concrete implementation of _prepareSaveResult")},a.jsonResultsAdapter=new Nt({name:"noop",visitNode:function(){return{}}}),a._catchNoConnectionError=function(e){0==e.status&&null==e.message&&(e.message="HTTP response status 0 and no message.  Likely did not or could not reach server. Is the server running?")},i}(),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],e)}(function(e){function t(e){var n,r,i,a="";for(var o in e){var s=e[o];if(s instanceof Array)for(var u=0;u<s.length;++u)n=s[u],i=o+"["+u+"]",r={},r[i]=n,a+=t(r)+"&";else if(s&&s.toISOString)a+=encodeURIComponent(o)+"="+encodeURIComponent(s.toISOString())+"&";else if(s instanceof Object)for(var c in s)n=s[c],i=o+"["+c+"]",r={},r[i]=n,a+=t(r)+"&";else null===s?a+=encodeURIComponent(o)+"=&":void 0!==s&&(a+=encodeURIComponent(o)+"="+encodeURIComponent(s)+"&")}return a.length?a.substr(0,a.length-1):a}var n=e.core,r=function(){this.name="angular",this.defaultSettings={},this.requestInterceptor=null,this.$http,this.$rootScope},i=r.prototype;i.initialize=function(){var e=n.requireLib("angular");if(e){var t,r,i=e.injector(["ng"]);i.invoke(["$http","$rootScope",function(e,n){t=e,r=n}]),this.$http=t,this.$rootScope=r}},i.setHttp=function(e){this.$http=e,this.$rootScope=null},i.ajax=function(e){function r(t,n,r,i,a){"null"===t&&(t=null);var o={config:e,data:t,getHeaders:r,status:n,statusText:a};e.success(o)}function i(t,n,r,i,a){0===n&&null==t&&(t="timeout");var o={config:e,data:t,getHeaders:r,status:n,statusText:a};e.error(o)}if(!this.$http)throw new Error("Unable to locate angular for ajax adapter");var a={method:e.type,url:e.url,dataType:e.dataType,contentType:e.contentType,crossDomain:e.crossDomain,headers:e.headers||{}};if(e.params){var o=a.url.indexOf("?")>=0?"&":"?";a.url=a.url+o+t(e.params)}if(e.data&&(a.data=e.data),!n.isEmpty(this.defaultSettings)){var s=n.extend({},this.defaultSettings);a=n.extend(s,a);var u=n.extend({},this.defaultSettings.headers);a.headers=n.extend(u,a.headers)}var c={adapter:this,config:a,zConfig:e,success:r,error:i};n.isFunction(this.requestInterceptor)&&(this.requestInterceptor(c),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),c.config&&(this.$http(c.config).success(c.success).error(c.error),this.$rootScope&&this.$rootScope.$digest())},e.config.registerAdapter("ajax",r)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&define(["breeze"],e)}(function(e){function t(e){return 0===e.status?function(e){return e&&e.length>0?"":{}}:function(t){return t&&t.length>0?e.getResponseHeader(t):e.getAllResponseHeaders()}}var n,r=e.core,i=function(){this.name="jQuery",this.defaultSettings={},this.requestInterceptor=null},a=i.prototype;a.initialize=function(){n=r.requireLib("jQuery")},a.ajax=function(e){function i(n,r,i){var a={config:e,data:n,getHeaders:t(i),status:i.status,statusText:r};e.success(a),i.onreadystatechange=null,i.abort=null}function a(n,r,i){var a={config:e,data:n.responseText,error:i,getHeaders:t(n),status:n.status,statusText:r};e.error(a),n.onreadystatechange=null,n.abort=null}if(!n)throw new Error("Unable to locate jQuery");var o={type:e.type,url:e.url,data:e.params||e.data,dataType:e.dataType,contentType:e.contentType,crossDomain:e.crossDomain,headers:e.headers||{}};if(!r.isEmpty(this.defaultSettings)){var s=r.extend({},this.defaultSettings);o=r.extend(s,o);var u=r.extend({},this.defaultSettings.headers);o.headers=r.extend(u,o.headers)}var c={adapter:this,config:o,zConfig:e,success:i,error:a};r.isFunction(this.requestInterceptor)&&(this.requestInterceptor(c),this.requestInterceptor.oneTime&&(this.requestInterceptor=null)),c.config&&(c.jqXHR=n.ajax(c.config).done(c.success).fail(c.error))},e.config.registerAdapter("ajax",i)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!rt&&define(["breeze"],e)}(function(e){function t(e,t){return e.isUnmapped?void 0:(e.dataType===Pt.DateTimeOffset?t=t&&new Date(t.getTime()-6e4*t.getTimezoneOffset()):e.dataType.quoteJsonOData&&(t=null!=t?t.toString():t),t)}function n(e,n){var i=e.adapter._createChangeRequestInterceptor(e,n),a=[],o=[],s=[],u=e.entityManager,c=u.helper,l=0,p=e.routePrefix;return n.entities.forEach(function(e,n){var f=e.entityAspect;l+=1;var d={headers:{"Content-ID":l,DataServiceVersion:"2.0"}};if(s[l]=e,f.entityState.isAdded())d.requestUri=p+e.entityType.defaultResourceName,d.method="POST",d.data=c.unwrapInstance(e,t),o[l]=f.getKey();else if(f.entityState.isModified())r(d,f,p),d.method="MERGE",d.data=c.unwrapChangedValues(e,u.metadataStore,t);else{if(!f.entityState.isDeleted())return;r(d,f,p),d.method="DELETE"}d=i.getRequest(d,e,n),a.push(d)}),e.contentKeys=s,e.tempKeys=o,i.done(a),{__batchRequests:[{__changeRequests:a}]}}function r(e,t,n){var r,a=t.extraMetadata;null==a?(r=i(t),t.extraMetadata={uriKey:r}):(r=a.uriKey,a.etag&&(e.headers["If-Match"]=a.etag)),e.requestUri=r.indexOf("//")>0?r:n+r}function i(e){var t=e.entity.entityType,n=t.defaultResourceName,r=t.keyProperties,i=n+"(";if(1===r.length)i=i+a(r[0],e)+")";else{var o="";r.forEach(function(t){i=i+o+t.nameOnServer+"="+a(t,e),o=","}),i+=")"}return i}function a(e,t){return e.dataType.fmtOData(t.getPropertyValue(e.name))}function o(e,t){var n=new Error,r=e&&e.response;if(!r)return n.message=e,n.statusText=e,n;if(n.message=r.statusText,n.statusText=r.statusText,n.status=r.statusCode,t&&(n.url=t),n.body=r.body,r.body){var i;try{var a=JSON.parse(r.body);n.body=a,a["odata.error"]&&(a=a["odata.error"]);var o="";do i=a.error||a.innererror,i||(o+=s(a)),i=i||a.internalexception,a=i||a;while(i);o.length>0&&(n.message=o)}catch(u){}}return h._catchNoConnectionError(n),n}function s(e){var t=e.message||"";return("string"==typeof t?t:t.value)+"; "}var u,c=e.core,l=e.MetadataStore,p=e.JsonResultsAdapter,f=e.DataProperty,d=function(){this.name="OData"},h=d.prototype;h.initialize=function(){u=c.requireLib("OData","Needed to support remote OData services"),u.jsonHandler.recognizeDates=!0};var y=e.AbstractDataServiceAdapter.prototype;h._catchNoConnectionError=y._catchNoConnectionError,h.changeRequestInterceptor=y.changeRequestInterceptor,h._createChangeRequestInterceptor=y._createChangeRequestInterceptor,h.headers={DataServiceVersion:"2.0"},h.executeQuery=function(e){var t=Ot.defer(),n=e.getUrl();return u.read({requestUri:n,headers:this.headers},function(e,n){var r;return e.__count&&(r=parseInt(e.__count,10)),t.resolve({results:e.results,inlineCount:r,httpResponse:n})},function(e){return t.reject(o(e,n))}),t.promise},h.fetchMetadata=function(e,t){var n=Ot.defer(),r=t.serviceName,i=t.qualifyUrl("$metadata");return u.read({requestUri:i,headers:{Accept:"application/json;odata.metadata=full"}},function(a){if(!a||!a.dataServices){var o=new Error("Metadata query failed for: "+i);return n.reject(o)}var s=a.dataServices;if(!e.hasMetadataFor(r)){try{e.importMetadata(s)}catch(u){return n.reject(new Error("Metadata query failed for "+i+"; Unable to process returned metadata: "+u.message))}e.addDataService(t)}return n.resolve(s)},function(e){var t=o(e,i);return t.message="Metadata query failed for: "+i+"; "+(t.message||""),n.reject(t)},u.metadataHandler),n.promise},h.getRoutePrefix=function(){return""},h.saveChanges=function(e,t){var r=e.adapter=this,i=Ot.defer();e.routePrefix=r.getRoutePrefix(e.dataService);var a=e.dataService.qualifyUrl("$batch"),s=n(e,t),c=e.tempKeys,l=e.contentKeys;return u.request({headers:{DataServiceVersion:"2.0"},requestUri:a,method:"POST",data:s},function(e){var t=[],n=[],r={entities:t,keyMappings:n};return e.__batchResponses.forEach(function(e){e.__changeResponses.forEach(function(e){var r=e.response||e,s=r.statusCode;if(!s||s>=400)return void i.reject(o(e,a));var u=e.headers["Content-ID"],p=e.data;if(p){var d=c[u];if(d){var h=d.entityType;if(h.autoGeneratedKeyType!==Mt.None){var y=d.values[0],v=h.getEntityKeyFromRawEntity(p,f.getRawValueFromServer),m={entityTypeName:h.name,tempValue:y,realValue:v.values[0]};n.push(m)}}t.push(p)}else{var g=l[u];t.push(g)}})}),i.resolve(r)},function(e){return i.reject(o(e,a))},u.batchHandler),i.promise},h.jsonResultsAdapter=new p({name:"OData_default",visitNode:function(e,t,n){var r={};if(null==e)return r;var i=e.__metadata;if(null!=i){var a=l.normalizeTypeName(i.type),o=a&&t.entityManager.metadataStore.getEntityType(a,!0);if(o&&o._mappedPropertiesCount<=Object.keys(e).length-1){r.entityType=o;var s=i.uri||i.id;if(s){var u=new RegExp("^"+t.dataService.serviceName,"i");s=s.replace(u,"")}r.extraMetadata={uriKey:s,etag:i.etag}}}e.results&&(r.node=e.results);var p=n.propertyName;return r.ignore=null!=e.__deferred||"__metadata"===p||"EntityKey"===p&&e.$type&&c.stringStartsWith(e.$type,"System.Data"),r}}),e.config.registerAdapter("dataService",d);var v=function(){this.name="webApiOData"};e.core.extend(v.prototype,h),v.prototype.getRoutePrefix=function(e){if("object"==typeof document){var t=document.createElement("a");t.href=e.serviceName}else t=url.parse(e.serviceName);var n=t.pathname;return"/"===n[0]&&(n=n.substr(1)),"/"!==n.substr(-1)&&(n+="/"),n},e.config.registerAdapter("dataService",v);var m=function(){this.name="webApiOData4"};e.core.extend(m.prototype,v.prototype),m.prototype.initialize=function(){var e=c.requireLib("datajs","Needed to support remote OData v4 services");u=e.V4.oData,u.json.jsonHandler.recognizeDates=!0},m.prototype.headers={"OData-Version":"4.0"},e.config.registerAdapter("dataService",m)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!rt&&define(["breeze"],e)}(function(e){var t=e.MetadataStore,n=e.JsonResultsAdapter,r=e.AbstractDataServiceAdapter,i=function(){this.name="webApi"},a=i.prototype=new r;a._prepareSaveBundle=function(e,t){var n=this._createChangeRequestInterceptor(e,t),r=e.entityManager,i=r.metadataStore,a=r.helper;return t.entities=t.entities.map(function(e,t){var r=a.unwrapInstance(e),o=null;e.entityType.autoGeneratedKeyType!==Mt.None&&(o={propertyName:e.entityType.keyProperties[0].nameOnServer,autoGeneratedKeyType:e.entityType.autoGeneratedKeyType.name});var s=a.unwrapOriginalValues(e,i);return r.entityAspect={entityTypeName:e.entityType.name,defaultResourceName:e.entityType.defaultResourceName,entityState:e.entityAspect.entityState.name,originalValuesMap:s,autoGeneratedKey:o},r=n.getRequest(r,e,t)}),t.saveOptions={tag:t.saveOptions.tag},n.done(t.entities),t},a._prepareSaveResult=function(e,n){if(n.entities)return n;var r=n.KeyMappings.map(function(e){var n=t.normalizeTypeName(e.EntityTypeName);return{entityTypeName:n,tempValue:e.TempValue,realValue:e.RealValue}});return{entities:n.Entities,keyMappings:r}},a.jsonResultsAdapter=new n({name:"webApi_default",visitNode:function(e,n,r){if(null==e)return{};var i=t.normalizeTypeName(e.$type),a=i&&n.entityManager.metadataStore._getEntityType(i,!0),o=r.propertyName,s=o&&"$"===o.substr(0,1);return{entityType:a,nodeId:e.$id,nodeRefId:e.$ref,ignore:s}}}),e.config.registerAdapter("dataService",i)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!rt&&define(["breeze"],e)}(function(e){function t(e){var t=e.entityType||e.complexType,n=t._extra,i=n.alreadyWrappedProps||{};t.getProperties().forEach(function(t){var n=t.name;if(!i[n]){var o;o=n in e?a(e,t):r(e,t),null!=o&&Object.defineProperty(e,n,o),i[n]=!0}}),n.alreadyWrappedProps=i}function n(e){var t=o(e),n=Object.getPrototypeOf(e),i=n.entityType||n.complexType;return i.getProperties().forEach(function(t){var i=t.name;if(t.isUnmapped&&!c.getPropertyDescriptor(n,i)){var a=r(n,t);Object.defineProperty(n,i,a)}if(e.hasOwnProperty(i)){var o=e[i];delete e[i],e[i]=o}}),t}function r(e,t){var n=t.name,r=e._pendingBackingStores;r||(r=[],e._pendingBackingStores=r);var a={get:function(){var e=this._backingStore||o(this);return e[n]},set:function(e){var r=this._backingStore||s(this),a=i(r,n);this._$interceptor(t,e,a)},enumerable:!0,configurable:!0};return a.set.rawSet=function(e){var t=this._backingStore||s(this),r=i(t,n);r(e)},a}function i(e,t){return function(){return 0==arguments.length?e[t]:void(e[t]=arguments[0])}}function a(e,t){if(!e.hasOwnProperty(t.name)){var n=Object.getPrototypeOf(e);return a(n,t)}var r=Object.getOwnPropertyDescriptor(e,t.name);if(r.configurable&&!r.value&&r.set){var i=function(e){return function(){if(0==arguments.length)return r.get.bind(e)();var t=r.set,n=t.rawSet||t;n.bind(e)(arguments[0])}},o={get:function(){return r.get.bind(this)()},set:function(e){this._$interceptor(t,e,i(this))},enumerable:r.enumerable,configurable:!0};return o.set.rawSet=r.set,o}}function o(e){var t=Object.getPrototypeOf(e);u(t);var n=e._backingStore;return n||(n={},e._backingStore=n),n}function s(e){var t=Object.getPrototypeOf(e),n=t._pendingBackingStores,r=c.arrayFirst(n,function(t){return t.entity===e});if(r)return r.backingStore;var i={};return n.push({entity:e,backingStore:i}),i}function u(e){var t=e._pendingBackingStores;t&&(t.forEach(function(e){e.entity._backingStore=e.backingStore}),t.length=0)}var c=e.core,l=function(){this.name="backingStore"},p=l.prototype;p.initialize=function(){},p.getTrackablePropertyNames=function(e){var t=[];for(var n in e)if("entityType"!==n&&"_$typeName"!==n&&"_pendingSets"!==n&&"_backingStore"!==n){var r=e[n];c.isFunction(r)||t.push(n)}return t},p.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]},e.setProperty=function(e,t){return this[e]=t,this},t(e)},p.startTracking=function(t){var r=n(t),i=t.entityType||t.complexType;i.getProperties().forEach(function(n){var i=n.name,a=t[i];if(n.isDataProperty)n.isComplexProperty?a=n.isScalar?n.dataType._createInstanceCore(t,n):e.makeComplexArray([],t,n):n.isScalar?void 0===a&&(a=n.defaultValue):a=e.makePrimitiveArray([],t,n);else{if(!n.isNavigationProperty)throw new Error("unknown property: "+i);if(void 0!==a)throw new Error("Cannot assign a navigation property in an entity ctor.: "+n.Name);a=n.isScalar?null:e.makeRelationArray([],t,n)}(n.isSettable||n.isNavigationProperty)&&(r[i]=a)})},e.config.registerAdapter("modelLibrary",l)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!rt&&define(["breeze"],e)}(function(e){function t(e){var t=e.entityType||e.complexType,r={};if(t.getProperties().forEach(function(t){var i=n(e,t.name);i&&(r[t.name]=i)}),!K(r)){var i=t._extra;i.es5Descriptors=r,t._koDummy=o.observable(null)}}function n(e,t){if(!u)return null;if(e.hasOwnProperty(t))return Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(e,t);var r=Object.getPrototypeOf(e);return r?n(r,t):null}function r(t,n,r){if(n.isDataProperty)n.isComplexProperty?r=n.isScalar?n.dataType._createInstanceCore(t,n):e.makeComplexArray([],t,n):n.isScalar?void 0===r&&(r=n.defaultValue):r=e.makePrimitiveArray([],t,n);else{if(!n.isNavigationProperty)throw new Error("unknown property: "+n.name);if(void 0!==r)throw new Error("Cannot assign a navigation property in an entity ctor.: "+n.name);r=n.isScalar?null:e.makeRelationArray([],t,n)}return r}function i(e){e._koObj._suppressBreeze=!0}function a(e){var t=e.array._koObj;t._suppressBreeze?t._suppressBreeze=!1:t.valueHasMutated()}var o,s=e.core,u=s.__isES5Supported,c=function(){this.name="ko"},l=c.prototype;l.initialize=function(){o=s.requireLib("ko","The Knockout library"),o.extenders.intercept=function(e,t){var n,r=t.instance,i=t.property;return n=o.computed(e.splice?{read:e}:{read:e,write:function(t){return r._$interceptor(i,t,e),r}})}},l.getTrackablePropertyNames=function(e){var t=[];for(var r in e)if("entityType"!==r&&"_$typeName"!==r){var i=n(e,r);if(i&&i.get)t.push(r);else{var a=e[r];o.isObservable(a)?t.push(r):s.isFunction(a)||t.push(r)}}return t},l.initializeEntityPrototype=function(e){e.getProperty=function(e){return this[e]()},e.setProperty=function(e,t){return this[e](t),this},u&&t(e)},l.startTracking=function(e){var t=e.entityType||e.complexType,n=t._extra.es5Descriptors||{};t.getProperties().sort(function(e,t){var n=e.isUnmapped?1:0,r=t.isUnmapped?1:0;return n-r}).forEach(function(s){var u,c=s.name,l=e[c],p=n[c];if(p){var f=p.get.bind(e);if(p.set){var d=p.set.bind(e),h=function(e){return 0===arguments.length?f():void d(e)};u=o.computed({read:function(){return t._koDummy(),f()},write:function(n){return e._$interceptor(s,n,h),t._koDummy.valueHasMutated(),e}})}else u=o.computed({read:f,write:function(){}})}else if(o.isObservable(l)){if(s.isNavigationProperty)throw new Error("Cannot assign a navigation property in an entity ctor.: "+c);u=l}else l=r(e,s,l),u=s.isScalar?o.observable(l):o.observableArray(l);if(s.isScalar)if(p)Object.defineProperty(e,c,{enumerable:!0,configurable:!0,writable:!0,value:u});else{var y=u.extend({intercept:{instance:e,property:s}});e[c]=y}else l._koObj=u,u.subscribe(i,null,"beforeChange"),l.arrayChanged.subscribe(a),u.equalityComparer=function(){throw new Error("Collection navigation properties may NOT be set.")},e[c]=u})},e.config.registerAdapter("modelLibrary",c)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!rt&&define(["breeze"],e)}(function(e){var t=function(){this.name="json"},n=t.prototype;n.initialize=function(){},n.buildUri=function(e,t){var n=e._getFromEntityType(t,!1);n||(n=new kt(t));var r=e.toJSONExt({entityType:n,toNameOnServer:!0});r.from=void 0,r.queryOptions=void 0;var i=JSON.stringify(r),a=encodeURIComponent(i);return e.resourceName+"?"+a},e.config.registerAdapter("uriBuilder",t)}),function(e){"object"==typeof rt?e(rt):"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?e(require("breeze")):"function"==typeof define&&define.amd&&!rt&&define(["breeze"],e)}(function(e){var t=e.EntityType,n=function(){this.name="odata"},r=n.prototype;r.initialize=function(){},r.buildUri=function(e,n){function r(e){return e?e.visit({entityType:c},i):void 0}function a(e){if(e){e.validate(c);var t=e.items.map(function(e){return c.clientPropertyPathToServer(e.propertyPath,"/")+(e.isDesc?" desc":"")});return t.join(",")}}function o(e){if(e){e.validate(c);var t=e.propertyPaths.map(function(e){return c.clientPropertyPathToServer(e,"/")}).join(",");return t}}function s(e){if(e){var t=e.propertyPaths.map(function(e){return c.clientPropertyPathToServer(e,"/")}).join(",");return t}}function u(e){var t=[];for(var n in e){var r=e[n];void 0!==r&&(r instanceof Array?r.forEach(function(e){t.push(n+"="+encodeURIComponent(e))}):t.push(n+"="+encodeURIComponent(r)))}return t.length>0?"?"+t.join("&"):""}var c=e._getFromEntityType(n,!1);c||(c=new t(n));var l={};l.$filter=r(e.wherePredicate),l.$orderby=a(e.orderByClause),e.skipCount&&(l.$skip=e.skipCount),null!=e.takeCount&&(l.$top=e.takeCount),l.$expand=s(e.expandClause),l.$select=o(e.selectClause),e.inlineCountEnabled&&(l.$inlinecount="allpages");var p=u(l);return e.resourceName+p},e.Predicate.prototype.toODataFragment=function(e){return this.visit(e,i)};var i=function(){function t(e){var t=e.op.key,n=r[t];return n||t}var n={passthruPredicate:function(){return this.value},unaryPredicate:function(e){var n=this.pred.visit(e);return t(this)+" ("+n+")"},binaryPredicate:function(e){var n=this.expr1.visit(e),r=this.expr2.visit(e),i=e.prefix;i&&(n=i+"/"+n);var a=t(this);if("in"==this.op.key){var o=r.map(function(e){return"("+n+" eq "+e+")"}).join(" or ");return o}return this.op.isFunction?"substringof"==a?a+"("+r+","+n+") eq true":a+"("+n+","+r+") eq true":n+" "+a+" "+r},andOrPredicate:function(e){var n=this.preds.map(function(t){var n=t.visit(e);return"("+n+")"}).join(" "+t(this)+" ");return n},anyAllPredicate:function(n){var r=this.expr.visit(n),i=n.prefix;i?(r=i+"/"+r,i="x"+(parseInt(i.substring(1))+1)):i="x1";var a=e.core.extend({},n);a.entityType=this.expr.dataType,a.prefix=i;var o=this.pred.visit(a);return r+"/"+t(this)+"("+i+": "+o+")"},litExpr:function(){return Array.isArray(this.value)?this.value.map(function(e){return this.dataType.fmtOData(e)},this):this.dataType.fmtOData(this.value)},propExpr:function(e){var t=e.entityType;return t?t.clientPropertyPathToServer(this.propertyPath,"/"):this.propertyPath},fnExpr:function(e){var t=this.exprs.map(function(t){return t.visit(e)});return this.fnName+"("+t.join(",")+")"}},r={contains:"substringof"};return n}();e.config.registerAdapter("uriBuilder",n)}),rt.config.initializeAdapterInstances({dataService:"webApi",ajax:"jQuery",uriBuilder:"odata"});var Xt=P("ko");return Xt?rt.config.initializeAdapterInstance("modelLibrary","ko"):rt.config.initializeAdapterInstance("modelLibrary","backingStore"),rt}),define("services/logger",["durandal/system"],function(e){function t(e,t,n,r){a(e,t,n,r,"info")}function n(e,t,n,r){a(e,t,n,r,"success")}function r(e,t,n,r){a(e,t,n,r,"warning")}function i(e,t,n,r){a(e,t,n,r,"error")}function a(t,n,r,i,a){if(r=r?"["+r+"] ":"",n?e.log(r,t,n):e.log(r,t),i)switch(a){case"info":toastr.info(t);break;case"success":toastr.success(t);break;case"warning":toastr.warning(t);break;case"error":toastr.error(t);break;default:toastr.info(t)}}var o={logInfo:t,logSuccess:n,logWarning:r,logError:i};return o}),define("services/context",["Q","breeze","config","services/globals","services/logger"],function(e,t,n,r,i){function a(){return d?e.resolve():(d=!0,f.fetchMetadata())}function o(e){var n=t.EntityQuery.from("Participants").where("Guid","==",e);return f.executeQuery(n)}function s(){return f.createEntity("ClassicActivity",{ParticipantId:r.participant().Id()})}function u(){var e=t.EntityQuery.from("ClassicActivities").where("ParticipantId","==",r.participant().Id());return f.executeQuery(e)}function c(){return f.hasChanges()}function l(){return f.hasChanges()?f.saveChanges():(i.logInfo("Nothing to save",null,null,!1),e.resolve())}var p=n.breezeRoot+"data",f=new t.EntityManager(p),d=!1;return{initialize:a,getParticipantByGuid:o,createClassicActivity:s,getClassicActivityByParticipant:u,hasChanges:c,saveChanges:l}}),requirejs.config({paths:{text:"../Scripts/text",durandal:"../Scripts/durandal",plugins:"../Scripts/durandal/plugins",transitions:"../Scripts/durandal/transitions",breeze:"../Scripts/breeze.debug",Q:"../Scripts/q"}}),define("jquery",[],function(){return jQuery}),define("knockout",ko),define("main",["durandal/system","durandal/app","durandal/viewLocator","config","services/globals","services/context"],function(e,t,n,r,i,a){ko.utils.extend(i,r),ko.validation.init({errorElementClass:"has-error",errorMessageClass:"help-block"}),ko.bindingHandlers.radioButtonGroupChecked={init:function(e,t,n,r,i){var a=t(),o=function(){return{change:function(){a(e.value)}}};$(e).val()==ko.unwrap(t())&&$(e).closest(".btn").button("toggle"),ko.bindingHandlers.event.init(e,o,n,r,i)}},e.debug(i.debug),t.title="SIMA Writer",t.configurePlugins({router:!0,dialog:!0,widget:{kinds:["likert"]}}),a.initialize().then(t.start()).then(function(){n.useConvention(),t.setRoot("viewmodels/shell")})}),define("plugins/history",["durandal/system","jquery"],function(e,t){function n(e,t,n){if(n){var r=e.href.replace(/(javascript:|#).*$/,"");s.history.replaceState?s.history.replaceState({},document.title,r+"#"+t):e.replace(r+"#"+t)}else e.hash="#"+t}var r=/^[#\/]|\s+$/g,i=/^\/+|\/+$/g,a=/msie [\w.]+/,o=/\/$/,s={interval:50,active:!1};return"undefined"!=typeof window&&(s.location=window.location,s.history=window.history),s.getHash=function(e){var t=(e||s).location.href.match(/#(.*)$/);return t?t[1]:""},s.getFragment=function(e,t){if(null==e)if(s._hasPushState||!s._wantsHashChange||t){e=s.location.pathname+s.location.search;var n=s.root.replace(o,"");e.indexOf(n)||(e=e.substr(n.length))}else e=s.getHash();return e.replace(r,"")},s.activate=function(n){s.active&&e.error("History has already been activated."),s.active=!0,s.options=e.extend({},{root:"/"},s.options,n),s.root=s.options.root,s._wantsHashChange=s.options.hashChange!==!1,s._wantsPushState=!!s.options.pushState,s._hasPushState=!!(s.options.pushState&&s.history&&s.history.pushState);var o=s.getFragment(),u=document.documentMode,c=a.exec(navigator.userAgent.toLowerCase())&&(!u||7>=u);s.root=("/"+s.root+"/").replace(i,"/"),c&&s._wantsHashChange&&(s.iframe=t('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,s.navigate(o,!1)),s._hasPushState?t(window).on("popstate",s.checkUrl):s._wantsHashChange&&"onhashchange"in window&&!c?t(window).on("hashchange",s.checkUrl):s._wantsHashChange&&(s._checkUrlInterval=setInterval(s.checkUrl,s.interval)),s.fragment=o;var l=s.location,p=l.pathname.replace(/[^\/]$/,"$&/")===s.root;if(s._wantsHashChange&&s._wantsPushState){if(!s._hasPushState&&!p)return s.fragment=s.getFragment(null,!0),s.location.replace(s.root+s.location.search+"#"+s.fragment),!0;s._hasPushState&&p&&l.hash&&(this.fragment=s.getHash().replace(r,""),this.history.replaceState({},document.title,s.root+s.fragment+l.search))}return s.options.silent?void 0:s.loadUrl(n.startRoute)},s.deactivate=function(){t(window).off("popstate",s.checkUrl).off("hashchange",s.checkUrl),clearInterval(s._checkUrlInterval),s.active=!1},s.checkUrl=function(){var e=s.getFragment();return e===s.fragment&&s.iframe&&(e=s.getFragment(s.getHash(s.iframe))),e===s.fragment?!1:(s.iframe&&s.navigate(e,!1),void s.loadUrl())},s.loadUrl=function(e){var t=s.fragment=s.getFragment(e);return s.options.routeHandler?s.options.routeHandler(t):!1},s.navigate=function(t,r){if(!s.active)return!1;if(void 0===r?r={trigger:!0}:e.isBoolean(r)&&(r={trigger:r}),t=s.getFragment(t||""),s.fragment!==t){s.fragment=t;var i=s.root+t;if(""===t&&"/"!==i&&(i=i.slice(0,-1)),s._hasPushState)s.history[r.replace?"replaceState":"pushState"]({},document.title,i);else{if(!s._wantsHashChange)return s.location.assign(i);n(s.location,t,r.replace),s.iframe&&t!==s.getFragment(s.getHash(s.iframe))&&(r.replace||s.iframe.document.open().close(),n(s.iframe.location,t,r.replace))}return r.trigger?s.loadUrl(t):void 0}},s.navigateBack=function(){s.history.back()},s}),define("plugins/router",["durandal/system","durandal/app","durandal/activator","durandal/events","durandal/composition","plugins/history","knockout","jquery"],function(e,t,n,r,i,a,o,s){function u(e){return e=e.replace(g,"\\$&").replace(y,"(?:$1)?").replace(v,function(e,t){return t?e:"([^/]+)"}).replace(m,"(.*?)"),new RegExp("^"+e+"$",w?void 0:"i")}function c(e){var t=e.indexOf(":"),n=t>0?t-1:e.length;return e.substring(0,n)}function l(e,t){return-1!==e.indexOf(t,e.length-t.length)}function p(e,t){if(!e||!t)return!1;if(e.length!=t.length)return!1;for(var n=0,r=e.length;r>n;n++)if(e[n]!=t[n])return!1;return!0}function f(e){return e.queryString?e.fragment+"?"+e.queryString:e.fragment}var d,h,y=/\((.*?)\)/g,v=/(\(\?)?:\w+/g,m=/\*\w+/g,g=/[\-{}\[\]+?.,\\\^$|#\s]/g,b=/\/$/,w=!1,S="/",E="/",T=function(){function i(e,t){return e.router&&e.router.parent==t}function s(e){I&&I.config.isActive&&I.config.isActive(e)}function y(t,n,r){e.log("Navigation Complete",t,n);var a=e.getModuleId(D);a&&R.trigger("router:navigation:from:"+a),D=t,s(!1),I=n,s(!0);var o=e.getModuleId(D);switch(o&&R.trigger("router:navigation:to:"+o),i(t,R)||R.updateDocumentTitle(t,n),r){case"rootRouter":S=f(I);break;case"rootRouterWithChild":E=f(I);break;case"lastChildRouter":S=E}h.explicitNavigation=!1,h.navigatingBack=!1,R.trigger("router:navigation:complete",t,n,R)}function m(t,n){e.log("Navigation Cancelled"),R.activeInstruction(I),R.navigate(S,!1),j(!1),h.explicitNavigation=!1,h.navigatingBack=!1,R.trigger("router:navigation:cancelled",t,n,R)}function g(t){e.log("Navigation Redirecting"),j(!1),h.explicitNavigation=!1,h.navigatingBack=!1,R.navigate(t,{trigger:!0,replace:!0})}function w(t,n,r){h.navigatingBack=!h.explicitNavigation&&D!=r.fragment,R.trigger("router:route:activating",n,r,R);var a={canDeactivate:!R.parent};t.activateItem(n,r.params,a).then(function(e){if(e){var a=D,o=i(n,R),s="";if(R.parent?o||(s="lastChildRouter"):s=o?"rootRouterWithChild":"rootRouter",y(n,r,s),o){n.router.trigger("router:route:before-child-routes",n,r,R);var u=r.fragment;r.queryString&&(u+="?"+r.queryString),n.router.loadUrl(u)}a==n&&(R.attached(),R.compositionComplete())}else t.settings.lifecycleData&&t.settings.lifecycleData.redirect?g(t.settings.lifecycleData.redirect):m(n,r);
d&&(d.resolve(),d=null)}).fail(function(t){e.error(t)})}function x(t,n,r){var i=R.guardRoute(n,r);i||""===i?i.then?i.then(function(i){i?e.isString(i)?g(i):w(t,n,r):m(n,r)}):e.isString(i)?g(i):w(t,n,r):m(n,r)}function P(e,t,n){R.guardRoute?x(e,t,n):w(e,t,n)}function _(e){return I&&I.config.moduleId==e.config.moduleId&&D&&(D.canReuseForRoute&&D.canReuseForRoute.apply(D,e.params)||!D.canReuseForRoute&&D.router&&D.router.loadUrl)}function N(){if(!j()){var t=M.shift();if(M=[],t)if(j(!0),R.activeInstruction(t),R.trigger("router:navigation:processing",t,R),_(t)){var r=n.create();r.forceActiveItem(D),r.settings.areSameItem=V.settings.areSameItem,r.settings.findChildActivator=V.settings.findChildActivator,P(r,D,t)}else t.config.moduleId?e.acquire(t.config.moduleId).then(function(n){var r=e.resolveObject(n);t.config.viewUrl&&(r.viewUrl=t.config.viewUrl),P(V,r,t)}).fail(function(n){e.error("Failed to load routed module ("+t.config.moduleId+"). Details: "+n.message,n)}):P(V,{viewUrl:t.config.viewUrl,canReuseForRoute:function(){return!0}},t)}}function O(e){M.unshift(e),N()}function A(e,t,n){for(var r=e.exec(t).slice(1),i=0;i<r.length;i++){var a=r[i];r[i]=a?decodeURIComponent(a):null}var o=R.parseQueryString(n);return o&&r.push(o),{params:r,queryParams:o}}function C(t){R.trigger("router:route:before-config",t,R),e.isRegExp(t.route)?t.routePattern=t.route:(t.title=t.title||R.convertRouteToTitle(t.route),t.viewUrl||(t.moduleId=t.moduleId||R.convertRouteToModuleId(t.route)),t.hash=t.hash||R.convertRouteToHash(t.route),t.hasChildRoutes&&(t.route=t.route+"*childRoutes"),t.routePattern=u(t.route)),t.isActive=t.isActive||o.observable(!1),R.trigger("router:route:after-config",t,R),R.routes.push(t),R.route(t.routePattern,function(e,n){var r=A(t.routePattern,e,n);O({fragment:e,queryString:n,config:t,params:r.params,queryParams:r.queryParams})})}function k(t){if(e.isArray(t.route))for(var n=t.isActive||o.observable(!1),r=0,i=t.route.length;i>r;r++){var a=e.extend({},t);a.route=t.route[r],a.isActive=n,r>0&&delete a.nav,C(a)}else C(t);return R}function F(e){var n=o.unwrap(t.title);document.title=n?e+" | "+n:e}var D,I,M=[],j=o.observable(!1),V=n.create(),R={handlers:[],routes:[],navigationModel:o.observableArray([]),activeItem:V,isNavigating:o.computed(function(){var e=V(),t=j(),n=e&&e.router&&e.router!=R&&e.router.isNavigating()?!0:!1;return t||n}),activeInstruction:o.observable(null),__router__:!0};r.includeIn(R),V.settings.areSameItem=function(e,t,n,r){return e==t?p(n,r):!1},V.settings.findChildActivator=function(e){return e&&e.router&&e.router.parent==R?e.router.activeItem:null},R.parseQueryString=function(t){var n,r;if(!t)return null;if(r=t.split("&"),0==r.length)return null;n={};for(var i=0;i<r.length;i++){var a=r[i];if(""!==a){var o=a.split(/=(.+)?/),s=o[0],u=o[1]&&decodeURIComponent(o[1].replace(/\+/g," ")),c=n[s];c?e.isArray(c)?c.push(u):n[s]=[c,u]:n[s]=u}}return n},R.route=function(e,t){R.handlers.push({routePattern:e,callback:t})},R.loadUrl=function(t){var n=R.handlers,r=null,i=t,o=t.indexOf("?");if(-1!=o&&(i=t.substring(0,o),r=t.substr(o+1)),R.relativeToParentRouter){var s=this.parent.activeInstruction();i=-1==o?s.params.join("/"):s.params.slice(0,-1).join("/"),i&&"/"==i.charAt(0)&&(i=i.substr(1)),i||(i=""),i=i.replace("//","/").replace("//","/")}i=i.replace(b,"");for(var u=0;u<n.length;u++){var c=n[u];if(c.routePattern.test(i))return c.callback(i,r),!0}return e.log("Route Not Found",t,I),R.trigger("router:route:not-found",t,R),R.parent&&(S=E),a.navigate(S,{trigger:!1,replace:!0}),h.explicitNavigation=!1,h.navigatingBack=!1,!1};var q;return o.isObservable(t.title)&&t.title.subscribe(function(){var e=R.activeInstruction(),t=null!=e?o.unwrap(e.config.title):"";F(t)}),R.updateDocumentTitle=function(e,n){var r=o.unwrap(t.title),i=n.config.title;q&&q.dispose(),i?o.isObservable(i)?(q=i.subscribe(F),F(i())):F(i):r&&(document.title=r)},R.navigate=function(t,n){return t&&-1!=t.indexOf("://")?(window.location.href=t,!0):((void 0===n||e.isBoolean(n)&&n||e.isObject(n)&&n.trigger)&&(h.explicitNavigation=!0),(e.isBoolean(n)&&!n||n&&void 0!=n.trigger&&!n.trigger)&&(S=t),a.navigate(t,n))},R.navigateBack=function(){a.navigateBack()},R.attached=function(){R.trigger("router:navigation:attached",D,I,R)},R.compositionComplete=function(){j(!1),R.trigger("router:navigation:composition-complete",D,I,R),N()},R.convertRouteToHash=function(e){if(e=e.replace(/\*.*$/,""),R.relativeToParentRouter){var t=R.parent.activeInstruction(),n=e?t.config.hash+"/"+e:t.config.hash;return a._hasPushState&&(n="/"+n),n=n.replace("//","/").replace("//","/")}return a._hasPushState?e:"#"+e},R.convertRouteToModuleId=function(e){return c(e)},R.convertRouteToTitle=function(e){var t=c(e);return t.substring(0,1).toUpperCase()+t.substring(1)},R.map=function(t,n){if(e.isArray(t)){for(var r=0;r<t.length;r++)R.map(t[r]);return R}return e.isString(t)||e.isRegExp(t)?(n?e.isString(n)&&(n={moduleId:n}):n={},n.route=t):n=t,k(n)},R.buildNavigationModel=function(t){for(var n=[],r=R.routes,i=t||100,a=0;a<r.length;a++){var o=r[a];o.nav&&(e.isNumber(o.nav)||(o.nav=++i),n.push(o))}return n.sort(function(e,t){return e.nav-t.nav}),R.navigationModel(n),R},R.mapUnknownRoutes=function(t,n){var r="*catchall",i=u(r);return R.route(i,function(o,s){var u=A(i,o,s),c={fragment:o,queryString:s,config:{route:r,routePattern:i},params:u.params,queryParams:u.queryParams};if(t)if(e.isString(t))c.config.moduleId=t,n&&a.navigate(n,{trigger:!1,replace:!0});else if(e.isFunction(t)){var l=t(c);if(l&&l.then)return void l.then(function(){R.trigger("router:route:before-config",c.config,R),R.trigger("router:route:after-config",c.config,R),O(c)})}else c.config=t,c.config.route=r,c.config.routePattern=i;else c.config.moduleId=o;R.trigger("router:route:before-config",c.config,R),R.trigger("router:route:after-config",c.config,R),O(c)}),R},R.reset=function(){return I=D=void 0,R.handlers=[],R.routes=[],R.off(),delete R.options,R},R.makeRelative=function(t){return e.isString(t)&&(t={moduleId:t,route:t}),t.moduleId&&!l(t.moduleId,"/")&&(t.moduleId+="/"),t.route&&!l(t.route,"/")&&(t.route+="/"),t.fromParent&&(R.relativeToParentRouter=!0),R.on("router:route:before-config").then(function(e){t.moduleId&&(e.moduleId=t.moduleId+e.moduleId),t.route&&(e.route=""===e.route?t.route.substring(0,t.route.length-1):t.route+e.route)}),t.dynamicHash&&(R.on("router:route:after-config").then(function(e){e.routePattern=u(e.route?t.dynamicHash+"/"+e.route:t.dynamicHash),e.dynamicHash=e.dynamicHash||o.observable(e.hash)}),R.on("router:route:before-child-routes").then(function(e,t){for(var n=e.router,r=0;r<n.routes.length;r++){var i=n.routes[r],a=t.params.slice(0);i.hash=n.convertRouteToHash(i.route).replace(v,function(e){return a.length>0?a.shift():e}),i.dynamicHash(i.hash)}})),R},R.createChildRouter=function(){var e=T();return e.parent=R,e},R};return h=T(),h.explicitNavigation=!1,h.navigatingBack=!1,h.makeRoutesCaseSensitive=function(){w=!0},h.targetIsThisWindow=function(e){var t=s(e.target).attr("target");return!t||t===window.name||"_self"===t||"top"===t&&window===window.top?!0:!1},h.activate=function(t){return e.defer(function(n){if(d=n,h.options=e.extend({routeHandler:h.loadUrl},h.options,t),a.activate(h.options),a._hasPushState)for(var r=h.routes,i=r.length;i--;){var o=r[i];o.hash=o.hash.replace("#","/")}var u=h.options.root&&new RegExp("^"+h.options.root+"/");s(document).delegate("a","click",function(e){if(a._hasPushState){if(!e.altKey&&!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&h.targetIsThisWindow(e)){var t=s(this).attr("href");null==t||"#"===t.charAt(0)||/^[a-z]+:/i.test(t)||(h.explicitNavigation=!0,e.preventDefault(),u&&(t=t.replace(u,"")),a.navigate(t))}}else h.explicitNavigation=!0}),a.options.silent&&d&&(d.resolve(),d=null)}).promise()},h.deactivate=function(){a.deactivate()},h.install=function(){o.bindingHandlers.router={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,r,a){var s=o.utils.unwrapObservable(t())||{};if(s.__router__)s={model:s.activeItem(),attached:s.attached,compositionComplete:s.compositionComplete,activate:!1};else{var u=o.utils.unwrapObservable(s.router||r.router)||h;s.model=u.activeItem(),s.attached=u.attached,s.compositionComplete=u.compositionComplete,s.activate=!1}i.compose(e,s,a)}},o.virtualElements.allowedBindings.router=!0},h}),define("viewmodels/404",["services/logger","services/globals","plugins/router"],function(e,t,n){var r=function(){this.imageRoot=t.imageRoot,this.activate=function(){e.logWarning("Warning: Page Not Found",null,"404.js",!1)},this.goBack=function(){n.navigateBack()}};return r}),define("viewmodels/classic/activity",["durandal/app","plugins/router","services/globals","services/logger","services/context"],function(e,t,n,r,i){var a=function(){var e=this;this.views=["classic/title","classic/summary","classic/initiation","classic/proceedings","classic/satisfaction","classic/overview"],this.activity=ko.observable(),this.activeView=ko.observable(this.views[0]),this.activateView=function(t){e.activeView(t)},this.activate=function(){i.getClassicActivityByParticipant().then(function(t){e.activity(t.results.length>0?t.results[0]:i.createClassicActivity()),r.logSuccess("Succesful activation",t,"classic.js-activate",!1),e.initValidation()}).fail(function(e){r.logError("Error while activate",e,"classic.js-activate",!0)})},this.initValidation=function(){this.activity().Title.extend({required:{message:"Dit is een verplicht veld."}}),this.activity().Summary.extend({required:{message:"Dit is een verplicht veld."}}),this.activity().Initiation.extend({required:{message:"Dit is een verplicht veld."}}),this.activity().Proceedings.extend({required:{message:"Dit is een verplicht veld."}}),this.activity().Satisfaction.extend({required:{message:"Dit is een verplicht veld."}})},this.getChildView=function(t){var n=e.views.indexOf(e.activeView()),r="next"===t?1:-1;return e.views[n+r]},this.prev=function(){i.saveChanges().then(function(){e.activeView(e.getChildView("prev"))}).fail(function(e){r.logError("Error while navigating prev",e,"classic.js-prev",!0)})},this.next=function(){this.stepIsValid()&&i.saveChanges().then(function(){e.activeView(e.getChildView("next"))}).fail(function(e){r.logError("Error while navigating next",e,"classic.js-next",!0)})},this.stepIsValid=function(){var e=function(e){var t=ko.validation.group(e);return t().length>0?(t.showAllMessages(!0),!1):!0};switch(this.activeView()){case"classic/title":return e(this.activity().Title);case"classic/summary":return e(this.activity().Summary);case"classic/initiation":return e(this.activity().Initiation);case"classic/proceedings":return e(this.activity().Proceedings);case"classic/satisfaction":return e(this.activity().Satisfaction)}},this.complete=function(){i.saveChanges().then(t.navigate("#/experience"))}};return a}),define("viewmodels/classic/instructions",[],function(){var e=function(){this.title="Instructies"};return e}),define("viewmodels/demographics",["plugins/router","services/context","services/globals","services/logger"],function(e,t,n,r){var i=function(){var i=this;this.genderOptions=["Man","Vrouw"],this.educationCompletedOptions=["Lager onderwijs/ basisonderwijs","LBO","MAVO/ VMBO","MULO","MBO","HAVO","VWO","HBO","Universiteit","Anders..."],this.participant=n.participant,this.participant().Age.extend({required:{message:"Dit is een verplicht veld."},min:{params:18,message:"U dient 18 jaar of ouder te zijn om aan dit experiment mee te doen."},max:{params:100,message:"U geeft aan ouder dan 100 te zijn? Dit is waarschijnlijk een typfout."}}),this.participant().Gender.extend({required:{message:"Dit is een verplicht veld."}}),this.participant().MotherLanguageDutch.extend({required:{message:"Dit is een verplicht veld."}}),this.participant().EducationCompleted.extend({required:{message:"Dit is een verplicht veld."}}),this.participant().SimaExperience.extend({required:{message:"Dit is een verplicht veld."}}),this.EducationCompletedIsDifferent=ko.computed(function(){return i.participant()?"Anders..."===i.participant().EducationCompleted():!1}),this.participant().EducationCompletedDifferent.extend({required:{message:"Dit is een verplicht veld.",onlyIf:function(){return i.EducationCompletedIsDifferent()}}}),this.isValid=function(){var e=ko.validation.group(this,{deep:!0});return e().length>0?(e.showAllMessages(!0),!1):!0},this.next=function(){this.isValid()&&t.saveChanges().then(function(){e.navigate("#/instructions"),r.logSuccess("Succesful save",null,"demograpics.js-next",!1)}).fail(function(e){r.logError("Error while saving",e,"demograpics.js-next",!0)})}};return i}),define("viewmodels/enhanced/instructions",[],function(){var e=function(){this.title="Enhanced Instuctions"};return e}),define("viewmodels/enhanced/story",["config","services/logger","services/context"],function(e,t,n){var r=function(){var e=this;this.views=["first","second","summary"],this.story=ko.observableArray(),this.activeView=ko.observable(this.views[0]),this.activateView=function(t){e.activeView(t)},this.activate=function(r){r?n.getEnhancedActivityByParticipant(r).then(function(n){e.story(n.results[0]),t.logSuccess("Succesful activation",n,"enhanced.js-activate",!1)}).fail(function(e){t.logError("Error while activate",e,"enhanced.js-activate",!0)}):e.story(n.enhancedActivity())},this.bindingComplete=function(e){$(e).find(".indicator").tooltip({placement:"right"})},this.getChildView=function(t){var n=e.views.indexOf(e.activeView()),r="next"===t?1:-1;return e.views[n+r]},this.prev=function(){n.saveChanges().then(function(){e.activeView(e.getChildView("prev"))}).fail(function(e){t.logError("Error while navigate prev",e,"enhanced.js-prev",!0)})},this.next=function(){n.saveChanges().then(function(){e.activeView(e.getChildView("next"))}).fail(function(e){t.logError("Error while navigating next",e,"enhanced.js-next",!0)})},this.complete=function(){t.logInfo("Completed",null,"enhanced.js-complete",!0)},this.newActivity=function(){n.newActivity()}};return r}),define("viewmodels/experience",["plugins/router","services/context","services/globals","services/logger"],function(e,t,n){var r=function(){var r=this;this.participant=n.participant,this.participant().InstructionClear.extend({required:{message:"Dit is een verplicht veld."}}),this.participant().InstructionEffective.extend({required:{message:"Dit is een verplicht veld."}}),"Enhanced"===this.participant().ActivityType()&&(this.participant().FeedbackClear.extend({required:{message:"Dit is een verplicht veld."}}),this.participant().FeedbackEffective.extend({required:{message:"Dit is een verplicht veld."}})),this.participant().GoodActivity.extend({required:{message:"Dit is een verplicht veld."}}),this.isValid=function(){var e=ko.validation.group(this,{deep:!0});return e().length>0?(e.showAllMessages(!0),!1):!0},this.complete=function(){this.isValid()&&(r.participant().Completed(!0),t.saveChanges().then(e.navigate("#/thanks")))}};return r}),define("viewmodels/shell",["services/globals","services/context","services/logger","plugins/router"],function(e,t,n,r){var i=function(){var n=this;this.router=r,this.mapRouter=function(){var t=[];ko.utils.arrayPushAll(t,[{route:"",moduleId:"viewmodels/welcome",title:"Welkom",nav:!0},{route:"demographics",moduleId:"viewmodels/demographics",title:"Demografische gegevens",nav:!0}]),"Classic"===e.participant().ActivityType()?ko.utils.arrayPushAll(t,[{route:"instructions",moduleId:"viewmodels/classic/instructions",title:"Instructies",nav:!0},{route:"activiteit",moduleId:"viewmodels/classic/activity",title:"Activiteit",nav:!0}]):ko.utils.arrayPushAll(t,[{route:"instructions",moduleId:"viewmodels/enhanced/instructions",title:"Instructions",nav:!0},{route:"activiteit",moduleId:"viewmodels/enhanced/activity",title:"Activiteit",nav:!0}]),ko.utils.arrayPushAll(t,[{route:"experience",moduleId:"viewmodels/experience",title:"Ervaringen",nav:!0},{route:"thanks",moduleId:"viewmodels/thanks",title:"Bedankt",nav:!0}]),r.map(t).buildNavigationModel().mapUnknownRoutes("viewmodels/404","404-page-not-foud")},this.activateRouter=function(){return this.mapRouter(),this.router.activate()},this.activate=function(){t.getParticipantByGuid(e.participantGuid).then(function(t){e.participant(t.results[0])}).then(function(){return n.activateRouter()})}};return i}),define("viewmodels/thanks",["services/globals"],function(e){var t=function(){this.imageRoot=e.imageRoot};return t}),define("viewmodels/welcome",["services/globals"],function(e){var t=function(){this.imageRoot=e.imageRoot};return t}),define("widgets/likert/viewmodel",[],function(){var e=function(){this.activate=function(e){this.name=e.name,this.field=e.field}};return e}),define("plugins/dialog",["durandal/system","durandal/app","durandal/composition","durandal/activator","durandal/viewEngine","jquery","knockout"],function(e,t,n,r,i,a,o){function s(t){return e.defer(function(n){e.isString(t)?e.acquire(t).then(function(t){n.resolve(e.resolveObject(t))}).fail(function(n){e.error("Failed to load dialog module ("+t+"). Details: "+n.message)}):n.resolve(t)}).promise()}var u,c={},l=o.observable(0),p=function(e,t,n,r,i){this.message=e,this.title=t||p.defaultTitle,this.options=n||p.defaultOptions,this.autoclose=r||!1,this.settings=a.extend({},p.defaultSettings,i)};return p.prototype.selectOption=function(e){u.close(this,e)},p.prototype.getView=function(){return i.processMarkup(p.defaultViewMarkup)},p.setViewUrl=function(e){delete p.prototype.getView,p.prototype.viewUrl=e},p.defaultTitle=t.title||"Application",p.defaultOptions=["Ok"],p.defaultSettings={buttonClass:"btn btn-default",primaryButtonClass:"btn-primary autofocus",secondaryButtonClass:"","class":"modal-content messageBox",style:null},p.setDefaults=function(e){a.extend(p.defaultSettings,e)},p.prototype.getButtonClass=function(e){var t="";return this.settings&&(this.settings.buttonClass&&(t=this.settings.buttonClass),0===e()&&this.settings.primaryButtonClass&&(t.length>0&&(t+=" "),t+=this.settings.primaryButtonClass),e()>0&&this.settings.secondaryButtonClass&&(t.length>0&&(t+=" "),t+=this.settings.secondaryButtonClass)),t},p.prototype.getClass=function(){return this.settings?this.settings["class"]:"messageBox"},p.prototype.getStyle=function(){return this.settings?this.settings.style:null},p.prototype.getButtonText=function(t){var n=a.type(t);return"string"===n?t:"object"===n?"string"===a.type(t.text)?t.text:(e.error("The object for a MessageBox button does not have a text property that is a string."),null):(e.error("Object for a MessageBox button is not a string or object but "+n+"."),null)},p.prototype.getButtonValue=function(t){var n=a.type(t);return"string"===n?t:"object"===n?"undefined"===a.type(t.text)?(e.error("The object for a MessageBox button does not have a value property defined."),null):t.value:(e.error("Object for a MessageBox button is not a string or object but "+n+"."),null)},p.defaultViewMarkup=['<div data-view="plugins/messageBox" data-bind="css: getClass(), style: getStyle()">','<div class="modal-header">','<h3 data-bind="html: title"></h3>',"</div>",'<div class="modal-body">','<p class="message" data-bind="html: message"></p>',"</div>",'<div class="modal-footer">',"<!-- ko foreach: options -->",'<button data-bind="click: function () { $parent.selectOption($parent.getButtonValue($data)); }, text: $parent.getButtonText($data), css: $parent.getButtonClass($index)"></button>',"<!-- /ko -->",'<div style="clear:both;"></div>',"</div>","</div>"].join("\n"),u={MessageBox:p,currentZIndex:1050,getNextZIndex:function(){return++this.currentZIndex},isOpen:o.computed(function(){return l()>0}),getContext:function(e){return c[e||"default"]},addContext:function(e,t){t.name=e,c[e]=t;var n="show"+e.substr(0,1).toUpperCase()+e.substr(1);this[n]=function(t,n){return this.show(t,n,e)}},createCompositionSettings:function(e,t){var n={model:e,activate:!1,transition:!1};return t.binding&&(n.binding=t.binding),t.attached&&(n.attached=t.attached),t.compositionComplete&&(n.compositionComplete=t.compositionComplete),n},getDialog:function(e){return e?e.__dialog__:void 0},close:function(e){var t=this.getDialog(e);if(t){var n=Array.prototype.slice.call(arguments,1);t.close.apply(t,n)}},show:function(t,i,a){var o=this,u=c[a||"default"];return e.defer(function(e){s(t).then(function(t){var a=r.create();a.activateItem(t,i).then(function(r){if(r){var i=t.__dialog__={owner:t,context:u,activator:a,close:function(){var n=arguments;a.deactivateItem(t,!0).then(function(r){r&&(l(l()-1),u.removeHost(i),delete t.__dialog__,0===n.length?e.resolve():1===n.length?e.resolve(n[0]):e.resolve.apply(e,n))})}};i.settings=o.createCompositionSettings(t,u),u.addHost(i),l(l()+1),n.compose(i.host,i.settings)}else e.resolve(!1)})})}).promise()},showMessage:function(t,n,r,i,a){return e.isString(this.MessageBox)?u.show(this.MessageBox,[t,n||p.defaultTitle,r||p.defaultOptions,i||!1,a||{}]):u.show(new this.MessageBox(t,n,r,i,a))},install:function(e){t.showDialog=function(e,t,n){return u.show(e,t,n)},t.closeDialog=function(){return u.close.apply(u,arguments)},t.showMessage=function(e,t,n,r,i){return u.showMessage(e,t,n,r,i)},e.messageBox&&(u.MessageBox=e.messageBox),e.messageBoxView&&(u.MessageBox.prototype.getView=function(){return i.processMarkup(e.messageBoxView)}),e.messageBoxViewUrl&&u.MessageBox.setViewUrl(e.messageBoxViewUrl)}},u.addContext("default",{blockoutOpacity:.9,removeDelay:200,addHost:function(e){var t=a("body"),n=a('<div class="modalBlockout"></div>').css({"z-index":u.getNextZIndex(),opacity:this.blockoutOpacity}).appendTo(t),r=a('<div class="modalHost"></div>').css({"z-index":u.getNextZIndex()}).appendTo(t);if(e.host=r.get(0),e.blockout=n.get(0),!u.isOpen()){e.oldBodyMarginRight=t.css("margin-right"),e.oldInlineMarginRight=t.get(0).style.marginRight;var i=a("html"),o=t.outerWidth(!0),s=i.scrollTop();a("html").css("overflow-y","hidden");var c=a("body").outerWidth(!0);t.css("margin-right",c-o+parseInt(e.oldBodyMarginRight,10)+"px"),i.scrollTop(s)}},removeHost:function(e){if(a(e.host).css("opacity",0),a(e.blockout).css("opacity",0),setTimeout(function(){o.removeNode(e.host),o.removeNode(e.blockout)},this.removeDelay),!u.isOpen()){var t=a("html"),n=t.scrollTop();t.css("overflow-y","").scrollTop(n),e.oldInlineMarginRight?a("body").css("margin-right",e.oldBodyMarginRight):a("body").css("margin-right","")}},attached:function(e){a(e).css("visibility","hidden")},compositionComplete:function(e,t,n){var r=u.getDialog(n.model),i=a(e),o=i.find("img").filter(function(){var e=a(this);return!(this.style.width&&this.style.height||e.attr("width")&&e.attr("height"))});i.data("predefinedWidth",i.get(0).style.width);var s=function(e,t){setTimeout(function(){var n=a(e);t.context.reposition(e),a(t.host).css("opacity",1),n.css("visibility","visible"),n.find(".autofocus").first().focus()},1)};s(e,r),o.load(function(){s(e,r)}),(i.hasClass("autoclose")||n.model.autoclose)&&a(r.blockout).click(function(){r.close()})},reposition:function(e){var t=a(e),n=a(window);t.data("predefinedWidth")||t.css({width:""});var r=t.outerWidth(!1),i=t.outerHeight(!1),o=n.height()-10,s=n.width()-10,u=Math.min(i,o),c=Math.min(r,s);t.css({"margin-top":(-u/2).toString()+"px","margin-left":(-c/2).toString()+"px"}),i>o?t.css("overflow-y","auto").outerHeight(o):t.css({"overflow-y":"",height:""}),r>s?t.css("overflow-x","auto").outerWidth(s):(t.css("overflow-x",""),t.data("predefinedWidth")?t.css("width",t.data("predefinedWidth")):t.outerWidth(c))}}),u}),define("plugins/http",["jquery","knockout"],function(e,t){return{callbackParam:"callback",toJSON:function(e){return t.toJSON(e)},get:function(n,r,i){return e.ajax(n,{data:r,headers:t.toJS(i)})},jsonp:function(n,r,i,a){return-1==n.indexOf("=?")&&(i=i||this.callbackParam,n+=-1==n.indexOf("?")?"?":"&",n+=i+"=?"),e.ajax({url:n,dataType:"jsonp",data:r,headers:t.toJS(a)})},put:function(n,r,i){return e.ajax({url:n,data:this.toJSON(r),type:"PUT",contentType:"application/json",dataType:"json",headers:t.toJS(i)})},post:function(n,r,i){return e.ajax({url:n,data:this.toJSON(r),type:"POST",contentType:"application/json",dataType:"json",headers:t.toJS(i)})},remove:function(n,r,i){return e.ajax({url:n,data:r,type:"DELETE",headers:t.toJS(i)})}}}),define("plugins/observable",["durandal/system","durandal/binder","knockout"],function(e,t,n){function r(e){var t=e[0];return"_"===t||"$"===t||T&&e===T}function i(t){return!(!t||void 0===t.nodeType||!e.isNumber(t.nodeType))}function a(e){if(!e||i(e)||e.ko===n||e.jquery)return!1;var t=h.call(e);return-1==y.indexOf(t)&&!(e===!0||e===!1)}function o(e){var t={};return Object.defineProperty(e,"__observable__",{enumerable:!1,configurable:!1,writable:!1,value:t}),t}function s(e,t,n){var r=e.__observable__,i=!0;if(!r||!r.__full__){r=r||o(e),r.__full__=!0,b.forEach(function(n){t[n]=function(){return w[n].apply(e,arguments)}}),v.forEach(function(n){e[n]=function(){i=!1;var e=S[n].apply(t,arguments);return i=!0,e}}),m.forEach(function(n){e[n]=function(){i&&t.valueWillMutate();var r=w[n].apply(e,arguments);return i&&t.valueHasMutated(),r}}),g.forEach(function(r){e[r]=function(){for(var a=0,o=arguments.length;o>a;a++)u(arguments[a],n);i&&t.valueWillMutate();var s=w[r].apply(e,arguments);return i&&t.valueHasMutated(),s}}),e.splice=function(){for(var r=2,a=arguments.length;a>r;r++)u(arguments[r],n);i&&t.valueWillMutate();var o=w.splice.apply(e,arguments);return i&&t.valueHasMutated(),o};for(var a=0,s=e.length;s>a;a++)u(e[a],n)}}function u(t,r){var i,u;if(T&&t&&t[T]&&(r=r?r.slice(0):[],r.push(t[T])),a(t)&&(i=t.__observable__,!i||!i.__full__)){if(i=i||o(t),i.__full__=!0,e.isArray(t)){var c=n.observableArray(t);s(t,c,r)}else for(var f in t)if(!d(f)&&!i[f]){var h=Object.getPropertyDescriptor(t,f);h&&(h.get||h.set)?p(t,f,{get:h.get,set:h.set}):(u=t[f],e.isFunction(u)||l(t,f,u,r))}E&&e.log("Converted",t)}}function c(e,t,n){n?t?t.destroyAll||s(t,e):(t=[],s(t,e)):u(t),e(t)}function l(t,r,i,a){var l,p,f=t.__observable__||o(t);if(void 0===i&&(i=t[r]),e.isArray(i))l=n.observableArray(i),s(i,l,a),p=!0;else if("function"==typeof i){if(!n.isObservable(i))return null;l=i}else!x&&e.isPromise(i)?(l=n.observable(),i.then(function(t){if(e.isArray(t)){var r=n.observableArray(t);s(t,r,a),t=r}l(t)})):(l=n.observable(i),u(i,a));return a&&a.length>0&&a.forEach(function(n){e.isArray(i)?l.subscribe(function(e){n(t,r,null,e)},null,"arrayChange"):l.subscribe(function(e){n(t,r,e,null)})}),Object.defineProperty(t,r,{configurable:!0,enumerable:!0,get:l,set:n.isWriteableObservable(l)?function(t){t&&e.isPromise(t)&&!x?t.then(function(t){c(l,t,e.isArray(t))}):c(l,t,p)}:void 0}),f[r]=l,l}function p(t,r,i){var a,o={owner:t,deferEvaluation:!0};return"function"==typeof i?o.read=i:("value"in i&&e.error('For defineProperty, you must not specify a "value" for the property. You must provide a "get" function.'),"function"!=typeof i.get&&"function"!=typeof i.read&&e.error('For defineProperty, the third parameter must be either an evaluator function, or an options object containing a function called "get".'),o.read=i.get||i.read,o.write=i.set||i.write),a=n.computed(o),t[r]=a,l(t,r,a)}var f,d,h=Object.prototype.toString,y=["[object Function]","[object String]","[object Boolean]","[object Number]","[object Date]","[object RegExp]"],v=["remove","removeAll","destroy","destroyAll","replace"],m=["pop","reverse","sort","shift","slice"],g=["push","unshift"],b=["filter","map","reduce","reduceRight","forEach","every","some"],w=Array.prototype,S=n.observableArray.fn,E=!1,T=void 0,x=!1;if(!("getPropertyDescriptor"in Object)){var P=Object.getOwnPropertyDescriptor,_=Object.getPrototypeOf;Object.getPropertyDescriptor=function(e,t){for(var n,r=e;r&&!(n=P(r,t));)r=_(r);return n}}return f=function(e,t){var r,i,a;return e?(r=e.__observable__,r&&(i=r[t])?i:(a=e[t],n.isObservable(a)?a:l(e,t,a))):null},f.defineProperty=p,f.convertProperty=l,f.convertObject=u,f.install=function(e){var n=t.binding;t.binding=function(e,t,r){r.applyBindings&&!r.skipConversion&&u(e),n(e,t)},E=e.logConversion,e.changeDetection&&(T=e.changeDetection),x=e.skipPromises,d=e.shouldIgnorePropertyName||r},f}),define("plugins/serializer",["durandal/system"],function(e){return{typeAttribute:"type",space:void 0,replacer:function(e,t){if(e){var n=e[0];if("_"===n||"$"===n)return void 0}return t},serialize:function(t,n){return n=void 0===n?{}:n,(e.isString(n)||e.isNumber(n))&&(n={space:n}),JSON.stringify(t,n.replacer||this.replacer,n.space||this.space)},getTypeId:function(e){return e?e[this.typeAttribute]:void 0},typeMap:{},registerType:function(){var t=arguments[0];if(1==arguments.length){var n=t[this.typeAttribute]||e.getModuleId(t);this.typeMap[n]=t}else this.typeMap[t]=arguments[1]},reviver:function(e,t,n,r){var i=n(t);if(i){var a=r(i);if(a)return a.fromJSON?a.fromJSON(t):new a(t)}return t},deserialize:function(e,t){var n=this;t=t||{};var r=t.getTypeId||function(e){return n.getTypeId(e)},i=t.getConstructor||function(e){return n.typeMap[e]},a=t.reviver||function(e,t){return n.reviver(e,t,r,i)};return JSON.parse(e,a)},clone:function(e,t){return this.deserialize(this.serialize(e,t),t)}}}),define("plugins/widget",["durandal/system","durandal/composition","jquery","knockout"],function(e,t,n,r){function i(e,n){var i=r.utils.domData.get(e,u);i||(i={parts:t.cloneNodes(r.virtualElements.childNodes(e))},r.virtualElements.emptyNode(e),r.utils.domData.set(e,u,i)),n.parts=i.parts}var a={},o={},s=["model","view","kind"],u="durandal-widget-data",c={getSettings:function(t){var n=r.utils.unwrapObservable(t())||{};if(e.isString(n))return{kind:n};for(var i in n)n[i]=-1!=r.utils.arrayIndexOf(s,i)?r.utils.unwrapObservable(n[i]):n[i];return n},registerKind:function(e){r.bindingHandlers[e]={init:function(){return{controlsDescendantBindings:!0}},update:function(t,n,r,a,o){var s=c.getSettings(n);s.kind=e,i(t,s),c.create(t,s,o,!0)}},r.virtualElements.allowedBindings[e]=!0,t.composeBindings.push(e+":")},mapKind:function(e,t,n){t&&(o[e]=t),n&&(a[e]=n)},mapKindToModuleId:function(e){return a[e]||c.convertKindToModulePath(e)},convertKindToModulePath:function(e){return"widgets/"+e+"/viewmodel"},mapKindToViewId:function(e){return o[e]||c.convertKindToViewPath(e)},convertKindToViewPath:function(e){return"widgets/"+e+"/view"},createCompositionSettings:function(e,t){return t.model||(t.model=this.mapKindToModuleId(t.kind)),t.view||(t.view=this.mapKindToViewId(t.kind)),t.preserveContext=!0,t.activate=!0,t.activationData=t,t.mode="templated",t},create:function(e,n,r,i){i||(n=c.getSettings(function(){return n},e));var a=c.createCompositionSettings(e,n);t.compose(e,a,r)},install:function(e){if(e.bindingName=e.bindingName||"widget",e.kinds)for(var n=e.kinds,a=0;a<n.length;a++)c.registerKind(n[a]);r.bindingHandlers[e.bindingName]={init:function(){return{controlsDescendantBindings:!0}},update:function(e,t,n,r,a){var o=c.getSettings(t);i(e,o),c.create(e,o,a,!0)}},t.composeBindings.push(e.bindingName+":"),r.virtualElements.allowedBindings[e.bindingName]=!0}};return c}),define("transitions/entrance",["durandal/system","durandal/composition","jquery"],function(e,t,n){function r(e,t){e.classList.remove(t?"entrance-in-fade":"entrance-in"),e.classList.remove("entrance-out")}var i=100,a={left:"0px",opacity:1},o={left:"",top:"",right:"",bottom:"",position:"",opacity:""},s=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/MSIE/),u=!1,c="Webkit Moz O ms Khtml".split(" "),l=document.createElement("div");if(void 0!==l.style.animationName&&(u=!0),!u)for(var p=0;p<c.length;p++)if(void 0!==l.style[c[p]+"AnimationName"]){u=!0;break}e.log(u?s?"Using CSS3/jQuery mixed animations.":"Using CSS3 animations.":"Using jQuery animations.");var f=function(t){return e.defer(function(e){function c(){e.resolve()}function l(){t.keepScrollPosition||n(document).scrollTop(0)}function p(){l(),t.triggerAttach(),u?(r(t.child,h),t.child.classList.add(h?"entrance-in-fade":"entrance-in"),setTimeout(function(){r(t.child,h),t.activeView&&r(t.activeView,h),d.css(o),c()},f)):d.animate(a,{duration:f,easing:"swing",always:function(){d.css(o),c()}})}if(t.child){var f=t.duration||500,d=n(t.child),h=!!t.fadeOnly,y={display:"block",opacity:0,position:"absolute",left:h||u?"0px":"20px",right:0,top:0,bottom:0};
d.css(y),t.activeView?u&&!s?(r(t.activeView,h),t.activeView.classList.add("entrance-out"),setTimeout(p,i)):n(t.activeView).fadeOut({duration:i,always:p}):p()}else n(t.activeView).fadeOut(i,c)}).promise()};return f}),define("text",["module"],function(e){var t,n,r,i,a=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,s=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,u="undefined"!=typeof location&&location.href,c=u&&location.protocol&&location.protocol.replace(/\:/,""),l=u&&location.hostname,p=u&&(location.port||void 0),f={},d=e.config&&e.config()||{};return t={version:"2.0.7",strip:function(e){if(e){e=e.replace(o,"");var t=e.match(s);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:d.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=a[t];try{e=new ActiveXObject(n)}catch(r){}if(e){a=[n];break}}return e},parseName:function(e){var t,n,r,i=!1,a=e.indexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==a&&(!o||a>1)?(t=e.substring(0,a),n=e.substring(a+1,e.length)):t=e,r=n||t,a=r.indexOf("!"),-1!==a&&(i="strip"===r.substring(a+1),r=r.substring(0,a),n?n=r:t=r),{moduleName:t,ext:n,strip:i}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,r,i){var a,o,s,u=t.xdRegExp.exec(e);return u?(a=u[2],o=u[3],o=o.split(":"),s=o[1],o=o[0],!(a&&a!==n||o&&o.toLowerCase()!==r.toLowerCase()||(s||o)&&s!==i)):!0},finishLoad:function(e,n,r,i){r=n?t.strip(r):r,d.isBuild&&(f[e]=r),i(r)},load:function(e,n,r,i){if(i.isBuild&&!i.inlineText)return void r();d.isBuild=i.isBuild;var a=t.parseName(e),o=a.moduleName+(a.ext?"."+a.ext:""),s=n.toUrl(o),f=d.useXhr||t.useXhr;!u||f(s,c,l,p)?t.get(s,function(n){t.finishLoad(e,a.strip,n,r)},function(e){r.error&&r.error(e)}):n([o],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,r)})},write:function(e,n,r){if(f.hasOwnProperty(n)){var i=t.jsEscape(f[n]);r.asModule(e+"!"+n,"define(function () { return '"+i+"';});\n")}},writeFile:function(e,n,r,i,a){var o=t.parseName(n),s=o.ext?"."+o.ext:"",u=o.moduleName+s,c=r.toUrl(o.moduleName+s)+".js";t.load(u,r,function(){var n=function(e){return i(c,e)};n.asModule=function(e,t){return i.asModule(e,c,t)},t.write(e,u,n,a)},a)}},"node"===d.env||!d.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t,r){try{var i=n.readFileSync(e,"utf8");0===i.indexOf("﻿")&&(i=i.substring(1)),t(i)}catch(a){r(a)}}):"xhr"===d.env||!d.env&&t.createXhr()?t.get=function(e,n,r,i){var a,o=t.createXhr();if(o.open("GET",e,!0),i)for(a in i)i.hasOwnProperty(a)&&o.setRequestHeader(a.toLowerCase(),i[a]);d.onXhr&&d.onXhr(o,e),o.onreadystatechange=function(){var t,i;4===o.readyState&&(t=o.status,t>399&&600>t?(i=new Error(e+" HTTP status: "+t),i.xhr=o,r(i)):n(o.responseText),d.onXhrComplete&&d.onXhrComplete(o,e))},o.send(null)}:"rhino"===d.env||!d.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,r,i="utf-8",a=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),i)),u="";try{for(n=new java.lang.StringBuffer,r=s.readLine(),r&&r.length()&&65279===r.charAt(0)&&(r=r.substring(1)),null!==r&&n.append(r);null!==(r=s.readLine());)n.append(o),n.append(r);u=String(n.toString())}finally{s.close()}t(u)}:("xpconnect"===d.env||!d.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(r=Components.classes,i=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),t.get=function(e,t){var n,a,o={},s=new FileUtils.File(e);try{n=r["@mozilla.org/network/file-input-stream;1"].createInstance(i.nsIFileInputStream),n.init(s,1,0,!1),a=r["@mozilla.org/intl/converter-input-stream;1"].createInstance(i.nsIConverterInputStream),a.init(n,"utf-8",n.available(),i.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),a.readString(n.available(),o),a.close(),n.close(),t(o.value)}catch(u){throw new Error((s&&s.path||"")+": "+u)}}),t}),define("text!views/404.html",[],function(){return'<img class="img-responsive" data-bind="attr :{ \'src\': imageRoot + \'404.jpg\' }" title="Oeps, deze pagina is niet gevonden!"/>\r\n<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<h1 class="page-header">404 Pagina niet gevonden</h1>\r\n			<p>Oeps, deze pagina kan niet worden gevonden!</p>\r\n			<button class="btn btn-default" data-bind="click: goBack">Ga terug</button>\r\n		</div>\r\n	</div>\r\n</div>\r\n\r\n'}),define("text!views/classic/activity.html",[],function(){return'<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<h1 class="page-header text-center">Activiteit beschrijven</h1>\r\n		</div>\r\n	</div>\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<div data-bind="compose: { view: activeView, transition: \'fadeUp\' }"></div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!views/classic/initiation.html",[],function(){return'<form>\r\n	<fieldset data-bind="with: activity">\r\n		<div class="form-group form-group-lg" data-bind="validationElement: Initiation">\r\n			<label class="control-label">Hoe kwam u ertoe deze activiteit te verrichten, hoe kwam uw deelname tot stand?</label>\r\n			<textarea class="form-control" rows="10" data-bind="value: Initiation"></textarea>\r\n		</div>\r\n	</fieldset>\r\n</form>\r\n<div class="btn-toolbar">\r\n	<button class="btn btn-default btn-lg pull-left" data-bind="click: prev">\r\n		Vorige\r\n	</button>\r\n	<button class="btn btn-default btn-lg pull-right" data-bind="click: next">\r\n		Volgende\r\n	</button>\r\n</div>'}),define("text!views/classic/instructions.html",[],function(){return'<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-10 col-xs-offset-1">\r\n			<h1 class="page-header text-center" data-bind="text: title"></h1>\r\n		</div>\r\n	</div>\r\n	<div class="row">\r\n		<div class="col-xs-10 col-xs-offset-1">\r\n			<a class="btn btn-default btn-lg pull-right" href="#/activiteit">\r\n				Start\r\n			</a>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!views/classic/overview.html",[],function(){return'<div data-bind="with: activity">\r\n	<h2 data-bind="text: Title"></h2>\r\n	<h4>Korte samenvatting van de activiteit:</h4>\r\n	<p class="text-justify" data-bind="text: Summary"></p>\r\n	<h4>Hoe kwam u ertoe deze activiteit te verrichten, hoe kwam uw deelname tot stand?</h4>\r\n	<p class="text-justify" data-bind="text: Initiation"></p>\r\n	<h4>Hoe heeft u het aangepakt, wat deed u precies, wat zei u, wat dacht u?</h4>\r\n	<p class="text-justify" data-bind="text: Proceedings"></p>\r\n	<h4>Wat maakte deze activiteit plezierig voor u? Wat precies gaf u een gevoel van tevredenheid?</h4>\r\n	<p class="text-justify" data-bind="text: Satisfaction"></p>\r\n</div>\r\n<div class="btn-toolbar">\r\n	<button class="btn btn-default btn-lg pull-left" data-bind="click: prev">\r\n		Vorige\r\n	</button>\r\n	<button class="btn btn-default btn-lg pull-right" data-bind="click: complete">\r\n		Afronden\r\n	</button>\r\n</div>\r\n'}),define("text!views/classic/proceedings.html",[],function(){return'<form>\r\n	<fieldset data-bind="with: activity">\r\n		<div class="form-group form-group-lg" data-bind="validationElement: Proceedings">\r\n			<label class="control-label">Hoe heeft u het aangepakt, wat deed u precies, wat zei u, wat dacht u?</label>\r\n			<textarea class="form-control" rows="10" data-bind="value: Proceedings"></textarea>\r\n		</div>\r\n	</fieldset>\r\n</form>\r\n<div class="btn-toolbar">\r\n	<button class="btn btn-default btn-lg pull-left" data-bind="click: prev">\r\n		Vorige\r\n	</button>\r\n	<button class="btn btn-default btn-lg pull-right" data-bind="click: next">\r\n		Volgende\r\n	</button>\r\n</div>'}),define("text!views/classic/satisfaction.html",[],function(){return'<form>\r\n	<fieldset data-bind="with: activity">\r\n		<div class="form-group form-group-lg" data-bind="validationElement: Satisfaction">\r\n			<label class="control-label">Wat maakte deze activiteit plezierig voor u? Wat precies gaf u een gevoel van tevredenheid?</label>\r\n			<textarea class="form-control" rows="10" data-bind="value: Satisfaction"></textarea>\r\n		</div>\r\n	</fieldset>\r\n</form>\r\n<div class="btn-toolbar">\r\n	<button class="btn btn-default btn-lg pull-left" data-bind="click: prev">\r\n		Vorige\r\n	</button>\r\n	<button class="btn btn-default btn-lg pull-right" data-bind="click: next">\r\n		Volgende\r\n	</button>\r\n</div>'}),define("text!views/classic/summary.html",[],function(){return'<form>\r\n	<fieldset data-bind="with: activity">\r\n		<div class="form-group form-group-lg" data-bind="validationElement: Summary">\r\n			<label class="control-label">Korte samenvatting van de activiteit:</label>\r\n			<textarea class="form-control" rows="10" data-bind="value: Summary"></textarea>\r\n		</div>\r\n	</fieldset>\r\n</form>\r\n<div class="btn-toolbar">\r\n	<button class="btn btn-default btn-lg pull-left" data-bind="click: prev">\r\n		Vorige\r\n	</button>\r\n	<button class="btn btn-default btn-lg pull-right" data-bind="click: next">\r\n		Volgende\r\n	</button>\r\n</div>'}),define("text!views/classic/title.html",[],function(){return'<form>\r\n	<fieldset data-bind="with: activity">\r\n		<div class="form-group form-group-lg" data-bind="validationElement: Title">\r\n			<label class="control-label">Titel van de activiteit:</label>\r\n			<input class="form-control" data-bind="value: Title" />\r\n		</div>\r\n	</fieldset>\r\n</form>\r\n<div class="btn-toolbar">\r\n	<button class="btn btn-default btn-lg pull-right" data-bind="click: next">\r\n		Volgende\r\n	</button>\r\n</div>'}),define("text!views/demographics.html",[],function(){return'<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<h1 class="page-header text-center">Demografische gegevens</h1>\r\n			<p></p>\r\n		</div>\r\n	</div>\r\n	<div class="row" data-bind="css : { \'animated fadeIn\' : participant }">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<form>\r\n				<fieldset data-bind="with: participant">\r\n					<div class="form-group form-group-lg" data-bind="validationElement: Age">\r\n						<label class="control-label">Wat is uw leeftijd?</label>\r\n						<input type="number" class="form-control" data-bind="value: Age" />\r\n					</div>\r\n					<div class="form-group form-group-lg" data-bind="validationElement: Gender">\r\n						<label class="control-label">Wat is uw geslacht?</label>\r\n						<select class="form-control" data-bind="options: $parent.genderOptions, optionsCaption: \'[ Maak een keuze ]\', value: Gender"></select>\r\n					</div>\r\n					<div class="form-group form-group-lg" data-bind="validationElement: MotherLanguageDutch">\r\n						<label class="control-label">Is Nederlands uw moedertaal?</label>\r\n						<select class="form-control" data-bind="options: [\'Ja\', \'Nee\'], optionsCaption: \'[ Maak een keuze ]\', value: MotherLanguageDutch"></select>\r\n					</div>\r\n					<div class="form-group form-group-lg" data-bind="validationElement: EducationCompleted">\r\n						<label class="control-label">Wat is uw hoogst afgeronde opleiding?</label>\r\n						<select class="form-control" data-bind="options: $parent.educationCompletedOptions, optionsCaption: \'[ Maak een keuze ]\', value: EducationCompleted"></select>\r\n					</div>\r\n					<div class="form-group form-group-lg" data-bind="visible: $parent.EducationCompletedIsDifferent, validationElement: EducationCompletedDifferent">\r\n						<label class="control-label">Namelijk:</label>\r\n						<input class="form-control" data-bind="value: EducationCompletedDifferent" />\r\n					</div>\r\n					<div class="form-group form-group-lg" data-bind="validationElement: SimaExperience">\r\n						<label class="control-label">Heeft u ervaring met SIMA?</label>\r\n						<select class="form-control" data-bind="options: [\'Ja\', \'Nee\'], optionsCaption: \'[ Maak een keuze ]\', value: SimaExperience"></select>\r\n					</div>\r\n				</fieldset>\r\n			</form>\r\n			<div class="btn-toolbar">\r\n				<button class="btn btn-default btn-lg pull-right" data-style="expand-right" data-bind="click: next">\r\n					Volgende\r\n				</button>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n</div>'}),define("text!views/enhanced/instructions.html",[],function(){return'<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-10 col-xs-offset-1">\r\n			<h1 class="page-header text-center" data-bind="text: title"></h1>\r\n		</div>\r\n	</div>\r\n	<div class="row">\r\n		<div class="col-xs-10 col-xs-offset-1">\r\n			<a class="btn btn-default btn-lg pull-right" href="#/activiteit">\r\n				Volgende\r\n			</a>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!views/enhanced/story.html",[],function(){return'<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-10 col-xs-offset-1">\r\n			<h1 class="page-header text-center">Enhanced</h1>\r\n		</div>\r\n	</div>\r\n	<div class="row">\r\n		<div class="col-xs-10 col-xs-offset-1">\r\n			<div data-bind="compose: { view: activeView, transition: \'fadeUp\' }"></div>\r\n		</div>\r\n		<div class="col-xs-1">\r\n			<div class="indicators" data-bind="foreach: views">\r\n				<div data-bind="attr: { \'title\' : $data } , click: $parent.activateView.bind($data), css:{ \'active\': $data === $parent.activeView() }" class="indicator"></div>\r\n			</div>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!views/experience.html",[],function(){return'<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<h1 class="page-header text-center">Uw ervaringen</h1>\r\n			<p></p>\r\n		</div>\r\n	</div>\r\n	<div class="row" data-bind="css : { \'animated fadeIn\' : participant }">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<form>\r\n				<fieldset data-bind="with: participant">\r\n					<div data-bind="likert: { name: \'InstructionsClear\', field: InstructionClear }"></div>\r\n					<div data-bind="likert: { name: \'InstructionEffective\', field: InstructionEffective }"></div>\r\n					<div data-bind="if: ActivityType() === \'Enhanced\'">\r\n						<div data-bind="likert: { name: \'FeedbackClear\', field: FeedbackClear }"></div>\r\n						<div data-bind="likert: { name: \'FeedbackEffective\', field: FeedbackEffective }"></div>\r\n					</div>\r\n					<div data-bind="likert: { name: \'GoodActivity\', field: GoodActivity }"></div>\r\n				</fieldset>\r\n			</form>\r\n			<div class="btn-toolbar">\r\n				<button class="btn btn-default btn-lg pull-right" data-bind="click: complete">\r\n					Volgende\r\n				</button>\r\n			</div>\r\n		</div>\r\n	</div>\r\n\r\n</div>'}),define("text!views/shell.html",[],function(){return'<!--<nav class="navbar navbar-default navbar-fixed-top">-->\r\n<!--	<div class="container">-->\r\n<!--		<div class="navbar-header">-->\r\n<!--			<button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#main-nav">-->\r\n<!--				<span class="icon-bar"></span>-->\r\n<!--				<span class="icon-bar"></span>-->\r\n<!--				<span class="icon-bar"></span>-->\r\n<!--			</button>-->\r\n<!--			<a class="navbar-brand" href="#">SIMA-Writer</a>-->\r\n<!--		</div>-->\r\n<!--		<div class="collapse navbar-collapse" id="main-nav">-->\r\n<!--			<ul class="nav navbar-nav" data-bind="foreach: router.navigationModel">-->\r\n<!--				<li data-bind="css: { active: isActive }">-->\r\n<!--					<a data-bind="attr: { href : hash }, text: title"></a>-->\r\n<!--				</li>-->\r\n<!--			</ul>-->\r\n<!--		</div>-->\r\n<!--	</div>-->\r\n<!--</nav>-->\r\n<div data-bind="router: { transition: \'fadeLeft\' }"></div>\r\n'}),define("text!views/thanks.html",[],function(){return'<img class="img-responsive" data-bind="attr :{ \'src\': imageRoot + \'thanks.jpg\' }" title="Waar gaan we heen?"/>\r\n<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<h1 class="page-header">Bedankt</h1>\r\n			<p class="text-justify">\r\n				Morbi ac ipsum at augue commodo sollicitudin ut et metus. Vivamus non mauris nisi. Sed commodo purus ut nisi imperdiet, vitae elementum sem sodales. Aliquam sem neque, accumsan sit amet dui eget, accumsan maximus leo. Nunc elementum et risus et pretium. Donec aliquet odio sed rhoncus facilisis. Nulla dolor ante, feugiat sit amet magna id, rutrum aliquam erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Duis dolor ligula, fringilla nec purus nec, semper gravida augue. Pellentesque faucibus hendrerit augue, nec ullamcorper augue volutpat in.	\r\n			</p>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!views/welcome.html",[],function(){return'<img class="img-responsive" data-bind="attr :{ \'src\': imageRoot + \'welcome.jpg\' }" title="Waar gaan we heen?"/>\r\n<div class="container">\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<h1 class="page-header">Welkom</h1>\r\n			<p class="text-justify">\r\n				Morbi ac ipsum at augue commodo sollicitudin ut et metus. Vivamus non mauris nisi. Sed commodo purus ut nisi imperdiet, vitae elementum sem sodales. Aliquam sem neque, accumsan sit amet dui eget, accumsan maximus leo. Nunc elementum et risus et pretium. Donec aliquet odio sed rhoncus facilisis. Nulla dolor ante, feugiat sit amet magna id, rutrum aliquam erat. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Duis dolor ligula, fringilla nec purus nec, semper gravida augue. Pellentesque faucibus hendrerit augue, nec ullamcorper augue volutpat in.	\r\n			</p>\r\n		</div>\r\n	</div>\r\n	<div class="row">\r\n		<div class="col-xs-12 col-sm-8 col-sm-offset-2">\r\n			<a class="btn btn-default btn-lg" href="#/demographics">\r\n				Start het expiriment\r\n			</a>\r\n		</div>\r\n	</div>\r\n</div>'}),define("text!widgets/likert/view.html",[],function(){return'<div class="form-group form-group-lg" data-bind="validationElement: field">\r\n	<label class="control-label">Waren de instructies duidelijk?</label>\r\n	<div class="btn-group btn-group-justified" data-toggle="buttons">\r\n		<label class="btn btn-default btn-lg">\r\n			<input type="radio" name="field" value="1" data-bind="radioButtonGroupChecked: field"> 1\r\n		</label>\r\n		<label class="btn btn-default btn-lg">\r\n			<input type="radio" name="field" value="2" data-bind="radioButtonGroupChecked: field"> 2\r\n		</label>\r\n		<label class="btn btn-default btn-lg">\r\n			<input type="radio" name="field" value="3" data-bind="radioButtonGroupChecked: field"> 3\r\n		</label>\r\n		<label class="btn btn-default btn-lg">\r\n			<input type="radio" name="field" value="4" data-bind="radioButtonGroupChecked: field"> 4\r\n		</label>\r\n		<label class="btn btn-default btn-lg">\r\n			<input type="radio" name="field" value="5" data-bind="radioButtonGroupChecked: field"> 5\r\n		</label>\r\n	</div>\r\n	<input type="hidden" data-bind="value: field">\r\n</div>'});
//# sourceMappingURL=main.build.js//# sourceMappingURL=main-built.js.map